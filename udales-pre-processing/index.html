
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="TODO:">
      
      
      
        <meta name="author" content="The uDALES Team">
      
      
        <link rel="canonical" href="https://uDALES.github.io/u-dales/udales-pre-processing/">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.4">
    
    
      
        <title>Pre-processing - uDALES</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.75751829.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="pink">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pre-processing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://uDALES.github.io/u-dales" title="uDALES" class="md-header-nav__button md-logo" aria-label="uDALES">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            uDALES
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Pre-processing
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/uDALES/u-dales" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    u-dales
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://uDALES.github.io/u-dales" title="uDALES" class="md-nav__button md-logo" aria-label="uDALES">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    uDALES
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/uDALES/u-dales" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    u-dales
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../udales-getting-started/" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../udales-example-simulations/" class="md-nav__link">
      Examples
    </a>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      User's docs
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User's docs" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        User's docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../udales-simulation-setup/" class="md-nav__link">
      Set-up
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../udales-namoptions-overview/" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Pre-processing
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Pre-processing
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-processing-parameters" class="md-nav__link">
    Pre-processing parameters
  </a>
  
    <nav class="md-nav" aria-label="Pre-processing parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain" class="md-nav__link">
    &amp;DOMAIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#walls" class="md-nav__link">
    &amp;WALLS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physics" class="md-nav__link">
    &amp;PHYSICS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#energybalance" class="md-nav__link">
    &amp;ENERGYBALANCE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chemistry" class="md-nav__link">
    &amp;CHEMISTRY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scalars" class="md-nav__link">
    &amp;SCALARS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inps" class="md-nav__link">
    &amp;INPS
  </a>
  
    <nav class="md-nav" aria-label="&amp;INPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-blocks-from-a-given-file" class="md-nav__link">
    Generate blocks from a given file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-blocks-from-lidar-data" class="md-nav__link">
    Generate blocks from LIDAR data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-simple-block-geometry" class="md-nav__link">
    Generate simple block geometry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    Run
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developers-guide" class="md-nav__link">
    Developer's guide
  </a>
  
    <nav class="md-nav" aria-label="Developer's guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-files" class="md-nav__link">
    Input files
  </a>
  
    <nav class="md-nav" aria-label="Input files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure-of-blocksinp" class="md-nav__link">
    Structure of blocks.inp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure-of-facetsinp" class="md-nav__link">
    Structure of facets.inp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure-of-walltypesinp" class="md-nav__link">
    Structure of walltypes.inp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-geometries" class="md-nav__link">
    Visualising geometries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../udales-post-processing/" class="md-nav__link">
      Post-processing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../udales-pub-list/" class="md-nav__link">
      Publication list
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../udales-docs-software/index.html" class="md-nav__link">
      Software docs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-processing-parameters" class="md-nav__link">
    Pre-processing parameters
  </a>
  
    <nav class="md-nav" aria-label="Pre-processing parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain" class="md-nav__link">
    &amp;DOMAIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#walls" class="md-nav__link">
    &amp;WALLS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physics" class="md-nav__link">
    &amp;PHYSICS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#energybalance" class="md-nav__link">
    &amp;ENERGYBALANCE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chemistry" class="md-nav__link">
    &amp;CHEMISTRY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scalars" class="md-nav__link">
    &amp;SCALARS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inps" class="md-nav__link">
    &amp;INPS
  </a>
  
    <nav class="md-nav" aria-label="&amp;INPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-blocks-from-a-given-file" class="md-nav__link">
    Generate blocks from a given file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-blocks-from-lidar-data" class="md-nav__link">
    Generate blocks from LIDAR data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-simple-block-geometry" class="md-nav__link">
    Generate simple block geometry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    Run
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developers-guide" class="md-nav__link">
    Developer's guide
  </a>
  
    <nav class="md-nav" aria-label="Developer's guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-files" class="md-nav__link">
    Input files
  </a>
  
    <nav class="md-nav" aria-label="Input files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure-of-blocksinp" class="md-nav__link">
    Structure of blocks.inp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure-of-facetsinp" class="md-nav__link">
    Structure of facets.inp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structure-of-walltypesinp" class="md-nav__link">
    Structure of walltypes.inp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-geometries" class="md-nav__link">
    Visualising geometries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="pre-processing">Pre-processing<a class="headerlink" href="#pre-processing" title="Permanent link">&para;</a></h1>
<p>This guide explains how to set up the input files of your simulation. The idea is that you already have a simulation set up, and now you want to modify some of the parameters of your simulation. If you do not have a simulation yet, have a look at the <a href="https://github.com/uDALES/u-dales/blob/master/docs/udales-getting-started.md#set-up">set-up</a> section in our getting started guide.</p>
<p>The parameters of the simulation are set in the <code>namoptions</code> file of your experiment. Some parameter changes require the additional <a href="#Input-files">input files</a> to be re-written, which will be done automatically by the pre-processing. The next section provides an overview of these parameters.</p>
<h2 id="pre-processing-parameters">Pre-processing parameters<a class="headerlink" href="#pre-processing-parameters" title="Permanent link">&para;</a></h2>
<p>Some parameters used by uDALES are also used in the pre-processing. They are the following:</p>
<h3 id="domain"><code>&amp;DOMAIN</code><a class="headerlink" href="#domain" title="Permanent link">&para;</a></h3>
<ul>
<li><code>imax</code>: number of cells in x-direction. Default: 64.</li>
<li><code>jtot</code>: number of cells in y-direction. Default: 64.</li>
<li><code>kmax</code>: number of cells in z-direction. Default: 96.</li>
<li><code>xsize</code>: domain size in x-direction (metres).</li>
<li><code>ysize</code>: domain size in y-direction (metres).</li>
</ul>
<h3 id="walls"><code>&amp;WALLS</code><a class="headerlink" href="#walls" title="Permanent link">&para;</a></h3>
<ul>
<li><code>nblocks</code>: number of blocks. The value is generated by the pre-processing routines, so if this parameter is omitted, <code>write_inputs.sh</code> (see below) will write it and its value. If it given, <code>write_inputs.sh</code> will overwrite the value.</li>
<li><code>nfcts</code>: number of facets. The value is generated by the pre-processing routines, so if this parameter is omitted, <code>write_inputs.sh</code> (see below) will write it and its value. If it given, <code>write_inputs.sh</code> will overwrite the value.</li>
</ul>
<h3 id="physics"><code>&amp;PHYSICS</code><a class="headerlink" href="#physics" title="Permanent link">&para;</a></h3>
<ul>
<li><code>luoutflowr</code>: switch that determines whether u-velocity is corrected to get a fixed outflow rate Default: false.</li>
<li><code>lvoutflowr</code>: switch that determines whether v-velocity is corrected to get a fixed outflow rate. Default: false.</li>
<li><code>luvolflowr</code>: switch that determines whether u-velocity is corrected to get a fixed volume flow rate. Default: false.</li>
<li><code>lvvolflowr</code>: switch that determines whether v-velocity is corrected to get a fixed volume flow rate. Default: false.</li>
<li><code>lcoriol</code>: switch for coriolis force. Default: false.</li>
<li><code>lprofforc</code>: switch for nudging flow to a profile. Default: false.</li>
</ul>
<p>Note only one forcing should be specified, i.e. one of <code>luoutflowr</code>/<code>lvoutflowr</code>,<code>luvolflowr</code>/<code>lvvolflowr</code>, <code>lprofforc</code>, or <code>lcoriol</code>.</p>
<h3 id="energybalance"><code>&amp;ENERGYBALANCE</code><a class="headerlink" href="#energybalance" title="Permanent link">&para;</a></h3>
<ul>
<li><code>lEB</code>: switch for energy balance. Default: false.</li>
</ul>
<h3 id="chemistry"><code>&amp;CHEMISTRY</code><a class="headerlink" href="#chemistry" title="Permanent link">&para;</a></h3>
<ul>
<li><code>lchem</code>: switch for chemistry.</li>
</ul>
<h3 id="scalars"><code>&amp;SCALARS</code><a class="headerlink" href="#scalars" title="Permanent link">&para;</a></h3>
<ul>
<li><code>nsv</code>: number of scalar variables. Default: 0. Note that <code>nsv &gt; 0</code> is not yet supported in the pre-processing.</li>
</ul>
<h3 id="inps"><code>&amp;INPS</code><a class="headerlink" href="#inps" title="Permanent link">&para;</a></h3>
<p>The parameters under the <code>&amp;INPS</code> header are used only in the pre-processing.</p>
<ul>
<li><code>zsize</code>: size of domain in z direction (metres).</li>
<li><code>maxsize</code>: maximum size of facets (metres or cells?). Default: 10 if using energy balance, infinity otherwise.</li>
<li><code>lzstretch</code>: switch for stretched z grid. Default: false.</li>
<li><code>lstretchexp</code>: switch for z grid stretched using exp function. Default: false.</li>
<li><code>lstretchtanh</code>: switch for z grid stretched using tanh function. Default: false.</li>
<li><code>lstretch2tanh</code>: switch for z grid stretched using 2tanh function. Default: false.</li>
<li><code>stretchconst</code>: stretch constant. Default: 0.01.</li>
<li><code>u0</code>: initial u-velocity (m/s). Also applied as geostrophic term where applicable. Default: 0.</li>
<li><code>v0</code>: initial v-velocity (m/s). Also applied as geostrophic term where applicable. Default: 0.</li>
<li><code>dpdx</code>: pressure gradient in x direction (Pa/m). Default: 0.</li>
<li><code>dpdy</code>: pressure gradient in y direction (Pa/m). Default: 0.</li>
<li><code>thl0</code>: temperature at z = 0. Default: 288.</li>
<li><code>facT</code>: facet temperature, or if <code>lEB = .true.</code> then initial facet temperature. Default: 288.</li>
<li><code>qt0</code>: specific humidity at z = 0. Default: 0.</li>
<li><code>lapse</code>: lapse rate (K/m). Default: 0.</li>
<li><code>w_s</code>: subsidence. Default: 0.</li>
<li><code>R</code>: radiative forcing (W/m^2). Default: 0.</li>
<li><code>NOb</code>: initial concentration of NO. Default: 0.</li>
<li><code>NO2b</code>: initial concentration of NO2b. Default: 0.</li>
<li><code>O3b</code>: initial concentration of O3b. Default: 0.</li>
</ul>
<p>If using the energy balance, the following parameters can also be specified.</p>
<ul>
<li><code>solaz</code>: solar azimuth (degrees). Default: 135.</li>
<li><code>Z</code>: solar zenith (degrees). Default: 28.4066.</li>
<li><code>I</code>: direct solar radiation (W/m^2). Default: 184.8775.</li>
<li><code>Dsk</code>: diffuse incoming radiation (W/m^2). Default: 418.8041.</li>
</ul>
<p>The following parameters relate to generating <code>blocks.inp</code>. Only one of the following three methods should be used.</p>
<h4 id="generate-blocks-from-a-given-file">Generate blocks from a given file<a class="headerlink" href="#generate-blocks-from-a-given-file" title="Permanent link">&para;</a></h4>
<ul>
<li><code>lblocksfile</code>: switch for generating blocks from a given file.</li>
<li><code>blocksfile</code>: name of blocks file (must be specified if <code>lblocksfile</code> is used).</li>
<li><code>ltxtblocks</code>: switch for generating blocks from a 2D ascii array</li>
<li><code>txtblocksfile</code>: name of blocks file (must be specified if <code>ltxtblocks</code> is used).</li>
</ul>
<h4 id="generate-blocks-from-lidar-data">Generate blocks from LIDAR data<a class="headerlink" href="#generate-blocks-from-lidar-data" title="Permanent link">&para;</a></h4>
<ul>
<li><code>llidar</code>: switch for generating blocks from LIDAR data. Default: false.</li>
<li><code>sourcename</code>: name of image file.</li>
<li><code>dxinp</code>: resolution of image in x direction (metres per pixel). Default: 1.</li>
<li><code>dyinp</code>: resolution of image in y direction (metres per pixel). Default: 1.</li>
<li><code>centeri</code>: center of area of interest in image (horizontal pixel). Default: 0.</li>
<li><code>centerj</code>: center of area of interest in image (vertical pixel). Default: 0.</li>
<li><code>maxh</code>: maximum height of buildings in image (metres). Default: 0.</li>
<li><code>pad</code>: padding (metres). Default: 5.</li>
<li><code>smallarea</code>: objects smaller than this area (metres) will be deleted. Default: round(150 / (dx * dy)), where dx = xsize / imax and dy = ysize / jtot.</li>
</ul>
<h4 id="generate-simple-block-geometry">Generate simple block geometry<a class="headerlink" href="#generate-simple-block-geometry" title="Permanent link">&para;</a></h4>
<ul>
<li><code>lflat</code>: switch for no blocks. Default: false.</li>
<li><code>lcube</code>: switch for linear cubes. Default: false.</li>
<li><code>lstaggered</code>: switch for staggered cubes. Default: false.</li>
<li><code>lcanyons</code>: switch for inifite canyons. Default: false.</li>
<li><code>lfloors</code>: switch for just floor facets. Default: false.</li>
<li><code>blockheight</code>: height of blocks (cells). Default: 16.</li>
<li><code>blockwidth</code>: width of blocks (cells). Default: 16.</li>
<li><code>canyonwidth</code>: width of canyon (cells). Default: 16.</li>
</ul>
<h2 id="run">Run<a class="headerlink" href="#run" title="Permanent link">&para;</a></h2>
<p>The <code>write_inputs.sh</code> shell script is a wrapper around the MATALB pre-processing functions of <code>preprocessing.m</code>. For more info about the functions see <a href="#developers-guide">Developer's guide</a>. The script requires several variables to be set up. Below is an example setup for copying and pasting. You can also specify these parameters in a <code>config.sh</code> file within the experiment directory, which is then read by the scripts.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

<span class="nb">export</span> <span class="nv">DA_TOOLSDIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/u-dales/tools <span class="c1"># Directory of the scripts</span>
<span class="nb">export</span> <span class="nv">DA_EXPDIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/experiments <span class="c1">#  The top-level directory of the simulation setups</span>
</code></pre></div>
<p>Then, to start the pre-processing, run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

<span class="c1"># General syntax: write_inputs.sh exp_id</span>
./u-dales/tools/write_inputs.sh <span class="m">009</span>
</code></pre></div>
<p>Replace 009 with the number of your simulation.</p>
<h2 id="developers-guide">Developer's guide<a class="headerlink" href="#developers-guide" title="Permanent link">&para;</a></h2>
<p>The <code>u-dales/tools/preprocessing.m</code> matlab class contains the functionality for preprocessing. The constructor reads the parameters in <code>namoptions</code> and stores them as member variables, and defines default variables for those not specified. These are then used in the member functions. In these member functions, additional data structures are also stored as member variables, including those used repeatedly and those eventually written to files, so that one can easily view and manipulate them using the matlab IDE.</p>
<p>The <code>u-dales/tools/write_inputs.m</code> matlab script calls member functions of <code>preprocessing.m</code> in order to write the necessary input files for uDALES. It is intended to be as short and readable as possible, with the goal being that a developer can edit for a particular purpose, perhaps by calling a member function they have added to <code>preprocessing.m</code>. It will work simply as a normal script using the matlab IDE, but when doing this, ensure that <code>DA_EXPDIR = &lt;top level directory&gt;/experiments/</code> and <code>DA_TOOLSDIR = &lt;top level directory&gt;/u-dales/tools/</code> are defined.</p>
<p>The <code>u-dales/tools/write_inputs.sh</code> shell script acts as a wrapper around <code>write_inputs.m</code>. Before running the matlab script, it will run the shell script <code>config.sh</code> located in the experiment directory, which defines environmental variables <code>DA_EXPDIR</code> and <code>DA_TOOLSDIR</code>. After running the script, it will also write the correct number of blocks and facets to <code>namoptions</code>. It is intended to be run from the top level project directory.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

<span class="c1"># General syntax: write_inputs.sh exp_id</span>
./u-dales/tools/write_inputs.sh <span class="m">009</span>
</code></pre></div>
<h3 id="input-files">Input files<a class="headerlink" href="#input-files" title="Permanent link">&para;</a></h3>
<p>uDALES requires a number of input files, all suffixed by the experiment number, which is omitted in the following documentation. The <code>namoptions.inp</code> file contains a list of parameters for uDALES and the pre-processing routines, and the pre-processing is intended to run using solely this file (with some exceptions). The input files are:</p>
<ul>
<li><code>xgrid.inp</code>: list of x grid values</li>
<li><code>zgrid.inp</code>: list of z grid values.</li>
<li><code>prof.inp</code>: initial profiles of flow variables (described in DALES documentation).</li>
<li><code>lscale.inp</code>: large-scale forcings (described in DALES documentation).</li>
<li><code>blocks.inp</code>: block position and corresponding facets (described below).</li>
<li><code>facets.inp</code>: facet orientation and corresponding block (described below).</li>
<li><code>Tfacinit.inp</code>: list of initial facet temperatures.</li>
<li><code>walltypes.inp</code>: a description of the properties of different types of facet (described below). This is copied to the experiment directory automatically.</li>
</ul>
<p>If using scalars, <code>scalar.inp</code> is also required to specifiy the initial scalar profiles.
When using the energy balance, the following additional files are required:</p>
<ul>
<li><code>facetarea.inp</code>: list of the areas of facets.</li>
<li><code>vf.nc.inp</code>: view factors of facets (stored as a netcdf file).</li>
<li><code>svf.inp</code>: list of the sky view factors of facets.</li>
<li><code>netsw.inp</code>: list of net shortwave radiation on facets.</li>
</ul>
<h4 id="structure-of-blocksinp">Structure of <code>blocks.inp</code><a class="headerlink" href="#structure-of-blocksinp" title="Permanent link">&para;</a></h4>
<p>Each row describes a block, with the first 6 columns giving the lower (l) and upper (u) limit in each direction (i,j,k), in the order: il, iu, jl, ju, kl, ku.
The next 5 columns give the facets that make up the faces of the block, in the order: top, west, east, north, south. (Note east is assumed to be aligned with the i-direction).</p>
<h4 id="structure-of-facetsinp">Structure of <code>facets.inp</code><a class="headerlink" href="#structure-of-facetsinp" title="Permanent link">&para;</a></h4>
<p>Each row describes a facet, with columns giving the orientation, wall type id, block id, and building id.</p>
<h4 id="structure-of-walltypesinp">Structure of <code>walltypes.inp</code><a class="headerlink" href="#structure-of-walltypesinp" title="Permanent link">&para;</a></h4>
<p>Each row describes a wall type, with the first 6 columns being: wall type id, a boolean for whether it is a 'green' facet or not, momentum roughness length, heat roughness length, albedo, and emissivity. Assuming that each facet is composed of 3 layers, the next 3 columns give the thickness of each, the next 3 give the volumetric heat capacity, the next 3 give the heat conductivity, and the final 4 give the thermal diffusivity at each interface between the layers.</p>
<p>For examples, please refer to the <a href="../udales-example-simulations/">example simulations</a>.</p>
<h3 id="visualising-geometries">Visualising geometries<a class="headerlink" href="#visualising-geometries" title="Permanent link">&para;</a></h3>
<p>There are a number of functions in the <code>preprocessing</code> class that can be called from the Matlab editor in order to visualise the geometry. Assuming the instance of the preprocessing class is named <code>r</code>, <code>plot_bl(r)</code> plots the buildings, <code>plot_blocks(r)</code> plots the buildings and the roads, and <code>plot_facets(r)</code> plots all the facets.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../udales-namoptions-overview/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Configuration
              </div>
            </div>
          </a>
        
        
          <a href="../udales-post-processing/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Post-processing
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            The uDALES Team
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>