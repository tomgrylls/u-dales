<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <meta name="description" content="Documentation for uDALES">
   
    <meta name="author" content="The uDALES Team" >
    <link rel="icon" href="../favicon.png">

    <title>modstartup.f90 &ndash; uDALES</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">uDALES </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/dalesurban.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/dalesurban.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>modstartup.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title="10.1% of total for source files.">1430 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/modstartup.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">modstartup.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/modstartup.html">modstartup</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/modstartup.f90.html#src">modstartup.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~modstartup.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilemodstartupf90EfferentGraph" width="641pt" height="532pt"
 viewBox="0.00 0.00 641.00 532.01" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~modstartup.f90~~EfferentGraph" class="graph" transform="scale(.6442 .6442) rotate(0) translate(4 821.8255)">
<title>sourcefile~~modstartup.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-821.8255 991,-821.8255 991,4 -4,4"/>
<!-- sourcefile~modstartup.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~modstartup.f90</title>
<polygon fill="none" stroke="#000000" points="987,-297.773 902,-297.773 902,-273.773 987,-273.773 987,-297.773"/>
<text text-anchor="middle" x="944.5" y="-283.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">modstartup.f90</text>
</g>
<!-- sourcefile~modpois.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~modpois.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/modpois.f90.html" xlink:title="modpois.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="858,-218.773 787,-218.773 787,-194.773 858,-194.773 858,-218.773"/>
<text text-anchor="middle" x="822.5" y="-204.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modpois.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modpois.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modpois.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M925.7049,-273.6023C905.4065,-260.4583 872.8786,-239.3952 849.7702,-224.4315"/>
<polygon fill="#ff0000" stroke="#ff0000" points="851.4126,-221.3253 841.1163,-218.8278 847.6078,-227.201 851.4126,-221.3253"/>
</g>
<!-- sourcefile~modinlet.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~modinlet.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/modinlet.f90.html" xlink:title="modinlet.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="606,-356.773 535,-356.773 535,-332.773 606,-332.773 606,-356.773"/>
<text text-anchor="middle" x="570.5" y="-342.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modinlet.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modinlet.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modinlet.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M694.5,-304.773C663.3716,-307.0707 629.7738,-318.5129 605.4127,-328.574"/>
<polygon fill="#ff0000" stroke="#ff0000" points="603.7283,-325.4872 595.9001,-332.6265 606.4718,-331.9272 603.7283,-325.4872"/>
</g>
<!-- sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~modsubgriddata.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/modsubgriddata.f90.html" xlink:title="modsubgriddata.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="329,-624.773 221,-624.773 221,-600.773 329,-600.773 329,-624.773"/>
<text text-anchor="middle" x="275" y="-610.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modsubgriddata.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modsubgriddata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M944.0359,-298.0948C940.5036,-373.0693 911.6581,-764.773 694.5,-764.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M694.5,-764.773C638.6972,-779.2132 626.567,-740.1507 570.5,-726.773"/>
</g>
<!-- sourcefile~modsubgrid.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~modsubgrid.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/modsubgrid.f90.html" xlink:title="modsubgrid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="866,-337.773 779,-337.773 779,-313.773 866,-313.773 866,-337.773"/>
<text text-anchor="middle" x="822.5" y="-323.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modsubgrid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modsubgrid.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modsubgrid.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M907.896,-297.7743C895.7031,-301.7719 881.9534,-306.28 869.1069,-310.492"/>
<polygon fill="#ff0000" stroke="#ff0000" points="867.9117,-307.2005 859.4999,-313.6419 870.0926,-313.8521 867.9117,-307.2005"/>
</g>
<!-- sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~modsurfdata.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/modsurfdata.f90.html" xlink:title="modsurfdata.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="320.5,-318.773 229.5,-318.773 229.5,-294.773 320.5,-294.773 320.5,-318.773"/>
<text text-anchor="middle" x="275" y="-304.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modsurfdata.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M694.5,-304.773C564.6861,-314.3551 411.6625,-311.5326 331.1091,-308.9555"/>
<polygon fill="#ff0000" stroke="#ff0000" points="330.8164,-305.444 320.706,-308.611 330.5847,-312.4402 330.8164,-305.444"/>
</g>
<!-- sourcefile~modthermodynamics.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~modthermodynamics.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/modthermodynamics.f90.html" xlink:title="modthermodynamics.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="495,-162.773 365,-162.773 365,-138.773 495,-138.773 495,-162.773"/>
<text text-anchor="middle" x="430" y="-148.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modthermodynamics.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modthermodynamics.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modthermodynamics.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M822.5,-108.773C769.808,-70.5197 579.0782,-112.1976 484.2703,-136.2203"/>
<polygon fill="#ff0000" stroke="#ff0000" points="483.3962,-132.8311 474.5755,-138.7001 485.1309,-139.6128 483.3962,-132.8311"/>
</g>
<!-- sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~modinletdata.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/modinletdata.f90.html" xlink:title="modinletdata.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="321,-478.773 229,-478.773 229,-454.773 321,-454.773 321,-478.773"/>
<text text-anchor="middle" x="275" y="-464.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modinletdata.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M822.5,-285.773C801.7544,-289.6081 794.795,-290.7871 779,-304.773 755.4312,-325.6422 763.489,-341.8728 743,-365.773 693.258,-423.7964 681.9675,-449.05 610,-474.773 516.728,-508.1107 399.3424,-493.5655 331.1748,-480.0828"/>
<polygon fill="#ff0000" stroke="#ff0000" points="331.5737,-476.5921 321.0757,-478.0214 330.1737,-483.4507 331.5737,-476.5921"/>
</g>
<!-- sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~modmpi.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/modmpi.f90.html" xlink:title="modmpi.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="69,-258.773 0,-258.773 0,-234.773 69,-234.773 69,-258.773"/>
<text text-anchor="middle" x="34.5" y="-244.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modmpi.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M939.374,-273.4613C925.452,-241.4985 883.823,-155.1452 822.5,-108.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M822.5,-108.773C769.7285,-68.8674 759.4468,-45.3904 694.5,-32.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M694.5,-32.773C640.4004,-22.2628 621.5701,-53.4873 570.5,-32.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M570.5,-32.773C448.7939,16.5917 401.7366,3.6811 275,-30.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M275,-30.773C215.8565,-41.9777 200.2913,-44.9743 145,-68.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M145,-68.773C80.5948,-96.4945 50.5285,-183.3995 39.6057,-224.6359"/>
<polygon fill="#ff0000" stroke="#ff0000" points="36.1642,-223.9708 37.1252,-234.5219 42.9537,-225.6744 36.1642,-223.9708"/>
</g>
<!-- sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~modfields.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/modfields.f90.html" xlink:title="modfields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="313,-238.773 237,-238.773 237,-214.773 313,-214.773 313,-238.773"/>
<text text-anchor="middle" x="275" y="-224.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modfields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M901.8078,-281.9921C878.2318,-280.8473 848.5346,-280.9601 822.5,-285.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M822.5,-285.773C765.946,-296.2278 749.2503,-284.3814 694.5,-266.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M694.5,-266.773C639.1077,-248.958 623.9096,-247.8617 570.5,-224.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M570.5,-224.773C511.5277,-199.2795 494.1276,-186.861 430,-190.773"/>
</g>
<!-- sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~modglobal.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/modglobal.f90.html" xlink:title="modglobal.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="185,-258.773 105,-258.773 105,-234.773 185,-234.773 185,-258.773"/>
<text text-anchor="middle" x="145" y="-244.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modglobal.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M694.5,-764.773C488.7967,-818.0032 340.8874,-874.1991 221,-698.773 217.8954,-694.2302 163.3793,-359.8587 148.6451,-269.2206"/>
<polygon fill="#ff0000" stroke="#ff0000" points="152.0744,-268.5021 147.0157,-259.1929 145.165,-269.6248 152.0744,-268.5021"/>
</g>
<!-- sourcefile~modboundary.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~modboundary.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/modboundary.f90.html" xlink:title="modboundary.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="743,-356.773 646,-356.773 646,-332.773 743,-332.773 743,-356.773"/>
<text text-anchor="middle" x="694.5" y="-342.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modboundary.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modboundary.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modboundary.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M822.5,-285.773C803.1473,-289.3506 757.5769,-311.7273 726.3779,-327.8654"/>
<polygon fill="#ff0000" stroke="#ff0000" points="724.4534,-324.9215 717.2019,-332.6458 727.6876,-331.1296 724.4534,-324.9215"/>
</g>
<!-- sourcefile~moddriver.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~moddriver.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/moddriver.f90.html" xlink:title="moddriver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="610,-276.773 531,-276.773 531,-252.773 610,-252.773 610,-276.773"/>
<text text-anchor="middle" x="570.5" y="-262.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">moddriver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~moddriver.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~moddriver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M822.5,-285.773C765.946,-296.2278 751.8562,-300.5392 694.5,-304.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M694.5,-304.773C661.2417,-307.2279 625.1646,-293.5889 600.5457,-281.5788"/>
<polygon fill="#ff0000" stroke="#ff0000" points="601.8817,-278.3318 591.3808,-276.9235 598.7115,-284.5728 601.8817,-278.3318"/>
</g>
<!-- sourcefile~modibmdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~modibmdata.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/modibmdata.f90.html" xlink:title="modibmdata.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="320,-120.773 230,-120.773 230,-96.773 320,-96.773 320,-120.773"/>
<text text-anchor="middle" x="275" y="-106.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modibmdata.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modibmdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modibmdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M694.5,-32.773C637.917,-21.7803 628.1358,-70.0063 570.5,-70.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M570.5,-70.773C535.6737,-71.2362 529.5095,-54.4829 495,-49.773 437.7529,-41.9597 418.8474,-28.8272 365,-49.773 344.7714,-57.6416 346.971,-70.601 329,-82.773 324.0881,-86.0998 318.6856,-89.2345 313.2546,-92.0975"/>
<polygon fill="#ff0000" stroke="#ff0000" points="311.5449,-89.0392 304.1694,-96.6453 314.6783,-95.2988 311.5449,-89.0392"/>
</g>
<!-- sourcefile~modforces.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~modforces.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/modforces.f90.html" xlink:title="modforces.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="470.5,-82.773 389.5,-82.773 389.5,-58.773 470.5,-58.773 470.5,-82.773"/>
<text text-anchor="middle" x="430" y="-68.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modforces.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modforces.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modforces.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M570.5,-70.773C540.7859,-71.1682 507.5338,-71.1873 480.8405,-71.0987"/>
<polygon fill="#ff0000" stroke="#ff0000" points="480.5945,-67.5978 470.5807,-71.0583 480.5669,-74.5977 480.5945,-67.5978"/>
</g>
<!-- sourcefile~modpois.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~modpois.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M810.2803,-194.4883C776.0989,-161.0552 675.1388,-68.5465 570.5,-32.773"/>
</g>
<!-- sourcefile~modpois.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~modpois.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M570.5,-186.773C508.5209,-178.9588 492.3538,-186.9692 430,-190.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M430,-190.773C392.7149,-193.0474 351.575,-202.9624 321.0541,-211.8122"/>
<polygon fill="#ff0000" stroke="#ff0000" points="319.7207,-208.5571 311.1316,-214.76 321.7142,-215.2672 319.7207,-208.5571"/>
</g>
<!-- sourcefile~modpois.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~modpois.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M786.9211,-204.9879C738.0201,-202.2979 647.3532,-196.4624 570.5,-186.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M570.5,-186.773C529.0877,-179.5084 534.8659,-143.1319 495,-129.773 440.2162,-111.4151 422.1707,-121.4193 365,-129.773 298.9093,-139.43 278.591,-138.9424 221,-172.773 197.0663,-186.8323 174.9699,-209.9886 160.844,-226.656"/>
<polygon fill="#ff0000" stroke="#ff0000" points="157.8752,-224.755 154.2161,-234.698 163.277,-229.2071 157.8752,-224.755"/>
</g>
<!-- sourcefile~modpois.f90&#45;&gt;sourcefile~modboundary.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~modpois.f90&#45;&gt;sourcefile~modboundary.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M814.3124,-218.9631C795.8706,-246.3226 751.986,-310.8469 743,-318.773 739.384,-321.9624 735.3087,-324.9048 731.0959,-327.5736"/>
<polygon fill="#ff0000" stroke="#ff0000" points="729.2404,-324.6038 722.3581,-332.6589 732.7615,-330.6538 729.2404,-324.6038"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#ff6d00" stroke-dasharray="5,2" d="M430,-342.773C396.8155,-336.7184 360.0247,-328.2496 330.6172,-321.047"/>
<polygon fill="#ff6d00" stroke="#ff6d00" points="331.0889,-317.5583 320.5413,-318.5581 329.4102,-324.3541 331.0889,-317.5583"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#ff6d00" stroke-dasharray="5,2" d="M564.3726,-356.8959C553.3458,-377.4804 528.1824,-419.2228 495,-441.773 470.1065,-458.6901 459.4042,-454.3488 430,-460.773"/>
<path fill="none" stroke="#ff6d00" stroke-dasharray="5,2" d="M430,-460.773C397.8754,-467.7914 361.1335,-469.4797 331.4871,-469.3258"/>
<polygon fill="#ff6d00" stroke="#ff6d00" points="331.3584,-465.824 321.3159,-469.2002 331.2719,-472.8235 331.3584,-465.824"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff6d00" stroke-dasharray="5,2" d="M567.45,-357.0827C560.1201,-383.7785 538.7854,-446.837 495,-474.773 429.1576,-516.7816 197.2496,-564.824 145,-506.773"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ff6d00" stroke-dasharray="5,2" d="M540.265,-332.6994C486.6196,-311.2776 374.8098,-266.6293 314.9146,-242.7118"/>
<polygon fill="#ff6d00" stroke="#ff6d00" points="315.998,-239.3757 305.4131,-238.9176 313.4021,-245.8766 315.998,-239.3757"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff6d00" stroke-dasharray="5,2" d="M534.9634,-347.4946C506.3681,-348.9135 465.278,-349.2095 430,-342.773"/>
<path fill="none" stroke="#ff6d00" stroke-dasharray="5,2" d="M430,-342.773C379.293,-333.5214 375.9361,-307.0755 329,-285.773 305.8323,-275.258 300.2028,-270.2555 275,-266.773"/>
</g>
<!-- sourcefile~modsave.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~modsave.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/modsave.f90.html" xlink:title="modsave.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="467,-432.773 393,-432.773 393,-408.773 467,-408.773 467,-432.773"/>
<text text-anchor="middle" x="430" y="-418.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modsave.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modsave.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modsave.f90</title>
<path fill="none" stroke="#ff6d00" stroke-dasharray="5,2" d="M548.2374,-356.8154C524.8422,-369.4704 487.8457,-389.4828 461.4704,-403.7498"/>
<polygon fill="#ff6d00" stroke="#ff6d00" points="459.7541,-400.6989 452.6237,-408.5352 463.0846,-406.8558 459.7541,-400.6989"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modsubgriddata.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M694.5,-726.773C650.1736,-759.5206 624.4222,-738.1586 570.5,-726.773"/>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M570.5,-726.773C471.0225,-705.7683 361.092,-655.6362 307.7013,-629.409"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="309.2248,-626.2578 298.7103,-624.9549 306.1173,-632.5303 309.2248,-626.2578"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M803.3797,-337.8448C787.7582,-347.0916 764.7775,-359.3233 743,-365.773 669.0449,-387.6756 647.5658,-381.6199 570.5,-384.773"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M820.6793,-337.8824C811.0682,-399.9447 764.0322,-681.2166 694.5,-726.773"/>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M694.5,-726.773C661.299,-748.5257 396.2121,-613.2941 365,-588.773 329.0552,-560.5337 300.4596,-514.4612 285.7848,-487.7485"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="288.8267,-486.0149 281.0203,-478.8518 282.6559,-489.3196 288.8267,-486.0149"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M570.5,-764.773C482.5839,-791.0703 451.0285,-816.7087 365,-784.773 285.8212,-755.38 272.7271,-727.5378 221,-660.773 174.254,-600.4373 198.0011,-561.6953 145,-506.773"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M800.5005,-313.635C775.509,-300.325 733.1684,-279.2093 694.5,-266.773"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M694.5,-726.773C648.1389,-761.0238 625.884,-748.8018 570.5,-764.773"/>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M570.5,-764.773C411.1087,-810.7368 325.567,-762.5518 221,-633.773 209.2517,-619.3045 162.5003,-349.437 148.7947,-269.1324"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="152.2164,-268.3759 147.0872,-259.1055 145.3157,-269.5511 152.2164,-268.3759"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modboundary.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modboundary.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M778.8077,-332.2585C770.5831,-333.4794 761.8594,-334.7743 753.2626,-336.0504"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="752.6441,-332.6037 743.2664,-337.5342 753.672,-339.5279 752.6441,-332.6037"/>
</g>
<!-- sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#00ff24" stroke-dasharray="5,2" d="M415.3411,-162.9466C401.2964,-175.0997 380.0681,-194.7967 365,-214.773 344.8787,-241.4484 353.2171,-257.7518 329,-280.773 325.5074,-284.0931 321.5112,-287.0628 317.3079,-289.7004"/>
<polygon fill="#00ff24" stroke="#00ff24" points="315.491,-286.7064 308.4841,-294.6534 318.9175,-292.8105 315.491,-286.7064"/>
</g>
<!-- sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#00ff24" stroke-dasharray="5,2" d="M397.5497,-162.7751C366.5348,-173.1723 318.2343,-186.5843 275,-186.773"/>
<path fill="none" stroke="#00ff24" stroke-dasharray="5,2" d="M275,-186.773C196.9707,-187.1135 216.6728,-37.9233 145,-68.773"/>
</g>
<!-- sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#00ff24" stroke-dasharray="5,2" d="M395.9997,-162.8356C385.8312,-166.8502 374.7885,-171.6239 365,-176.773 347.9814,-185.7253 345.7034,-191.2455 329,-200.773 323.3653,-203.987 317.2724,-207.1775 311.2787,-210.1655"/>
<polygon fill="#00ff24" stroke="#00ff24" points="309.4834,-207.1466 302.0219,-214.6683 312.5454,-213.4414 309.4834,-207.1466"/>
</g>
<!-- sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#00ff24" stroke-dasharray="5,2" d="M275,-186.773C234.5315,-186.9496 192.9582,-211.1679 168.0523,-228.7776"/>
<polygon fill="#00ff24" stroke="#00ff24" points="165.9798,-225.9572 159.9671,-234.6806 170.1075,-231.6108 165.9798,-225.9572"/>
</g>
<!-- sourcefile~modfields.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~modfields.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M236.6988,-232.6654C223.8074,-234.6487 209.22,-236.893 195.534,-238.9985"/>
<polygon fill="#0091ff" stroke="#0091ff" points="194.6384,-235.595 185.2869,-240.575 195.7029,-242.5136 194.6384,-235.595"/>
</g>
<!-- sourcefile~modglobal.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~modglobal.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#0024ff" stroke-dasharray="5,2" d="M104.7944,-246.773C96.4589,-246.773 87.6289,-246.773 79.1455,-246.773"/>
<polygon fill="#0024ff" stroke="#0024ff" points="79.0261,-243.2731 69.0261,-246.773 79.0261,-250.2731 79.0261,-243.2731"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modinlet.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modinlet.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M645.8478,-344.773C636.1813,-344.773 626.0603,-344.773 616.4863,-344.773"/>
<polygon fill="#4800ff" stroke="#4800ff" points="616.3595,-341.2731 606.3594,-344.773 616.3594,-348.2731 616.3595,-341.2731"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modsubgriddata.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M688.6913,-357.0526C676.6491,-381.5895 646.9751,-437.5157 610,-474.773 535.3087,-550.0343 413.7278,-586.0158 339.3951,-601.8143"/>
<polygon fill="#4800ff" stroke="#4800ff" points="338.3163,-598.4631 329.2298,-603.9116 339.7308,-605.3187 338.3163,-598.4631"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M669.5764,-356.8385C645.0383,-367.739 606.1626,-382.4256 570.5,-384.773"/>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M570.5,-384.773C478.5218,-390.827 448.4491,-395.925 365,-356.773 345.3501,-347.5538 347.7986,-334.6231 329,-323.773 328.7047,-323.6025 328.4075,-323.4336 328.1085,-323.2662"/>
<polygon fill="#4800ff" stroke="#4800ff" points="329.5474,-320.0737 319.0271,-318.8191 326.4689,-326.3604 329.5474,-320.0737"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M684.9954,-356.9931C665.9123,-380.6791 620.4645,-432.9487 570.5,-460.773"/>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M570.5,-460.773C515.9444,-491.1539 491.0055,-447.4447 430,-460.773"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M691.1432,-357.0494C682.3206,-387.4441 655.9378,-467.3799 610,-517.773 569.69,-561.9923 549.9104,-564.0013 495,-587.773 381.6812,-636.8306 328.4188,-694.6746 221,-633.773 163.7777,-601.3304 188.3507,-556.2465 145,-506.773"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M664.7394,-332.6354C657.9999,-328.9068 651.2826,-324.2965 646,-318.773 620.4443,-292.0519 636.1341,-269.9286 610,-243.773 596.2306,-229.9922 588.3816,-232.5031 570.5,-224.773"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M570.5,-460.773C536.4716,-479.7227 252.4108,-510.8031 221,-487.773 184.8381,-461.2593 157.9688,-323.4245 148.6089,-268.9547"/>
<polygon fill="#4800ff" stroke="#4800ff" points="152.036,-268.2287 146.9264,-258.9475 145.1329,-269.3894 152.036,-268.2287"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~moddriver.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~moddriver.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M670.472,-332.6766C662.555,-328.4848 653.7878,-323.6174 646,-318.773 628.1556,-307.6726 608.8997,-293.8689 594.3008,-282.9965"/>
<polygon fill="#4800ff" stroke="#4800ff" points="596.3863,-280.1856 586.2892,-276.9763 592.1811,-285.7817 596.3863,-280.1856"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#b600ff" stroke-dasharray="5,2" d="M430,-228.773C339.5582,-241.594 379.394,-331.5854 329,-407.773 319.507,-422.1248 306.5511,-436.4072 295.7093,-447.3243"/>
<polygon fill="#b600ff" stroke="#b600ff" points="292.9506,-445.1279 288.2681,-454.6318 297.8554,-450.1223 292.9506,-445.1279"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#b600ff" stroke-dasharray="5,2" d="M561.3812,-252.6628C552.4373,-240.2438 539.0102,-220.0674 531,-200.773 504.5467,-137.0538 547.2556,-94.8202 495,-49.773 420.666,14.3072 369.7823,-5.3149 275,-30.773"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#b600ff" stroke-dasharray="5,2" d="M546.708,-252.718C519.0215,-240.0917 471.7596,-222.8531 430,-228.773"/>
<path fill="none" stroke="#b600ff" stroke-dasharray="5,2" d="M430,-228.773C394.45,-233.8125 353.855,-233.056 323.1292,-231.176"/>
<polygon fill="#b600ff" stroke="#b600ff" points="323.3214,-227.6811 313.1091,-230.5021 322.8517,-234.6653 323.3214,-227.6811"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#b600ff" stroke-dasharray="5,2" d="M430,-228.773C359.7732,-238.7283 345.2613,-276.4817 275,-266.773"/>
<path fill="none" stroke="#b600ff" stroke-dasharray="5,2" d="M275,-266.773C248.577,-263.1218 219.2004,-258.6385 195.0672,-254.8427"/>
<polygon fill="#b600ff" stroke="#b600ff" points="195.4932,-251.3667 185.0693,-253.2624 194.4003,-258.2808 195.4932,-251.3667"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modsave.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modsave.f90</title>
<path fill="none" stroke="#b600ff" stroke-dasharray="5,2" d="M561.1204,-277.0231C547.219,-294.9849 520.0829,-329.3125 495,-356.773 480.8482,-372.2662 463.9331,-388.8663 450.9062,-401.277"/>
<polygon fill="#b600ff" stroke="#b600ff" points="448.2181,-399.0019 443.357,-408.4157 453.0276,-404.088 448.2181,-399.0019"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#ff006d" stroke-dasharray="5,2" d="M411.4826,-82.8335C396.6794,-93.4454 376.5559,-110.2252 365,-129.773 329.8907,-189.1635 372.2774,-227.0425 329,-280.773 326.4657,-283.9194 323.458,-286.7094 320.1786,-289.1789"/>
<polygon fill="#ff006d" stroke="#ff006d" points="318.1209,-286.3403 311.5828,-294.6772 321.8928,-292.2372 318.1209,-286.3403"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff006d" stroke-dasharray="5,2" d="M389.2437,-63.6405C357.4258,-59.6327 312.48,-57.4368 275,-68.773"/>
<path fill="none" stroke="#ff006d" stroke-dasharray="5,2" d="M275,-68.773C219.6965,-85.5 198.0705,-45.9302 145,-68.773"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ff006d" stroke-dasharray="5,2" d="M413.4884,-82.9531C399.3282,-94.0067 379.047,-111.3527 365,-129.773 343.546,-157.9062 354.2732,-176.0137 329,-200.773 325.6913,-204.0144 321.9005,-206.9147 317.8952,-209.4945"/>
<polygon fill="#ff006d" stroke="#ff006d" points="315.8365,-206.6396 308.8885,-214.6382 319.3079,-212.7182 315.8365,-206.6396"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff006d" stroke-dasharray="5,2" d="M275,-68.773C250.6473,-76.1387 239.9314,-70.7756 221,-87.773 179.2984,-125.2142 158.3635,-190.4802 149.8275,-224.5827"/>
<polygon fill="#ff006d" stroke="#ff006d" points="146.3812,-223.9475 147.4811,-234.4851 153.1926,-225.5616 146.3812,-223.9475"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modibmdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modibmdata.f90</title>
<path fill="none" stroke="#ff006d" stroke-dasharray="5,2" d="M389.2756,-80.757C371.0903,-85.2153 349.3881,-90.5359 329.8059,-95.3367"/>
<polygon fill="#ff006d" stroke="#ff006d" points="328.9684,-91.9383 320.0895,-97.7188 330.6353,-98.7369 328.9684,-91.9383"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modsubgriddata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M420.3041,-432.7834C394.371,-464.9069 323.21,-553.0547 291.0972,-592.8333"/>
<polygon fill="#ff0000" stroke="#ff0000" points="288.2505,-590.7875 284.6923,-600.767 293.6971,-595.1846 288.2505,-590.7875"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M392.8793,-410.7793C383.0707,-406.9037 373.0008,-401.6864 365,-394.773 340.8901,-373.9398 352.3854,-354.4162 329,-332.773 325.418,-329.4578 321.3358,-326.4847 317.0568,-323.8395"/>
<polygon fill="#ff0000" stroke="#ff0000" points="318.5369,-320.658 308.0948,-318.8659 315.1402,-326.7787 318.5369,-320.658"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M392.8736,-431.7911C372.6804,-437.7839 347.4135,-445.2825 325.4575,-451.7985"/>
<polygon fill="#ff0000" stroke="#ff0000" points="324.2236,-448.5137 315.6326,-454.7142 326.2152,-455.2244 324.2236,-448.5137"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge63" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M392.9546,-419.1755C349.9223,-418.6595 277.6015,-421.9957 221,-445.773 181.0681,-462.5476 174.1083,-538.8456 145,-506.773"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M414.0318,-408.668C399.4416,-396.8586 378.19,-377.6626 365,-356.773 338.8857,-315.4143 361.5332,-289.298 329,-252.773 326.1193,-249.5388 322.7477,-246.6689 319.121,-244.1305"/>
<polygon fill="#ff0000" stroke="#ff0000" points="320.6738,-240.9791 310.3069,-238.7933 317.048,-246.9669 320.6738,-240.9791"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge62" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M394.3516,-408.7211C384.5576,-404.8253 374.127,-400.1122 365,-394.773 347.2659,-384.3986 346.9489,-375.771 329,-365.773 284.5467,-341.0113 263.6248,-355.5643 221,-327.773 196.013,-311.4814 173.4739,-285.3038 159.5476,-267.1356"/>
<polygon fill="#ff0000" stroke="#ff0000" points="162.216,-264.8593 153.4299,-258.9386 156.6061,-269.0461 162.216,-264.8593"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modibmdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modibmdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M412.7652,-408.6199C397.723,-397.0517 376.5463,-378.2552 365,-356.773 325.5499,-283.3748 365.0222,-247.9129 329,-172.773 320.9577,-155.9973 307.4623,-140.001 295.9752,-128.1968"/>
<polygon fill="#ff0000" stroke="#ff0000" points="298.3603,-125.6328 288.7941,-121.079 293.4326,-130.6045 298.3603,-125.6328"/>
</g>
<!-- sourcefile~initfac.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~initfac.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/initfac.f90.html" xlink:title="initfac.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="304,-398.773 246,-398.773 246,-374.773 304,-374.773 304,-398.773"/>
<text text-anchor="middle" x="275" y="-384.373" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">initfac.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~initfac.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge61" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~initfac.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M392.8736,-412.6291C369.0503,-407.4034 338.1653,-400.6286 313.9864,-395.3248"/>
<polygon fill="#ff0000" stroke="#ff0000" points="314.5924,-391.8746 304.0747,-393.1506 313.0925,-398.712 314.5924,-391.8746"/>
</g>
<!-- sourcefile~initfac.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge65" class="edge">
<title>sourcefile~initfac.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M245.8699,-397.9266C237.3919,-401.91 228.4229,-406.8945 221,-412.773 178.8831,-446.1269 181.1059,-546.5559 145,-506.773"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M145,-506.773C79.406,-434.4989 49.0192,-317.481 38.7394,-268.9537"/>
<polygon fill="#ff0000" stroke="#ff0000" points="42.1202,-268.0149 36.696,-258.9138 35.2608,-269.411 42.1202,-268.0149"/>
</g>
<!-- sourcefile~initfac.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge64" class="edge">
<title>sourcefile~initfac.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M245.8033,-376.167C237.2292,-372.179 228.2235,-367.0545 221,-360.773 190.7106,-334.4335 167.3301,-293.2839 154.9115,-268.2942"/>
<polygon fill="#ff0000" stroke="#ff0000" points="157.9096,-266.4534 150.4133,-258.9664 151.6044,-269.4941 157.9096,-266.4534"/>
</g>
</g>
</svg>
</div><script>var pansourcefilemodstartupf90EfferentGraph = svgPanZoom('#sourcefilemodstartupf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~modstartup.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilemodstartupf90AfferentGraph" width="200pt" height="32pt"
 viewBox="0.00 0.00 200.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~modstartup.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~modstartup.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 196,-28 196,4 -4,4"/>
<!-- sourcefile~modstartup.f90 -->
<g id="sourcefile~~modstartup.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~modstartup.f90</title>
<polygon fill="none" stroke="#000000" points="85,-24 0,-24 0,0 85,0 85,-24"/>
<text text-anchor="middle" x="42.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">modstartup.f90</text>
</g>
<!-- sourcefile~program.f90 -->
<g id="sourcefile~~modstartup.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~program.f90</title>
<g id="a_sourcefile~~modstartup.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/program.f90.html" xlink:title="program.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="192,-24 121,-24 121,0 192,0 192,-24"/>
<text text-anchor="middle" x="156.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">program.f90</text>
</a>
</g>
</g>
<!-- sourcefile~program.f90&#45;&gt;sourcefile~modstartup.f90 -->
<g id="sourcefile~~modstartup.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~program.f90&#45;&gt;sourcefile~modstartup.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M120.7425,-12C112.7578,-12 104.1241,-12 95.6069,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="95.327,-8.5001 85.327,-12 95.327,-15.5001 95.327,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/modstartup.html">modstartup</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/modstartup.f90.html#src">modstartup.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!&gt; \file modstartup.f90</span>
<a name="ln-2"></a><span class="c">!!  Initializes the run</span>
<a name="ln-3"></a>
<a name="ln-4"></a><span class="c">!&gt;</span>
<a name="ln-5"></a><span class="c">!! Initializes the run.</span>
<a name="ln-6"></a><span class="c">!&gt;</span>
<a name="ln-7"></a><span class="c">!! Modstartup reads the namelists and initial data, sets the fields and calls</span>
<a name="ln-8"></a><span class="c">!! the inits of the other routines where necessary. Reading of the</span>
<a name="ln-9"></a><span class="c">!! restart files also live in this module.</span>
<a name="ln-10"></a><span class="c">!!  \author Jasper Tomas, TU Delft</span>
<a name="ln-11"></a><span class="c">!!  \author Chiel van Heerwaarden, Wageningen U.R.</span>
<a name="ln-12"></a><span class="c">!!  \author Thijs Heus,MPI-M</span>
<a name="ln-13"></a><span class="c">!!  \todo documentation</span>
<a name="ln-14"></a><span class="c">!!  \par Revision list</span>
<a name="ln-15"></a><span class="c">!</span>
<a name="ln-16"></a>
<a name="ln-17"></a><span class="k">module </span><span class="n">modstartup</span>
<a name="ln-18"></a>
<a name="ln-19"></a>   <span class="k">implicit none</span>
<a name="ln-20"></a>   <span class="c">! private</span>
<a name="ln-21"></a>   <span class="c">! public :: startup,trestart</span>
<a name="ln-22"></a>   <span class="k">save</span>
<a name="ln-23"></a>
<a name="ln-24"></a><span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">KIND</span><span class="o">=</span><span class="nb">selected_int_kind</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="kd">::</span> <span class="n">irandom</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">!    * number to seed the randomnizer with</span>
<a name="ln-25"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">krand</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">! returns the largest integer that is not an infinity</span>
<a name="ln-26"></a>   <span class="kt">real</span> <span class="kd">::</span> <span class="n">randu</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">randthl</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">randqt</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c">!    * uvw,thl and qt amplitude of randomnization</span>
<a name="ln-27"></a>
<a name="ln-28"></a>   <span class="k">contains</span>
<a name="ln-29"></a><span class="k">   subroutine </span><span class="n">startup</span>
<a name="ln-30"></a>
<a name="ln-31"></a>      <span class="c">!-----------------------------------------------------------------|</span>
<a name="ln-32"></a>      <span class="c">!                                                                 |</span>
<a name="ln-33"></a>      <span class="c">!     Reads all general options from namoptions                   |</span>
<a name="ln-34"></a>      <span class="c">!                                                                 |</span>
<a name="ln-35"></a>      <span class="c">!      Jasper Tomas                 31/03/2014                    |</span>
<a name="ln-36"></a>      <span class="c">!      Chiel van Heerwaarden        15/06/2007                    |</span>
<a name="ln-37"></a>      <span class="c">!      Thijs Heus                   15/06/2007                    |</span>
<a name="ln-38"></a>      <span class="c">!-----------------------------------------------------------------|</span>
<a name="ln-39"></a>
<a name="ln-40"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">initglobal</span><span class="p">,</span> <span class="n">iexpnr</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">dtmax</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-41"></a>         <span class="n">lwarmstart</span><span class="p">,</span> <span class="n">lstratstart</span><span class="p">,</span> <span class="n">lfielddump</span><span class="p">,</span> <span class="n">lreadscal</span><span class="p">,</span> <span class="n">startfile</span><span class="p">,</span> <span class="n">tfielddump</span><span class="p">,</span> <span class="n">fieldvars</span><span class="p">,</span> <span class="n">tsample</span><span class="p">,</span> <span class="n">tstatsdump</span><span class="p">,</span> <span class="n">trestart</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-42"></a>         <span class="n">nsv</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jtot</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="n">xlat</span><span class="p">,</span> <span class="n">xlon</span><span class="p">,</span> <span class="n">xday</span><span class="p">,</span> <span class="n">xtime</span><span class="p">,</span> <span class="n">lwalldist</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-43"></a>         <span class="n">lmoist</span><span class="p">,</span> <span class="n">lcoriol</span><span class="p">,</span> <span class="n">igrw_damp</span><span class="p">,</span> <span class="n">geodamptime</span><span class="p">,</span> <span class="n">ifnamopt</span><span class="p">,</span> <span class="n">fname_options</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-44"></a>         <span class="n">xS</span><span class="p">,</span><span class="n">yS</span><span class="p">,</span><span class="n">zS</span><span class="p">,</span><span class="n">SS</span><span class="p">,</span><span class="n">sigS</span><span class="p">,</span><span class="n">iwallmom</span><span class="p">,</span><span class="n">iwalltemp</span><span class="p">,</span><span class="n">iwallmoist</span><span class="p">,</span><span class="n">iwallscal</span><span class="p">,</span><span class="n">ipoiss</span><span class="p">,</span><span class="n">iadv_mom</span><span class="p">,</span><span class="n">iadv_tke</span><span class="p">,</span><span class="n">iadv_thl</span><span class="p">,</span><span class="n">iadv_qt</span><span class="p">,</span><span class="n">iadv_sv</span><span class="p">,</span><span class="n">courant</span><span class="p">,</span><span class="n">diffnr</span><span class="p">,</span><span class="n">ladaptive</span><span class="p">,</span><span class="n">author</span><span class="p">,&amp;</span>
<a name="ln-45"></a>         <span class="n">linoutflow</span><span class="p">,</span> <span class="n">lper2inout</span><span class="p">,</span> <span class="n">libm</span><span class="p">,</span> <span class="n">lnudge</span><span class="p">,</span> <span class="n">tnudge</span><span class="p">,</span> <span class="n">nnudge</span><span class="p">,</span> <span class="n">lles</span><span class="p">,</span> <span class="n">luoutflowr</span><span class="p">,</span> <span class="n">lvoutflowr</span><span class="p">,</span> <span class="n">luvolflowr</span><span class="p">,</span> <span class="n">lvvolflowr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-46"></a>         <span class="n">uflowrate</span><span class="p">,</span> <span class="n">vflowrate</span><span class="p">,</span> <span class="n">lstoreplane</span><span class="p">,</span> <span class="n">iplane</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-47"></a>         <span class="n">lreadmean</span><span class="p">,</span> <span class="n">iinletgen</span><span class="p">,</span> <span class="n">inletav</span><span class="p">,</span> <span class="n">lreadminl</span><span class="p">,</span> <span class="n">Uinf</span><span class="p">,</span> <span class="n">Vinf</span><span class="p">,</span> <span class="n">linletRA</span><span class="p">,</span> <span class="n">nblocks</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-48"></a>         <span class="n">lscalrec</span><span class="p">,</span><span class="n">lSIRANEinout</span><span class="p">,</span><span class="n">lscasrc</span><span class="p">,</span><span class="n">lscasrcl</span><span class="p">,</span><span class="n">lscasrcr</span><span class="p">,</span><span class="n">lydump</span><span class="p">,</span><span class="n">lytdump</span><span class="p">,</span><span class="n">lxydump</span><span class="p">,</span><span class="n">lxytdump</span><span class="p">,</span><span class="n">lslicedump</span><span class="p">,</span><span class="n">ltdump</span><span class="p">,</span><span class="n">ltkedump</span><span class="p">,</span><span class="n">lzerogradtop</span><span class="p">,&amp;</span>
<a name="ln-49"></a>         <span class="n">lzerogradtopscal</span><span class="p">,</span> <span class="n">lbuoyancy</span><span class="p">,</span> <span class="n">ltempeq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-50"></a>         <span class="n">lfixinlet</span><span class="p">,</span> <span class="n">lfixutauin</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-51"></a>         <span class="n">thlsrc</span><span class="p">,</span> <span class="n">ifixuinf</span><span class="p">,</span> <span class="n">lvinf</span><span class="p">,</span> <span class="n">tscale</span><span class="p">,</span> <span class="n">ltempinout</span><span class="p">,</span> <span class="n">lmoistinout</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-52"></a>         <span class="n">lwallfunc</span><span class="p">,</span><span class="n">lprofforc</span><span class="p">,</span><span class="n">lchem</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">JNO2</span><span class="p">,</span><span class="n">rv</span><span class="p">,</span><span class="n">rd</span><span class="p">,</span><span class="n">tnextEB</span><span class="p">,</span><span class="n">tEB</span><span class="p">,</span><span class="n">dtEB</span><span class="p">,</span><span class="n">bldT</span><span class="p">,</span><span class="n">wsoil</span><span class="p">,</span><span class="n">wgrmax</span><span class="p">,</span><span class="n">wwilt</span><span class="p">,</span><span class="n">wfc</span><span class="p">,</span><span class="n">skyLW</span><span class="p">,</span><span class="n">GRLAI</span><span class="p">,</span><span class="n">rsmin</span><span class="p">,</span><span class="n">nfcts</span><span class="p">,</span><span class="n">lEB</span><span class="p">,</span><span class="n">lwriteEBfiles</span><span class="p">,</span><span class="n">nwalllayers</span><span class="p">,</span><span class="n">lconstW</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-53"></a>         <span class="n">BCxm</span><span class="p">,</span><span class="n">BCxT</span><span class="p">,</span><span class="n">BCxq</span><span class="p">,</span><span class="n">BCxs</span><span class="p">,</span><span class="n">BCym</span><span class="p">,</span><span class="n">BCyT</span><span class="p">,</span><span class="n">BCyq</span><span class="p">,</span><span class="n">BCys</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-54"></a>         <span class="n">BCtopm</span><span class="p">,</span><span class="n">BCtopT</span><span class="p">,</span><span class="n">BCtopq</span><span class="p">,</span><span class="n">BCtops</span><span class="p">,</span><span class="n">BCbotm</span><span class="p">,</span><span class="n">BCbotT</span><span class="p">,</span><span class="n">BCbotq</span><span class="p">,</span><span class="n">BCbots</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-55"></a>         <span class="n">idriver</span><span class="p">,</span><span class="n">tdriverstart</span><span class="p">,</span><span class="n">driverjobnr</span><span class="p">,</span><span class="n">dtdriver</span><span class="p">,</span><span class="n">driverstore</span>
<a name="ln-56"></a>      <span class="k">use </span><span class="n">modsurfdata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0h</span><span class="p">,</span>  <span class="n">wtsurf</span><span class="p">,</span> <span class="n">wttop</span><span class="p">,</span> <span class="n">wqtop</span><span class="p">,</span> <span class="n">wqsurf</span><span class="p">,</span> <span class="n">wsvsurf</span><span class="p">,</span> <span class="n">wsvtop</span><span class="p">,</span> <span class="n">wsvsurfdum</span><span class="p">,</span> <span class="n">wsvtopdum</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">thvs</span><span class="p">,</span> <span class="n">thls</span><span class="p">,</span> <span class="n">thl_top</span><span class="p">,</span> <span class="n">qt_top</span><span class="p">,</span> <span class="n">qts</span> 
<a name="ln-57"></a>      <span class="c">! use modsurface,        only : initsurface</span>
<a name="ln-58"></a>      <span class="k">use </span><span class="n">modfields</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">initfields</span><span class="p">,</span> <span class="n">dpdx</span><span class="p">,</span> <span class="n">ncname</span>
<a name="ln-59"></a>      <span class="k">use </span><span class="n">modpois</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">initpois</span>
<a name="ln-60"></a>      <span class="k">use </span><span class="n">modboundary</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">initboundary</span><span class="p">,</span> <span class="n">ksp</span>
<a name="ln-61"></a>      <span class="k">use </span><span class="n">modthermodynamics</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">initthermodynamics</span><span class="p">,</span> <span class="n">lqlnr</span><span class="p">,</span> <span class="n">chi_half</span>
<a name="ln-62"></a>      <span class="k">use </span><span class="n">modsubgrid</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">initsubgrid</span>
<a name="ln-63"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">comm3d</span><span class="p">,</span> <span class="n">myid</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_logical</span><span class="p">,</span> <span class="n">my_real</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">,</span> <span class="n">mpi_character</span>
<a name="ln-64"></a>      <span class="k">use </span><span class="n">modinlet</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">initinlet</span>
<a name="ln-65"></a>      <span class="k">use </span><span class="n">modinletdata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">di</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">di_test</span><span class="p">,</span> <span class="n">dti</span><span class="p">,</span> <span class="n">iangledeg</span><span class="p">,</span> <span class="n">iangle</span>
<a name="ln-66"></a>      <span class="k">use </span><span class="n">modibmdata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">bctfxm</span><span class="p">,</span> <span class="n">bctfxp</span><span class="p">,</span> <span class="n">bctfym</span><span class="p">,</span> <span class="n">bctfyp</span><span class="p">,</span> <span class="n">bctfz</span>
<a name="ln-67"></a>      <span class="k">use </span><span class="n">modforces</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">calcfluidvolumes</span>
<a name="ln-68"></a>      <span class="k">use </span><span class="n">moddriver</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">initdriver</span>
<a name="ln-69"></a>
<a name="ln-70"></a>      <span class="k">implicit none</span>
<a name="ln-71"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-72"></a>
<a name="ln-73"></a>      <span class="c">!declare namelists</span>
<a name="ln-74"></a>
<a name="ln-75"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">RUN</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-76"></a>         <span class="n">iexpnr</span><span class="p">,</span> <span class="n">lwarmstart</span><span class="p">,</span> <span class="n">lstratstart</span><span class="p">,</span> <span class="n">startfile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-77"></a>         <span class="n">runtime</span><span class="p">,</span> <span class="n">dtmax</span><span class="p">,</span> <span class="n">trestart</span><span class="p">,</span> <span class="n">ladaptive</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-78"></a>         <span class="n">irandom</span><span class="p">,</span> <span class="n">randu</span><span class="p">,</span> <span class="n">randthl</span><span class="p">,</span> <span class="n">randqt</span><span class="p">,</span> <span class="n">krand</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-79"></a>         <span class="n">courant</span><span class="p">,</span> <span class="n">diffnr</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-80"></a>         <span class="n">libm</span><span class="p">,</span> <span class="n">lles</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-81"></a>         <span class="n">lper2inout</span><span class="p">,</span> <span class="n">lwalldist</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-82"></a>         <span class="n">lreadmean</span>
<a name="ln-83"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">DOMAIN</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-84"></a>         <span class="n">imax</span><span class="p">,</span> <span class="n">jtot</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-85"></a>         <span class="n">xlat</span><span class="p">,</span> <span class="n">xlon</span><span class="p">,</span> <span class="n">xday</span><span class="p">,</span> <span class="n">xtime</span><span class="p">,</span> <span class="n">ksp</span> 
<a name="ln-86"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">PHYSICS</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-87"></a>         <span class="n">ps</span><span class="p">,</span> <span class="n">igrw_damp</span><span class="p">,</span> <span class="n">lmoist</span><span class="p">,</span> <span class="n">lcoriol</span><span class="p">,</span> <span class="n">lbuoyancy</span><span class="p">,</span> <span class="n">ltempeq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-88"></a>         <span class="n">lprofforc</span><span class="p">,</span> <span class="n">ifixuinf</span><span class="p">,</span> <span class="n">lvinf</span><span class="p">,</span> <span class="n">tscale</span><span class="p">,</span> <span class="n">dpdx</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-89"></a>         <span class="n">luoutflowr</span><span class="p">,</span> <span class="n">lvoutflowr</span><span class="p">,</span> <span class="n">luvolflowr</span><span class="p">,</span> <span class="n">lvvolflowr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-90"></a>         <span class="n">uflowrate</span><span class="p">,</span> <span class="n">vflowrate</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-91"></a>         <span class="n">lnudge</span><span class="p">,</span> <span class="n">tnudge</span><span class="p">,</span> <span class="n">nnudge</span>
<a name="ln-92"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">DYNAMICS</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-93"></a>         <span class="n">lqlnr</span><span class="p">,</span> <span class="n">ipoiss</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-94"></a>         <span class="n">iadv_mom</span><span class="p">,</span> <span class="n">iadv_tke</span><span class="p">,</span> <span class="n">iadv_thl</span><span class="p">,</span> <span class="n">iadv_qt</span><span class="p">,</span> <span class="n">iadv_sv</span>
<a name="ln-95"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">BC</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-96"></a>         <span class="n">BCxm</span><span class="p">,</span> <span class="n">BCxT</span><span class="p">,</span> <span class="n">BCxq</span><span class="p">,</span> <span class="n">BCxs</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-97"></a>         <span class="n">BCym</span><span class="p">,</span> <span class="n">BCyT</span><span class="p">,</span> <span class="n">BCyq</span><span class="p">,</span> <span class="n">BCys</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-98"></a>         <span class="n">BCtopm</span><span class="p">,</span> <span class="n">BCtopT</span><span class="p">,</span> <span class="n">BCtopq</span><span class="p">,</span> <span class="n">BCtops</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-99"></a>         <span class="n">BCbotm</span><span class="p">,</span> <span class="n">BCbotT</span><span class="p">,</span> <span class="n">BCbotq</span><span class="p">,</span> <span class="n">BCbots</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-100"></a>         <span class="n">bctfxm</span><span class="p">,</span> <span class="n">bctfxp</span><span class="p">,</span> <span class="n">bctfym</span><span class="p">,</span> <span class="n">bctfyp</span><span class="p">,</span> <span class="n">bctfz</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-101"></a>         <span class="n">wttop</span><span class="p">,</span> <span class="n">thl_top</span><span class="p">,</span> <span class="n">qt_top</span><span class="p">,</span> <span class="n">qts</span><span class="p">,</span> <span class="n">wsvsurfdum</span><span class="p">,</span> <span class="n">wsvtopdum</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-102"></a>         <span class="n">wtsurf</span><span class="p">,</span> <span class="n">wqsurf</span><span class="p">,</span> <span class="n">thls</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">z0h</span>
<a name="ln-103"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">INLET</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-104"></a>         <span class="n">Uinf</span><span class="p">,</span> <span class="n">Vinf</span><span class="p">,</span> <span class="n">di</span><span class="p">,</span> <span class="n">dti</span><span class="p">,</span> <span class="n">inletav</span><span class="p">,</span> <span class="n">linletRA</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-105"></a>         <span class="n">lstoreplane</span><span class="p">,</span> <span class="n">lreadminl</span><span class="p">,</span> <span class="n">lfixinlet</span><span class="p">,</span> <span class="n">lfixutauin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-106"></a>         <span class="n">lwallfunc</span>
<a name="ln-107"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">DRIVER</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-108"></a>         <span class="n">idriver</span><span class="p">,</span> <span class="n">tdriverstart</span><span class="p">,</span> <span class="n">driverjobnr</span><span class="p">,</span> <span class="n">dtdriver</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-109"></a>         <span class="n">driverstore</span><span class="p">,</span> <span class="n">iplane</span>
<a name="ln-110"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">WALLS</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-111"></a>         <span class="n">nblocks</span><span class="p">,</span> <span class="n">nfcts</span><span class="p">,</span> <span class="n">iwallmom</span><span class="p">,</span> <span class="n">iwalltemp</span><span class="p">,</span> <span class="n">iwallmoist</span><span class="p">,</span> <span class="n">iwallscal</span>
<a name="ln-112"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">ENERGYBALANCE</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-113"></a>         <span class="n">lEB</span><span class="p">,</span> <span class="n">lwriteEBfiles</span><span class="p">,</span> <span class="n">lconstW</span><span class="p">,</span> <span class="n">dtEB</span><span class="p">,</span> <span class="n">bldT</span><span class="p">,</span> <span class="n">wsoil</span><span class="p">,</span> <span class="n">wgrmax</span><span class="p">,</span> <span class="n">wwilt</span><span class="p">,</span> <span class="n">wfc</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-114"></a>         <span class="n">skyLW</span><span class="p">,</span> <span class="n">GRLAI</span><span class="p">,</span> <span class="n">rsmin</span><span class="p">,</span> <span class="n">nwalllayers</span>
<a name="ln-115"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">SCALARS</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-116"></a>         <span class="n">lreadscal</span><span class="p">,</span> <span class="n">lscasrc</span><span class="p">,</span> <span class="n">lscasrcl</span><span class="p">,</span> <span class="n">lscasrcr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-117"></a>         <span class="n">nsv</span><span class="p">,</span> <span class="n">xS</span><span class="p">,</span> <span class="n">yS</span><span class="p">,</span> <span class="n">zS</span><span class="p">,</span> <span class="n">SS</span><span class="p">,</span> <span class="n">sigS</span>
<a name="ln-118"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">CHEMISTRY</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-119"></a>         <span class="n">lchem</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">JNO2</span>
<a name="ln-120"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">OUTPUT</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-121"></a>         <span class="n">lfielddump</span><span class="p">,</span> <span class="n">tfielddump</span><span class="p">,</span> <span class="n">fieldvars</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-122"></a>         <span class="n">ltdump</span><span class="p">,</span> <span class="n">lydump</span><span class="p">,</span> <span class="n">lytdump</span><span class="p">,</span> <span class="n">lxydump</span><span class="p">,</span> <span class="n">lxytdump</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-123"></a>         <span class="n">lslicedump</span><span class="p">,</span> <span class="n">ltkedump</span><span class="p">,</span> <span class="n">tstatsdump</span><span class="p">,</span> <span class="n">tsample</span>
<a name="ln-124"></a>
<a name="ln-125"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-126"></a><span class="k">         if</span> <span class="p">(</span><span class="nb">command_argument_count</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-127"></a><span class="k">            call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fname_options</span><span class="p">)</span>
<a name="ln-128"></a>         <span class="k">end if</span>
<a name="ln-129"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">fname_options</span>
<a name="ln-130"></a>
<a name="ln-131"></a>         <span class="k">open</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fname_options</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-132"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-133"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Namoptions does not exist&#39;</span>
<a name="ln-134"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-135"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-136"></a>         <span class="k">end if</span>
<a name="ln-137"></a>
<a name="ln-138"></a><span class="k">         read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">RUN</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-139"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-140"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions RUN&#39;</span>
<a name="ln-141"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-142"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-143"></a>         <span class="n">endif</span>
<a name="ln-144"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">RUN</span><span class="p">)</span>
<a name="ln-145"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-146"></a>
<a name="ln-147"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">DOMAIN</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-148"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-149"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions DOMAIN&#39;</span>
<a name="ln-150"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-151"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-152"></a>         <span class="n">endif</span>
<a name="ln-153"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">DOMAIN</span><span class="p">)</span>
<a name="ln-154"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-155"></a>
<a name="ln-156"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">PHYSICS</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-157"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-158"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions PHYSICS&#39;</span>
<a name="ln-159"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-160"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-161"></a>         <span class="n">endif</span>
<a name="ln-162"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">PHYSICS</span><span class="p">)</span>
<a name="ln-163"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-164"></a>
<a name="ln-165"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">DYNAMICS</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-166"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-167"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions DYNAMICS&#39;</span>
<a name="ln-168"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-169"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-170"></a>         <span class="n">endif</span>
<a name="ln-171"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">DYNAMICS</span><span class="p">)</span>
<a name="ln-172"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-173"></a>
<a name="ln-174"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">BC</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-175"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-176"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions BC&#39;</span>
<a name="ln-177"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-178"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-179"></a>         <span class="n">endif</span>
<a name="ln-180"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">BC</span><span class="p">)</span>
<a name="ln-181"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-182"></a>
<a name="ln-183"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">INLET</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-184"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-185"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions INLET&#39;</span>
<a name="ln-186"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-187"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-188"></a>         <span class="n">endif</span>
<a name="ln-189"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">INLET</span><span class="p">)</span>
<a name="ln-190"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-191"></a>
<a name="ln-192"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">DRIVER</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-193"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-194"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Problem in namoptions DRIVER&#39;</span>
<a name="ln-195"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-196"></a>            <span class="k">stop</span> <span class="s1">&#39;ERROR: Problem in namoptions DRIVER&#39;</span>
<a name="ln-197"></a>         <span class="n">endif</span>
<a name="ln-198"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">DRIVER</span><span class="p">)</span>
<a name="ln-199"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-200"></a>
<a name="ln-201"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">WALLS</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-202"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-203"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions WALLS&#39;</span>
<a name="ln-204"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-205"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-206"></a>         <span class="n">endif</span>
<a name="ln-207"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">WALLS</span><span class="p">)</span>
<a name="ln-208"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-209"></a>
<a name="ln-210"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">ENERGYBALANCE</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-211"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-212"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions EB&#39;</span>
<a name="ln-213"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-214"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-215"></a>         <span class="n">endif</span>
<a name="ln-216"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">ENERGYBALANCE</span><span class="p">)</span>
<a name="ln-217"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-218"></a>
<a name="ln-219"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">SCALARS</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-220"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-221"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions SCALARS&#39;</span>
<a name="ln-222"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-223"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-224"></a>         <span class="n">endif</span>
<a name="ln-225"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">SCALARS</span><span class="p">)</span>
<a name="ln-226"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-227"></a>
<a name="ln-228"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">CHEMISTRY</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-229"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-230"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions CHEMISTRY&#39;</span>
<a name="ln-231"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-232"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-233"></a>         <span class="n">endif</span>
<a name="ln-234"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">CHEMISTRY</span><span class="p">)</span>
<a name="ln-235"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-236"></a>
<a name="ln-237"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-238"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-239"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions OUTPUT&#39;</span>
<a name="ln-240"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-241"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-242"></a>         <span class="n">endif</span>
<a name="ln-243"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">)</span>
<a name="ln-244"></a>         <span class="k">close</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-245"></a>      <span class="k">end if</span>
<a name="ln-246"></a>
<a name="ln-247"></a><span class="k">      </span><span class="n">thvs</span> <span class="o">=</span> <span class="n">thls</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">qts</span><span class="p">)</span>
<a name="ln-248"></a>
<a name="ln-249"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;starting broadcast&quot;</span>
<a name="ln-250"></a>      <span class="c">!broadcast namelists</span>
<a name="ln-251"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iexpnr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-252"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lwarmstart</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-253"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lstratstart</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-254"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lfielddump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-255"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lreadscal</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch to read scalar pollutant fields (warm start)</span>
<a name="ln-256"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lscasrc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315</span>
<a name="ln-257"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lscasrcl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315</span>
<a name="ln-258"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lscasrcr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315</span>
<a name="ln-259"></a>
<a name="ln-260"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lbuoyancy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for buoyancy force in modforces</span>
<a name="ln-261"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ltempeq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for solving adv/diff equation for temperature</span>
<a name="ln-262"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lper2inout</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for restart periodic flow to inoutflow</span>
<a name="ln-263"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">libm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off IBM method</span>
<a name="ln-264"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lnudge</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-265"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nnudge</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-266"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tnudge</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-267"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lwalldist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for computing wall distances</span>
<a name="ln-268"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lles</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off LES functionality (subgrid model)</span>
<a name="ln-269"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linletRA</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off Running Average in inletgenerator</span>
<a name="ln-270"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lfixinlet</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for keeping average inlet velocit and temp fixed at inlet (iinletgen=1,2)</span>
<a name="ln-271"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lfixutauin</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for keeping utau fixed at inlet (iinletgen=1,2)</span>
<a name="ln-272"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-273"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">yS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-274"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">zS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-275"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">SS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-276"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">sigS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-277"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">idriver</span>    <span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_INTEGER</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>        <span class="c">! ae1212: Added switch for driver inlet simulation                                                                         </span>
<a name="ln-278"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tdriverstart</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MY_REAL</span>   <span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>        <span class="c">! ae1212</span>
<a name="ln-279"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">driverjobnr</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_INTEGER</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>        <span class="c">! ae1212</span>
<a name="ln-280"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dtdriver</span>   <span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MY_REAL</span>    <span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>        <span class="c">! ae1212</span>
<a name="ln-281"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">driverstore</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_INTEGER</span> <span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-282"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec BC&quot;</span>
<a name="ln-283"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-284"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-285"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-286"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-287"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCym</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>                                                                                                                                                                             
<a name="ln-288"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCyT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-289"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCyq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-290"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCys</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-291"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>                                                         
<a name="ln-292"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-293"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-294"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtops</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-295"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCbotm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> 
<a name="ln-296"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCbotT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-297"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCbotq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-298"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCbots</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-299"></a>
<a name="ln-300"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec c&quot;</span>
<a name="ln-301"></a>
<a name="ln-302"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lwallfunc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for reading mean inlet/recycle plane profiles (Uinl,Urec,Wrec)</span>
<a name="ln-303"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lreadminl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for reading mean inlet/recycle plane profiles (Uinl,Urec,Wrec)</span>
<a name="ln-304"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iwalltemp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! case (integer) for wall treatment for temperature (1=no wall function/fixed flux, 2=no wall function/fixed value, 3=uno)</span>
<a name="ln-305"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iwallmoist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! case (integer) for wall treatment for moisture (1=no wall function/fixed flux, 2=no wall function/fixed value, 3=uno)</span>
<a name="ln-306"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iwallscal</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-307"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iwallmom</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! case (integer) for wall treatment for momentum (1=no wall function, 2=werner-wengle, 3=uno)</span>
<a name="ln-308"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec d&quot;</span>
<a name="ln-309"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">luoutflowr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off u-velocity correction for fixed mass outflow rate</span>
<a name="ln-310"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lvoutflowr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315: added switch for turning on/off v-velocity correction for fixed mass outflow rate</span>
<a name="ln-311"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">luvolflowr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! bss166: added switch for turning on/off u-velocity correction for fixed volume flow rate</span>
<a name="ln-312"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lvvolflowr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! bss116: added switch for turning on/off v-velocity correction for fixed volume flow rate</span>
<a name="ln-313"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lstoreplane</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off for storing i-plane data to serve as inlet for future sim.</span>
<a name="ln-314"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lreadmean</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for reading mean variables from means#MYID#.#EXPNR#</span>
<a name="ln-315"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lydump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-316"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lytdump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-317"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lxydump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-318"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lxytdump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-319"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lslicedump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-320"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ltdump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-321"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ltkedump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing tke budget files</span>
<a name="ln-322"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iplane</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: ib+iplane is the i-plane that is stored if lstoreplane is .true.</span>
<a name="ln-323"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">startfile</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">MPI_CHARACTER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-324"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">author</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">MPI_CHARACTER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-325"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">runtime</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-326"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">trestart</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-327"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tfielddump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-328"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tsample</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">!tg3315</span>
<a name="ln-329"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tstatsdump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">!tg3315</span>
<a name="ln-330"></a>
<a name="ln-331"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tEB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-332"></a>      <span class="n">tnextEB</span> <span class="o">=</span> <span class="n">dtEB</span>
<a name="ln-333"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tnextEB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-334"></a>
<a name="ln-335"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dtmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-336"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nsv</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-337"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">fieldvars</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">MPI_CHARACTER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-338"></a>      <span class="c">!call MPI_BCAST(nstat      ,1,MPI_INTEGER,0,comm3d,mpierr) !tg3315</span>
<a name="ln-339"></a>      <span class="c">!call MPI_BCAST(ncstat     ,80,MPI_CHARACTER,0,comm3d,mpierr) !tg3315</span>
<a name="ln-340"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ifixuinf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-341"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lvinf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-342"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dpdx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-343"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tscale</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-344"></a>
<a name="ln-345"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">imax</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-346"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">jtot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-347"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">kmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-348"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xsize</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-349"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ysize</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-350"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xlat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-351"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xlon</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-352"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xday</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-353"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xtime</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-354"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec f&quot;</span>
<a name="ln-355"></a>
<a name="ln-356"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-357"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">z0h</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-358"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfxm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-359"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfxp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-360"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfym</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-361"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfyp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-362"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfz</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-363"></a>
<a name="ln-364"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wtsurf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-365"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wqsurf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-366"></a>      <span class="k">allocate</span> <span class="p">(</span><span class="n">wsvsurf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">))</span>
<a name="ln-367"></a>      <span class="n">wsvsurf</span> <span class="o">=</span> <span class="n">wsvsurfdum</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">)</span>
<a name="ln-368"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wsvsurf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">),</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-369"></a>      <span class="k">allocate</span> <span class="p">(</span><span class="n">wsvtop</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">))</span>
<a name="ln-370"></a>      <span class="n">wsvtop</span> <span class="o">=</span> <span class="n">wsvtopdum</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">)</span>                                                                   
<a name="ln-371"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wsvtop</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">),</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-372"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-373"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thvs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-374"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thls</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-375"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thl_top</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-376"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qt_top</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-377"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qts</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-378"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lmoist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-379"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lcoriol</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-380"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lprofforc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-381"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lchem</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-382"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-383"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">JNO2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-384"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">igrw_damp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-385"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">geodamptime</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-386"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wttop</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-387"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wqtop</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-388"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlsrc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-389"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">uflowrate</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-390"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">vflowrate</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-391"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">Uinf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-392"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">Vinf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-393"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-394"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-395"></a>      <span class="n">dr</span> <span class="o">=</span> <span class="n">di</span> <span class="c">! initial value is needed</span>
<a name="ln-396"></a>      <span class="n">di_test</span> <span class="o">=</span> <span class="n">di</span> <span class="c">! initial value is needed</span>
<a name="ln-397"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec g&quot;</span>
<a name="ln-398"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iangledeg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-399"></a>      <span class="n">iangle</span> <span class="o">=</span> <span class="n">iangledeg</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.</span>
<a name="ln-400"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">inletav</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-401"></a>
<a name="ln-402"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lqlnr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-403"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ksp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-404"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nblocks</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! no. of blocks used in IBM</span>
<a name="ln-405"></a>
<a name="ln-406"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nfcts</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-407"></a>
<a name="ln-408"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lconstW</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-409"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lEB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-410"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lwriteEBfiles</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-411"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wsoil</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-412"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wgrmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-413"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wwilt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-414"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wfc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-415"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dtEB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-416"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bldT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-417"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">skyLW</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-418"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">GRLAI</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-419"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">rsmin</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-420"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nwalllayers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-421"></a>
<a name="ln-422"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">irandom</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-423"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">krand</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-424"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">randthl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-425"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">randu</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-426"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">randqt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-427"></a>
<a name="ln-428"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ladaptive</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-429"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">courant</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-430"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">diffnr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-431"></a>
<a name="ln-432"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ipoiss</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-433"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_mom</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-434"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_tke</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-435"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_thl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-436"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_qt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-437"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_sv</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">),</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-438"></a>      <span class="c">!write(*,*) &quot;sec h&quot;</span>
<a name="ln-439"></a>
<a name="ln-440"></a>      <span class="c">! Allocate and initialize core modules</span>
<a name="ln-441"></a>      <span class="k">call </span><span class="n">initglobal</span>
<a name="ln-442"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initglobal&quot;</span>
<a name="ln-443"></a>      <span class="k">call </span><span class="n">initfields</span>
<a name="ln-444"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initfields&quot;</span>
<a name="ln-445"></a>      <span class="k">call </span><span class="n">initboundary</span>
<a name="ln-446"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initboundayi&quot;</span>
<a name="ln-447"></a>      <span class="k">call </span><span class="n">initthermodynamics</span>
<a name="ln-448"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initthermodynamics&quot;</span>
<a name="ln-449"></a>      <span class="c">!!depreated!!</span>
<a name="ln-450"></a>      <span class="c">! call initsurface</span>
<a name="ln-451"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initsurface&quot;</span>
<a name="ln-452"></a>      <span class="k">call </span><span class="n">initsubgrid</span>
<a name="ln-453"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initsubgrid&quot;</span>
<a name="ln-454"></a>      <span class="k">call </span><span class="n">initpois</span>
<a name="ln-455"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initpois&quot;</span>
<a name="ln-456"></a>      <span class="k">call </span><span class="n">initinlet</span> <span class="c">! added by J. Tomas: initialize inlet generator</span>
<a name="ln-457"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initinlet&quot;</span>
<a name="ln-458"></a>      <span class="k">call </span><span class="n">initdriver</span>  <span class="c">! added by ae1212: initialise driver inlet                             </span>
<a name="ln-459"></a>      <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initdriver&quot;</span>
<a name="ln-460"></a>      <span class="k">call </span><span class="n">checkinitvalues</span>
<a name="ln-461"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done checkinitvalues&quot;</span>
<a name="ln-462"></a>      <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Determine masking matrices&#39;</span>
<a name="ln-463"></a>      <span class="k">call </span><span class="n">createmasks</span> <span class="c">! determine walls/blocks</span>
<a name="ln-464"></a>      <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Finished determining masking matrices&#39;</span>
<a name="ln-465"></a>      <span class="c">! calculate fluid volume and outlet areas, needs masking matrices</span>
<a name="ln-466"></a>      <span class="k">call </span><span class="n">calcfluidvolumes</span>
<a name="ln-467"></a>
<a name="ln-468"></a>      <span class="k">call </span><span class="n">readinitfiles</span>
<a name="ln-469"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done readinitfiles&quot;</span>
<a name="ln-470"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done startup&quot;</span>
<a name="ln-471"></a>
<a name="ln-472"></a>      <span class="k">call </span><span class="n">createscals</span>
<a name="ln-473"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done create scals&quot;</span>
<a name="ln-474"></a>
<a name="ln-475"></a>   <span class="k">end subroutine </span><span class="n">startup</span>
<a name="ln-476"></a>
<a name="ln-477"></a>   <span class="k">subroutine </span><span class="n">checkinitvalues</span>
<a name="ln-478"></a>      <span class="c">!-----------------------------------------------------------------|</span>
<a name="ln-479"></a>      <span class="c">!                                                                 |</span>
<a name="ln-480"></a>      <span class="c">!      Thijs Heus   TU Delft  9/2/2006                            |</span>
<a name="ln-481"></a>      <span class="c">!                                                                 |</span>
<a name="ln-482"></a>      <span class="c">!     purpose.                                                    |</span>
<a name="ln-483"></a>      <span class="c">!     --------                                                    |</span>
<a name="ln-484"></a>      <span class="c">!                                                                 |</span>
<a name="ln-485"></a>      <span class="c">!      checks whether crucial parameters are set correctly        |</span>
<a name="ln-486"></a>      <span class="c">!                                                                 |</span>
<a name="ln-487"></a>      <span class="c">!     interface.                                                  |</span>
<a name="ln-488"></a>      <span class="c">!     ----------                                                  |</span>
<a name="ln-489"></a>      <span class="c">!                                                                 |</span>
<a name="ln-490"></a>      <span class="c">!     *checkinitvalues* is called from *program*.                 |</span>
<a name="ln-491"></a>      <span class="c">!                                                                 |</span>
<a name="ln-492"></a>      <span class="c">!-----------------------------------------------------------------|</span>
<a name="ln-493"></a>
<a name="ln-494"></a>      <span class="k">use </span><span class="n">modsurfdata</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">wtsurf</span><span class="p">,</span> <span class="n">wqsurf</span><span class="p">,</span> <span class="n">qts</span><span class="p">,</span> <span class="n">ps</span>
<a name="ln-495"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="n">only</span>   <span class="p">:</span> <span class="n">imax</span><span class="p">,</span><span class="n">kmax</span><span class="p">,</span><span class="n">jtot</span><span class="p">,</span><span class="n">ysize</span><span class="p">,</span><span class="n">xsize</span><span class="p">,</span><span class="n">dxf</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,&amp;</span>
<a name="ln-496"></a>                              <span class="n">dtmax</span><span class="p">,</span><span class="n">runtime</span><span class="p">,</span><span class="n">startfile</span><span class="p">,</span><span class="n">lwarmstart</span><span class="p">,</span><span class="n">lstratstart</span><span class="p">,&amp;</span>
<a name="ln-497"></a>                              <span class="n">BCxm</span><span class="p">,</span><span class="n">BCxT</span><span class="p">,</span><span class="n">BCxq</span><span class="p">,</span><span class="n">BCxs</span><span class="p">,</span><span class="n">BCtopm</span><span class="p">,</span><span class="n">BCbotm</span><span class="p">,&amp;</span>
<a name="ln-498"></a>                              <span class="n">iinletgen</span><span class="p">,</span><span class="n">linoutflow</span><span class="p">,</span><span class="n">ltempeq</span><span class="p">,</span><span class="n">iwalltemp</span><span class="p">,</span><span class="n">iwallmom</span><span class="p">,&amp;</span>
<a name="ln-499"></a>                              <span class="n">ipoiss</span><span class="p">,</span><span class="n">POISS_FFT</span><span class="p">,</span><span class="n">POISS_CYC</span>
<a name="ln-500"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="n">only</span>      <span class="p">:</span> <span class="n">myid</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span>
<a name="ln-501"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="n">only</span>   <span class="p">:</span> <span class="n">idriver</span>
<a name="ln-502"></a>      <span class="k">implicit none</span>
<a name="ln-503"></a><span class="k">      </span><span class="kt">real</span> <span class="kd">::</span> <span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imax</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-504"></a>      <span class="kt">logical</span> <span class="kd">::</span> <span class="n">inequi</span>
<a name="ln-505"></a>
<a name="ln-506"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">jtot</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-507"></a><span class="k">         if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-508"></a><span class="k">            write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;STOP ERROR IN NUMBER OF PROCESSORS&#39;</span>
<a name="ln-509"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocs must divide jtot!!! &#39;</span>
<a name="ln-510"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocs and jtot are: &#39;</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">jtot</span>
<a name="ln-511"></a>         <span class="k">end if</span>
<a name="ln-512"></a><span class="k">         call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-513"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-514"></a>      <span class="k">end if</span>
<a name="ln-515"></a>
<a name="ln-516"></a><span class="k">      if</span> <span class="p">(</span><span class="n">ipoiss</span><span class="o">==</span><span class="n">POISS_FFT</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-517"></a><span class="k">        if</span><span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">imax</span><span class="p">,</span><span class="n">nprocs</span><span class="p">)</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-518"></a><span class="k">          if</span><span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-519"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;STOP ERROR IN NUMBER OF PROCESSORS&#39;</span>
<a name="ln-520"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;nprocs must divide imax!!! &#39;</span>
<a name="ln-521"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;nprocs and imax are: &#39;</span><span class="p">,</span><span class="n">nprocs</span><span class="p">,</span><span class="n">imax</span>
<a name="ln-522"></a>          <span class="k">end if</span>
<a name="ln-523"></a><span class="k">          call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-524"></a>          <span class="k">stop </span><span class="mi">1</span>
<a name="ln-525"></a>        <span class="k">end if</span>
<a name="ln-526"></a><span class="k">      end if</span>
<a name="ln-527"></a>
<a name="ln-528"></a><span class="k">      if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">kmax</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-529"></a><span class="k">         if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-530"></a><span class="k">            write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;STOP ERROR IN NUMBER OF PROCESSORS&#39;</span>
<a name="ln-531"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocs must divide kmax!!! &#39;</span>
<a name="ln-532"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocs and kmax are: &#39;</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">kmax</span>
<a name="ln-533"></a>         <span class="k">end if</span>
<a name="ln-534"></a><span class="k">         call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-535"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-536"></a>      <span class="k">end if</span>
<a name="ln-537"></a>
<a name="ln-538"></a>      <span class="c">!Check Namoptions</span>
<a name="ln-539"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">runtime</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-540"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: runtime out of range/not set&#39;</span>
<a name="ln-541"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-542"></a>      <span class="k">end if</span>
<a name="ln-543"></a><span class="k">      if</span> <span class="p">(</span><span class="n">dtmax</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-544"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: dtmax out of range/not set&#39;</span>
<a name="ln-545"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-546"></a>      <span class="k">end if</span>
<a name="ln-547"></a><span class="k">      if</span> <span class="p">(</span><span class="n">ps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-548"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: psout of range/not set&#39;</span>
<a name="ln-549"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-550"></a>      <span class="k">end if</span>
<a name="ln-551"></a><span class="k">      if</span> <span class="p">(</span><span class="n">xsize</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-552"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: xsize out of range/not set&#39;</span>
<a name="ln-553"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-554"></a>      <span class="k">end if</span>
<a name="ln-555"></a><span class="k">      if</span> <span class="p">(</span><span class="n">ysize</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-556"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: ysize out of range/not set&#39;</span>
<a name="ln-557"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-558"></a>      <span class="k">end if</span>
<a name="ln-559"></a>
<a name="ln-560"></a><span class="k">      if</span> <span class="p">((</span><span class="n">lwarmstart</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">lstratstart</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-561"></a><span class="k">         if</span> <span class="p">(</span><span class="n">startfile</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-562"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: no restartfile set&#39;</span>
<a name="ln-563"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-564"></a>         <span class="k">end if</span>
<a name="ln-565"></a><span class="k">      end if</span>
<a name="ln-566"></a>
<a name="ln-567"></a>      <span class="c">! Switch to ensure that neutral wall function is called when ltempeq=false and if iwalltemp==1 (constant flux and therefore wall temp is not resolved.</span>
<a name="ln-568"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">ltempeq</span> <span class="p">.</span><span class="n">eqv</span><span class="p">.</span> <span class="p">.</span><span class="n">false</span><span class="p">.)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">iwalltemp</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-569"></a><span class="k">         </span><span class="n">iwallmom</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-570"></a>         <span class="n">BCbotm</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-571"></a>      <span class="k">end if</span>
<a name="ln-572"></a>
<a name="ln-573"></a>      <span class="c">! choosing inoutflow in x requires switches to be set</span>
<a name="ln-574"></a>      <span class="c">! tg3315 - these could be moved to init boundary</span>
<a name="ln-575"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">BCxm</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-576"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;inoutflow conditions, setting appropriate switches (1)&quot;</span>
<a name="ln-577"></a>         <span class="n">iinletgen</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-578"></a>         <span class="n">BCxT</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!temperature is considered in inletgen &amp; iolet</span>
<a name="ln-579"></a>         <span class="n">BCxq</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!humidity is considered in iolet</span>
<a name="ln-580"></a>         <span class="n">BCxs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!scalars are considered in iolet</span>
<a name="ln-581"></a>         <span class="n">BCtopm</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!velocity at top determined by topm</span>
<a name="ln-582"></a>         <span class="n">linoutflow</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-583"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iinletgen</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-584"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-585"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-586"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-587"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-588"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linoutflow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-589"></a>
<a name="ln-590"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">BCxm</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-591"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;inoutflow conditions, setting appropriate switches (2)&quot;</span>
<a name="ln-592"></a>
<a name="ln-593"></a>         <span class="n">iinletgen</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-594"></a>         <span class="c">! see modstartup for conditions that apply with inletgenerators</span>
<a name="ln-595"></a>         <span class="c">! move to modstartup</span>
<a name="ln-596"></a>         <span class="n">BCxT</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!temperature is considered in inletgen &amp; iolet</span>
<a name="ln-597"></a>         <span class="n">BCxq</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!humidity is considered in iolet</span>
<a name="ln-598"></a>         <span class="n">BCxs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!scalars are considered in iolet</span>
<a name="ln-599"></a>         <span class="n">BCtopm</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!velocity at top determined by topm</span>
<a name="ln-600"></a>         <span class="n">linoutflow</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-601"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iinletgen</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-602"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-603"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-604"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-605"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-606"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linoutflow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-607"></a>
<a name="ln-608"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">BCxm</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-609"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;inoutflow conditions, setting appropriate switches (0)&quot;</span>
<a name="ln-610"></a>
<a name="ln-611"></a>         <span class="n">iinletgen</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-612"></a>         <span class="c">! see modstartup for conditions that apply with inletgenerators</span>
<a name="ln-613"></a>         <span class="c">! move to modstartup</span>
<a name="ln-614"></a>         <span class="n">BCxT</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!temperature is considered in inletgen &amp; iolet</span>
<a name="ln-615"></a>         <span class="n">BCxq</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!humidity is considered in iolet</span>
<a name="ln-616"></a>         <span class="n">BCxs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!scalars are considered in iolet</span>
<a name="ln-617"></a>         <span class="n">BCtopm</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!velocity at top determined by topm</span>
<a name="ln-618"></a>         <span class="n">linoutflow</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-619"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iinletgen</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-620"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-621"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-622"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-623"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-624"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linoutflow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-625"></a>
<a name="ln-626"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">BCxm</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">5</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-627"></a>
<a name="ln-628"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;inoutflow conditions and idriver, setting appropriate switches (0)&quot;</span>
<a name="ln-629"></a>
<a name="ln-630"></a>         <span class="n">iinletgen</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-631"></a>         <span class="n">idriver</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-632"></a>         <span class="n">BCxT</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!temperature is considered in inletgen &amp; iolet</span>
<a name="ln-633"></a>         <span class="n">BCxq</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!humidity is considered in iolet</span>
<a name="ln-634"></a>         <span class="n">BCxs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!scalars are considered in iolet</span>
<a name="ln-635"></a>         <span class="n">BCtopm</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!velocity at top determined by topm</span>
<a name="ln-636"></a>         <span class="n">linoutflow</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-637"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iinletgen</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-638"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">idriver</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-639"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-640"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-641"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-642"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-643"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linoutflow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-644"></a>
<a name="ln-645"></a>      <span class="k">end if</span>
<a name="ln-646"></a>
<a name="ln-647"></a>      <span class="c">! check the Poisson solver setting w.r.t. x-grid</span>
<a name="ln-648"></a>      <span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imax</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dxf</span><span class="p">(</span><span class="n">ib</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span> <span class="o">-</span> <span class="n">dxf</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-649"></a>      <span class="n">inequi</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">&gt;</span><span class="n">dxf</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-5</span><span class="p">)</span>
<a name="ln-650"></a>
<a name="ln-651"></a>      <span class="k">if</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.</span> <span class="n">inequi</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">ipoiss</span> <span class="o">==</span> <span class="n">POISS_CYC</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">linoutflow</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-652"></a><span class="k">         write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;WARNING: consider using FFT poisson solver for better performance!&quot;</span>
<a name="ln-653"></a>      <span class="k">end if</span>
<a name="ln-654"></a>
<a name="ln-655"></a><span class="k">      if</span> <span class="p">((</span><span class="n">ipoiss</span> <span class="o">==</span> <span class="n">POISS_FFT</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">inequi</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-656"></a><span class="k">         write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;ERROR: POISS_FFT requires equidistant grid. Aborting...&quot;</span>
<a name="ln-657"></a>         <span class="k">call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-658"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-659"></a>      <span class="k">end if</span>
<a name="ln-660"></a>
<a name="ln-661"></a><span class="k">   end subroutine </span><span class="n">checkinitvalues</span>
<a name="ln-662"></a>
<a name="ln-663"></a>   <span class="k">subroutine </span><span class="n">readinitfiles</span>
<a name="ln-664"></a>      <span class="k">use </span><span class="n">modfields</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">u0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">um</span><span class="p">,</span> <span class="n">vm</span><span class="p">,</span> <span class="n">wm</span><span class="p">,</span> <span class="n">thlm</span><span class="p">,</span> <span class="n">thl0</span><span class="p">,</span> <span class="n">thl0h</span><span class="p">,</span> <span class="n">qtm</span><span class="p">,</span> <span class="n">qt0</span><span class="p">,</span> <span class="n">qt0h</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-665"></a>         <span class="n">ql0</span><span class="p">,</span> <span class="n">ql0h</span><span class="p">,</span> <span class="n">thv0h</span><span class="p">,</span> <span class="n">sv0</span><span class="p">,</span> <span class="n">svm</span><span class="p">,</span> <span class="n">e12m</span><span class="p">,</span> <span class="n">e120</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-666"></a>         <span class="n">dudxls</span><span class="p">,</span> <span class="n">dudyls</span><span class="p">,</span> <span class="n">dvdxls</span><span class="p">,</span> <span class="n">dvdyls</span><span class="p">,</span> <span class="n">dthldxls</span><span class="p">,</span> <span class="n">dthldyls</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-667"></a>         <span class="n">dqtdxls</span><span class="p">,</span> <span class="n">dqtdyls</span><span class="p">,</span> <span class="n">dqtdtls</span><span class="p">,</span> <span class="n">dpdx</span><span class="p">,</span> <span class="n">dpdxl</span><span class="p">,</span> <span class="n">dpdyl</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-668"></a>         <span class="n">wfls</span><span class="p">,</span> <span class="n">whls</span><span class="p">,</span> <span class="n">ug</span><span class="p">,</span> <span class="n">vg</span><span class="p">,</span> <span class="n">pgx</span><span class="p">,</span> <span class="n">pgy</span><span class="p">,</span> <span class="n">uprof</span><span class="p">,</span> <span class="n">vprof</span><span class="p">,</span> <span class="n">thlprof</span><span class="p">,</span> <span class="n">qtprof</span><span class="p">,</span> <span class="n">e12prof</span><span class="p">,</span> <span class="n">svprof</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-669"></a>         <span class="n">v0av</span><span class="p">,</span> <span class="n">u0av</span><span class="p">,</span> <span class="n">qt0av</span><span class="p">,</span> <span class="n">ql0av</span><span class="p">,</span> <span class="n">thl0av</span><span class="p">,</span> <span class="n">qt0av</span><span class="p">,</span> <span class="n">sv0av</span><span class="p">,</span> <span class="n">exnf</span><span class="p">,</span> <span class="n">exnh</span><span class="p">,</span> <span class="n">presf</span><span class="p">,</span> <span class="n">presh</span><span class="p">,</span> <span class="n">rhof</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-670"></a>         <span class="n">thlpcar</span><span class="p">,</span> <span class="n">uav</span><span class="p">,</span> <span class="n">thvh</span><span class="p">,</span> <span class="n">thvf</span><span class="p">,</span> <span class="n">IIc</span><span class="p">,</span> <span class="n">IIcs</span><span class="p">,</span> <span class="n">IIu</span><span class="p">,</span> <span class="n">IIus</span><span class="p">,</span> <span class="n">IIv</span><span class="p">,</span> <span class="n">IIvs</span><span class="p">,</span> <span class="n">IIw</span><span class="p">,</span> <span class="n">IIws</span>
<a name="ln-671"></a>            <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span>         <span class="n">only</span> <span class="p">:</span> <span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">khc</span><span class="p">,</span><span class="n">kmax</span><span class="p">,</span><span class="n">dtmax</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">runtime</span><span class="p">,</span><span class="n">timeleft</span><span class="p">,</span><span class="n">timee</span><span class="p">,</span><span class="n">ntimee</span><span class="p">,</span><span class="n">ntrun</span><span class="p">,</span><span class="n">btime</span><span class="p">,</span><span class="n">dt_lim</span><span class="p">,</span><span class="n">nsv</span><span class="p">,&amp;</span>
<a name="ln-672"></a>         <span class="n">zf</span><span class="p">,</span> <span class="n">zh</span><span class="p">,</span> <span class="n">dzf</span><span class="p">,</span> <span class="n">dzh</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">rlv</span><span class="p">,</span> <span class="n">pref0</span><span class="p">,</span> <span class="n">om23_gs</span><span class="p">,</span> <span class="n">jgb</span><span class="p">,</span> <span class="n">jge</span><span class="p">,</span> <span class="n">Uinf</span><span class="p">,</span> <span class="n">Vinf</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-673"></a>         <span class="n">rslabs</span><span class="p">,</span> <span class="n">e12min</span><span class="p">,</span> <span class="n">dzh</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">dqt</span><span class="p">,</span> <span class="n">dsv</span><span class="p">,</span> <span class="n">cexpnr</span><span class="p">,</span> <span class="n">ifinput</span><span class="p">,</span> <span class="n">lwarmstart</span><span class="p">,</span> <span class="n">lstratstart</span><span class="p">,</span> <span class="n">trestart</span><span class="p">,</span> <span class="n">numol</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-674"></a>         <span class="n">ladaptive</span><span class="p">,</span> <span class="n">tnextrestart</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span> <span class="n">linoutflow</span><span class="p">,</span> <span class="n">lper2inout</span><span class="p">,</span> <span class="n">iinletgen</span><span class="p">,</span> <span class="n">lreadminl</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-675"></a>         <span class="n">uflowrate</span><span class="p">,</span> <span class="n">vflowrate</span><span class="p">,</span><span class="n">ltempeq</span><span class="p">,</span> <span class="n">prandtlmoli</span><span class="p">,</span> <span class="n">freestreamav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-676"></a>         <span class="n">tnextfielddump</span><span class="p">,</span> <span class="n">tfielddump</span><span class="p">,</span> <span class="n">tsample</span><span class="p">,</span> <span class="n">tstatsdump</span><span class="p">,</span> <span class="n">startfile</span><span class="p">,</span> <span class="n">lprofforc</span><span class="p">,</span> <span class="n">lchem</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">JNO2</span><span class="p">,&amp;</span>
<a name="ln-677"></a>         <span class="n">idriver</span><span class="p">,</span><span class="n">dtdriver</span><span class="p">,</span><span class="n">driverstore</span><span class="p">,</span><span class="n">tdriverstart</span><span class="p">,</span><span class="n">tdriverdump</span>        
<a name="ln-678"></a>      <span class="k">use </span><span class="n">modsubgriddata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">ekm</span><span class="p">,</span> <span class="n">ekh</span>
<a name="ln-679"></a>      <span class="k">use </span><span class="n">modsurfdata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">wtsurf</span><span class="p">,</span> <span class="n">wqsurf</span><span class="p">,</span> <span class="n">wsvsurf</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-680"></a>         <span class="n">thls</span><span class="p">,</span> <span class="n">thvs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">qts</span><span class="p">,</span> <span class="n">svs</span><span class="p">,</span> <span class="n">sv_top</span>
<a name="ln-681"></a>      <span class="c">! use modsurface,        only : surface,dthldz</span>
<a name="ln-682"></a>      <span class="k">use </span><span class="n">modboundary</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">boundary</span><span class="p">,</span> <span class="n">tqaver</span>
<a name="ln-683"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">slabsum</span><span class="p">,</span> <span class="n">myid</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">,</span> <span class="n">my_real</span><span class="p">,</span> <span class="n">avexy_ibm</span>
<a name="ln-684"></a>      <span class="k">use </span><span class="n">modthermodynamics</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">thermodynamics</span><span class="p">,</span> <span class="n">calc_halflev</span>
<a name="ln-685"></a>      <span class="k">use </span><span class="n">modinletdata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">Uinl</span><span class="p">,</span> <span class="n">Urec</span><span class="p">,</span> <span class="n">Wrec</span><span class="p">,</span> <span class="n">u0inletbc</span><span class="p">,</span> <span class="n">v0inletbc</span><span class="p">,</span> <span class="n">w0inletbc</span><span class="p">,</span> <span class="n">ubulk</span><span class="p">,</span> <span class="n">irecy</span><span class="p">,</span> <span class="n">Utav</span><span class="p">,</span> <span class="n">Ttav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-686"></a>         <span class="n">uminletbc</span><span class="p">,</span> <span class="n">vminletbc</span><span class="p">,</span> <span class="n">wminletbc</span><span class="p">,</span> <span class="n">u0inletbcold</span><span class="p">,</span> <span class="n">v0inletbcold</span><span class="p">,</span> <span class="n">w0inletbcold</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-687"></a>         <span class="n">storeu0inletbc</span><span class="p">,</span> <span class="n">storev0inletbc</span><span class="p">,</span> <span class="n">storew0inletbc</span><span class="p">,</span> <span class="n">nstepread</span><span class="p">,</span> <span class="n">nfile</span><span class="p">,</span> <span class="n">Tinl</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-688"></a>         <span class="n">Trec</span><span class="p">,</span> <span class="n">tminletbc</span><span class="p">,</span> <span class="n">t0inletbcold</span><span class="p">,</span> <span class="n">t0inletbc</span><span class="p">,</span> <span class="n">storet0inletbc</span><span class="p">,</span> <span class="n">utaui</span><span class="p">,</span> <span class="n">ttaui</span><span class="p">,</span> <span class="n">iangle</span><span class="p">,&amp;</span>
<a name="ln-689"></a>         <span class="n">u0driver</span><span class="p">,</span><span class="n">v0driver</span><span class="p">,</span><span class="n">w0driver</span><span class="p">,</span><span class="n">e120driver</span><span class="p">,</span><span class="n">tdriver</span><span class="p">,</span><span class="n">thl0driver</span><span class="p">,</span><span class="n">qt0driver</span><span class="p">,</span><span class="n">storetdriver</span><span class="p">,&amp;</span>
<a name="ln-690"></a>         <span class="n">storeu0driver</span><span class="p">,</span><span class="n">storev0driver</span><span class="p">,</span><span class="n">storew0driver</span><span class="p">,</span><span class="n">storee120driver</span><span class="p">,</span><span class="n">storethl0driver</span><span class="p">,</span><span class="n">storeqt0driver</span><span class="p">,&amp;</span>
<a name="ln-691"></a>         <span class="n">nstepreaddriver</span>
<a name="ln-692"></a>      <span class="k">use </span><span class="n">modinlet</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">readinletfile</span>
<a name="ln-693"></a>      <span class="k">use </span><span class="n">moddriver</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">readdriverfile</span><span class="p">,</span><span class="n">initdriver</span><span class="p">,</span><span class="n">drivergen</span>
<a name="ln-694"></a>
<a name="ln-695"></a>      <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-696"></a>
<a name="ln-697"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">height</span><span class="p">(:),</span> <span class="n">th0av</span><span class="p">(:)</span>
<a name="ln-698"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">:</span><span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">:</span><span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thv0</span>
<a name="ln-699"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uaverage</span> <span class="c">! volume averaged u-velocity</span>
<a name="ln-700"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vaverage</span> <span class="c">! volume averaged v-velocity</span>
<a name="ln-701"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uaverager</span> <span class="c">! recycle plane</span>
<a name="ln-702"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uaveragei</span> <span class="c">! inlet plane</span>
<a name="ln-703"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">taverager</span> <span class="c">! recycle plane</span>
<a name="ln-704"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">taveragei</span> <span class="c">! inlet plane</span>
<a name="ln-705"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">waverage</span>
<a name="ln-706"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uprofrot</span>
<a name="ln-707"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vprofrot</span>
<a name="ln-708"></a>      <span class="kt">real </span><span class="n">tv</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span><span class="p">,</span> <span class="n">vbulk</span>
<a name="ln-709"></a>
<a name="ln-710"></a>      <span class="kt">character</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-711"></a>
<a name="ln-712"></a>      <span class="k">allocate</span> <span class="p">(</span><span class="n">height</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">))</span>
<a name="ln-713"></a>      <span class="k">allocate</span> <span class="p">(</span><span class="n">th0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">))</span>
<a name="ln-714"></a>
<a name="ln-715"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">lstratstart</span><span class="p">)</span> <span class="k">then</span> <span class="c">! Switch</span>
<a name="ln-716"></a>
<a name="ln-717"></a>         <span class="c">! Read restart files as in lwarmstart</span>
<a name="ln-718"></a>         <span class="k">call </span><span class="n">readrestartfiles</span>
<a name="ln-719"></a>         <span class="n">um</span> <span class="o">=</span> <span class="n">u0</span>
<a name="ln-720"></a>         <span class="n">vm</span> <span class="o">=</span> <span class="n">v0</span>
<a name="ln-721"></a>         <span class="n">wm</span> <span class="o">=</span> <span class="n">w0</span>
<a name="ln-722"></a>         <span class="n">thlm</span> <span class="o">=</span> <span class="n">thl0</span> <span class="c">!do this before or just not?</span>
<a name="ln-723"></a>         <span class="n">qtm</span> <span class="o">=</span> <span class="n">qt0</span>
<a name="ln-724"></a>         <span class="n">svm</span> <span class="o">=</span> <span class="n">sv0</span>
<a name="ln-725"></a>         <span class="n">e12m</span> <span class="o">=</span> <span class="n">e120</span>
<a name="ln-726"></a>
<a name="ln-727"></a>         <span class="c">! Overwrite thlm, thl0, qtm, qt0 from prof.inp.xxx</span>
<a name="ln-728"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-729"></a><span class="k">            open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;prof.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-730"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-731"></a>            <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-732"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-733"></a>
<a name="ln-734"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-735"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-736"></a>                  <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-737"></a>                  <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-738"></a>                  <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-739"></a>                  <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-740"></a>                  <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-741"></a>                  <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-742"></a>            <span class="k">end do</span>
<a name="ln-743"></a><span class="k">            close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-744"></a>
<a name="ln-745"></a>            <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height    thl     qt      u      v     e12&#39;</span>
<a name="ln-746"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-747"></a>               <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(f7.1,2f8.1,3f7.1)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-748"></a>                  <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-749"></a>                  <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-750"></a>                  <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-751"></a>                  <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-752"></a>                  <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-753"></a>                  <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-754"></a>
<a name="ln-755"></a>            <span class="k">end do</span>
<a name="ln-756"></a><span class="k">         end if</span> <span class="c">!myid=0</span>
<a name="ln-757"></a>
<a name="ln-758"></a>         <span class="c">! MPI broadcast thl and qt</span>
<a name="ln-759"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-760"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qtprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-761"></a>
<a name="ln-762"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-763"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-764"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-765"></a>                  <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-766"></a>                  <span class="n">thlm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-767"></a>                  <span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-768"></a>                  <span class="n">qtm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-769"></a>               <span class="k">end do</span>
<a name="ln-770"></a><span class="k">            end do</span>
<a name="ln-771"></a><span class="k">         end do</span>
<a name="ln-772"></a>
<a name="ln-773"></a>         <span class="c">!ILS13 reintroduced thv !tg3315 this part may wrong, could need to use</span>
<a name="ln-774"></a>         <span class="k">call </span><span class="n">calc_halflev</span>
<a name="ln-775"></a>         <span class="c">! exnf = (presf/pref0)**(rd/cp)  !exner functions not in restart files</span>
<a name="ln-776"></a>         <span class="c">! anymore.. or at least not read</span>
<a name="ln-777"></a>         <span class="c">! exnh = (presh/pref0)**(rd/cp)</span>
<a name="ln-778"></a>
<a name="ln-779"></a>         <span class="c">!   write(*,*) &quot;exnf&quot;,enf</span>
<a name="ln-780"></a>         <span class="c">!   write(*,*) &quot;exnh&quot;,exnh</span>
<a name="ln-781"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span>
<a name="ln-782"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-783"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-784"></a>                  <span class="c">!write(*,*) &quot;thl0h&quot;,thl0h(i,j,k)</span>
<a name="ln-785"></a>                  <span class="n">thv0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">rlv</span><span class="o">*</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-786"></a>                                   <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">qt0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">rv</span><span class="o">/</span><span class="n">rd</span><span class="o">*</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-787"></a>               <span class="k">end do</span>
<a name="ln-788"></a><span class="k">            end do</span>
<a name="ln-789"></a><span class="k">         end do</span>
<a name="ln-790"></a>
<a name="ln-791"></a><span class="k">         do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-792"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-793"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span>
<a name="ln-794"></a>                  <span class="n">thv0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">rlv</span><span class="o">*</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-795"></a>                                  <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">rv</span><span class="o">/</span><span class="n">rd</span><span class="o">*</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-796"></a>               <span class="k">end do</span>
<a name="ln-797"></a><span class="k">            end do</span>
<a name="ln-798"></a><span class="k">         end do</span>
<a name="ln-799"></a>
<a name="ln-800"></a><span class="k">         </span><span class="n">thvh</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-801"></a>         <span class="c">! call slabsum(thvh,kb,ke,thv0h,ib-ih,ie+ih,jb-jh,je+jh,kb-kh,ke+kh,ib,ie,jb,je,kb,ke) ! redefine halflevel thv using calculated thv</span>
<a name="ln-802"></a>         <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thvh</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thv0h</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIws</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-803"></a>         <span class="c">! thvh = thvh/rslabs</span>
<a name="ln-804"></a>
<a name="ln-805"></a>         <span class="n">thvf</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-806"></a>         <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thvf</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thv0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-807"></a>         <span class="c">! call slabsum(thvf,kb,ke,thv0,ib-ih,ie+ih,jb-jh,je+jh,kb-kh,ke+kh,ib,ie,jb,je,kb,ke)</span>
<a name="ln-808"></a>         <span class="c">! thvf = thvf/rslabs</span>
<a name="ln-809"></a>
<a name="ln-810"></a>      <span class="k">else</span> <span class="c">!if not lstratstart</span>
<a name="ln-811"></a>
<a name="ln-812"></a>         <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">lwarmstart</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-813"></a>
<a name="ln-814"></a>            <span class="c">!********************************************************************</span>
<a name="ln-815"></a>
<a name="ln-816"></a>            <span class="c">!    1.0 prepare initial fields from files &#39;prof.inp&#39; and &#39;scalar.inp&#39;</span>
<a name="ln-817"></a>            <span class="c">!    ----------------------------------------------------------------</span>
<a name="ln-818"></a>
<a name="ln-819"></a>            <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-820"></a>            <span class="c">!    1.1 read fields</span>
<a name="ln-821"></a>            <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-822"></a>
<a name="ln-823"></a>            <span class="n">dt</span> <span class="o">=</span> <span class="n">dtmax</span><span class="o">/</span><span class="mi">10</span><span class="mf">0.</span>
<a name="ln-824"></a>            <span class="n">timee</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-825"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-826"></a><span class="k">               open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;prof.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-827"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-828"></a>               <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-829"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-830"></a>
<a name="ln-831"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-832"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-833"></a>                     <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-834"></a>                     <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-835"></a>                     <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-836"></a>                     <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-837"></a>                     <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-838"></a>                     <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-839"></a>               <span class="k">end do</span>
<a name="ln-840"></a>
<a name="ln-841"></a>               <span class="c">! Apply rotation in horizontal</span>
<a name="ln-842"></a>               <span class="c">!write (6, *) &#39;iangle = &#39;, iangle</span>
<a name="ln-843"></a>
<a name="ln-844"></a>               <span class="c">!uprofrot = uprof*cos(iangle) - vprof*sin(iangle)</span>
<a name="ln-845"></a>               <span class="c">!vprofrot = vprof*cos(iangle) + uprof*sin(iangle)</span>
<a name="ln-846"></a>               <span class="c">!uprof = uprofrot</span>
<a name="ln-847"></a>               <span class="c">!vprof = vprofrot</span>
<a name="ln-848"></a>
<a name="ln-849"></a>               <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-850"></a>               <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height    thl     qt      u      v     e12&#39;</span>
<a name="ln-851"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-852"></a>                  <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(f7.1,2f8.1,3f7.1)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-853"></a>                     <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-854"></a>                     <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-855"></a>                     <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-856"></a>                     <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-857"></a>                     <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-858"></a>                     <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-859"></a>
<a name="ln-860"></a>               <span class="k">end do</span>
<a name="ln-861"></a>
<a name="ln-862"></a><span class="k">               if</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">e12prof</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">e12min</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-863"></a><span class="k">                  write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;e12 value is zero (or less) in prof.inp&#39;</span>
<a name="ln-864"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-865"></a>                     <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">e12min</span><span class="p">)</span>
<a name="ln-866"></a>                  <span class="k">end do</span>
<a name="ln-867"></a><span class="k">               end if</span>
<a name="ln-868"></a>
<a name="ln-869"></a><span class="k">            end if</span> <span class="c">! end if myid==0</span>
<a name="ln-870"></a>            <span class="c">! MPI broadcast numbers reading</span>
<a name="ln-871"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-872"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qtprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-873"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">uprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-874"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">vprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-875"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">e12prof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-876"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-877"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-878"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-879"></a>               <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-880"></a>               <span class="n">thlm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-881"></a>               <span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-882"></a>               <span class="n">qtm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-883"></a>               <span class="n">u0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-884"></a>               <span class="n">um</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-885"></a>               <span class="n">v0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-886"></a>               <span class="n">vm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-887"></a>               <span class="n">w0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-888"></a>               <span class="n">wm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-889"></a>               <span class="n">e120</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-890"></a>               <span class="n">e12m</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-891"></a>               <span class="c">!        ekm (i,j,k) = 0.0</span>
<a name="ln-892"></a>               <span class="c">!        ekh (i,j,k) = 0.0</span>
<a name="ln-893"></a>               <span class="n">ekm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">numol</span>
<a name="ln-894"></a>               <span class="n">ekh</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">numol</span>
<a name="ln-895"></a>            <span class="k">end do</span>
<a name="ln-896"></a><span class="k">            end do</span>
<a name="ln-897"></a><span class="k">            end do</span>
<a name="ln-898"></a>
<a name="ln-899"></a><span class="k">            </span><span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! also for start up</span>
<a name="ln-900"></a>
<a name="ln-901"></a>            <span class="c">! ILS13 30.11.17, added, not sure if necessary</span>
<a name="ln-902"></a>            <span class="c">! ILS13 30.11.1, commented</span>
<a name="ln-903"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span>
<a name="ln-904"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span>
<a name="ln-905"></a>                  <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-906"></a>                  <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>
<a name="ln-907"></a>               <span class="k">end do</span>
<a name="ln-908"></a><span class="k">            end do</span>
<a name="ln-909"></a>
<a name="ln-910"></a>            <span class="c">!! add random fluctuations</span>
<a name="ln-911"></a>            <span class="n">krand</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">krand</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-912"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">krand</span>
<a name="ln-913"></a>               <span class="k">call </span><span class="n">randomnize</span><span class="p">(</span><span class="n">um</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">randu</span><span class="p">,</span> <span class="n">irandom</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jh</span><span class="p">)</span>
<a name="ln-914"></a>            <span class="k">end do</span>
<a name="ln-915"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">krand</span>
<a name="ln-916"></a>               <span class="k">call </span><span class="n">randomnize</span><span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">randu</span><span class="p">,</span> <span class="n">irandom</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jh</span><span class="p">)</span>
<a name="ln-917"></a>            <span class="k">end do</span>
<a name="ln-918"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">krand</span>
<a name="ln-919"></a>               <span class="k">call </span><span class="n">randomnize</span><span class="p">(</span><span class="n">wm</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">randu</span><span class="p">,</span> <span class="n">irandom</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jh</span><span class="p">)</span>
<a name="ln-920"></a>            <span class="k">end do</span>
<a name="ln-921"></a>
<a name="ln-922"></a>            <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-923"></a>            <span class="c">!       do j=jb,je</span>
<a name="ln-924"></a>            <span class="c">!       do i=ib+1,ie-1</span>
<a name="ln-925"></a>            <span class="c">!         call random_number(ran)</span>
<a name="ln-926"></a>            <span class="c">!         ran1 = -1. +2.*ran</span>
<a name="ln-927"></a>            <span class="c">!         wm(i,j,k)=wm(i,j,k)+ 0.1*Uinf*ran1</span>
<a name="ln-928"></a>            <span class="c">!       end do</span>
<a name="ln-929"></a>            <span class="c">!       end do</span>
<a name="ln-930"></a>            <span class="c">!       end do</span>
<a name="ln-931"></a>            <span class="c">!</span>
<a name="ln-932"></a>            <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-933"></a>            <span class="c">!       do j=jb,je</span>
<a name="ln-934"></a>            <span class="c">!       do i=ib+2,ie-1</span>
<a name="ln-935"></a>            <span class="c">!         call random_number(ran)</span>
<a name="ln-936"></a>            <span class="c">!         ran1 = -1. +2.*ran</span>
<a name="ln-937"></a>            <span class="c">!         um(i,j,k)=um(i,j,k)+ 0.1*Uinf*ran1</span>
<a name="ln-938"></a>            <span class="c">!       end do</span>
<a name="ln-939"></a>            <span class="c">!       end do</span>
<a name="ln-940"></a>            <span class="c">!       end do</span>
<a name="ln-941"></a>            <span class="c">!</span>
<a name="ln-942"></a>            <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-943"></a>            <span class="c">!       do j=jb,je</span>
<a name="ln-944"></a>            <span class="c">!       do i=ib+1,ie-1</span>
<a name="ln-945"></a>            <span class="c">!         call random_number(ran)</span>
<a name="ln-946"></a>            <span class="c">!         ran1 = -1. +2.*ran</span>
<a name="ln-947"></a>            <span class="c">!         vm(i,j,k)=vm(i,j,k)+ 0.1*Uinf*ran1</span>
<a name="ln-948"></a>            <span class="c">!       end do</span>
<a name="ln-949"></a>            <span class="c">!       end do</span>
<a name="ln-950"></a>            <span class="c">!       end do</span>
<a name="ln-951"></a>
<a name="ln-952"></a>            <span class="n">u0</span> <span class="o">=</span> <span class="n">um</span>
<a name="ln-953"></a>            <span class="n">v0</span> <span class="o">=</span> <span class="n">vm</span>
<a name="ln-954"></a>            <span class="n">w0</span> <span class="o">=</span> <span class="n">wm</span>
<a name="ln-955"></a>
<a name="ln-956"></a>            <span class="n">uaverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-957"></a>            <span class="c">! call slabsum(uaverage, kb, ke, um, ib - 1, ie + 1, jb - 1, je + 1, kb - 1, ke + 1, ib, ie, jb, je, kb, ke)</span>
<a name="ln-958"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-959"></a>               <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-960"></a>            <span class="k">end do</span>
<a name="ln-961"></a><span class="k">            </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! averaged u-velocity inflow profile</span>
<a name="ln-962"></a>
<a name="ln-963"></a>            <span class="n">vaverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-964"></a>            <span class="c">! call slabsum(vaverage, kb, ke, vm, ib - 1, ie + 1, jb - 1, je + 1, kb - 1, ke + 1, ib, ie, jb, je, kb, ke)</span>
<a name="ln-965"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-966"></a>               <span class="n">vaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-967"></a>            <span class="k">end do</span>
<a name="ln-968"></a><span class="k">            </span><span class="n">vbulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! averaged u-velocity inflow profile</span>
<a name="ln-969"></a>
<a name="ln-970"></a>            <span class="c">! Set average inlet profile to initial inlet profile in case of inletgenerator mode</span>
<a name="ln-971"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">iinletgen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-972"></a>
<a name="ln-973"></a><span class="k">               </span><span class="n">uaverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-974"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">um</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-975"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-976"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-977"></a>               <span class="k">end do</span>
<a name="ln-978"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-979"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-980"></a>               <span class="n">Utav</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-981"></a>               <span class="n">Uinl</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to um</span>
<a name="ln-982"></a>               <span class="n">Urec</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to um</span>
<a name="ln-983"></a>               <span class="n">Wrec</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to mean w-profile</span>
<a name="ln-984"></a>               <span class="n">u0inletbcold</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-985"></a>               <span class="n">v0inletbcold</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-986"></a>               <span class="n">w0inletbcold</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-987"></a>               <span class="n">uminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-988"></a>               <span class="n">vminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-989"></a>               <span class="n">wminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-990"></a>               <span class="n">u0inletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-991"></a>               <span class="n">v0inletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-992"></a>               <span class="n">w0inletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-993"></a>               <span class="n">utaui</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numol</span><span class="o">*</span><span class="n">Uinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">/</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)))</span> <span class="c">! average streamwise friction at inlet (need for first time step)</span>
<a name="ln-994"></a>
<a name="ln-995"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-996"></a><span class="k">                  </span><span class="n">Ttav</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to thlm</span>
<a name="ln-997"></a>                  <span class="n">Tinl</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to thlm</span>
<a name="ln-998"></a>                  <span class="n">Trec</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to thlm</span>
<a name="ln-999"></a>                  <span class="n">t0inletbcold</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1000"></a>                  <span class="n">t0inletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">thl0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1001"></a>                  <span class="n">tminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1002"></a>                  <span class="n">ttaui</span> <span class="o">=</span> <span class="n">numol</span><span class="o">*</span><span class="n">prandtlmoli</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">Tinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">-</span> <span class="n">thls</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">*</span><span class="n">utaui</span><span class="p">)</span> <span class="c">! average friction temp. at inlet (need for first time step)</span>
<a name="ln-1003"></a>               <span class="k">end if</span>
<a name="ln-1004"></a>
<a name="ln-1005"></a>               <span class="c">! add random perturbations</span>
<a name="ln-1006"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1007"></a><span class="k">                  call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1008"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1009"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1010"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1011"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1012"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1013"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1014"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1015"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1016"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1017"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1018"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1019"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1020"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1021"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1022"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1023"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1024"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1025"></a>               <span class="k">end if</span>
<a name="ln-1026"></a>
<a name="ln-1027"></a><span class="k">               do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">48</span>
<a name="ln-1028"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1029"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-1030"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1031"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1032"></a>                  <span class="n">wm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Uinf</span><span class="o">*</span><span class="n">ran1</span>
<a name="ln-1033"></a>               <span class="k">end do</span>
<a name="ln-1034"></a><span class="k">               end do</span>
<a name="ln-1035"></a><span class="k">               end do</span>
<a name="ln-1036"></a>
<a name="ln-1037"></a>               <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-1038"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">48</span>
<a name="ln-1039"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1040"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ie</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-1041"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1042"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1043"></a>                  <span class="n">um</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Uinf</span><span class="o">*</span><span class="n">ran1</span>
<a name="ln-1044"></a>               <span class="k">end do</span>
<a name="ln-1045"></a><span class="k">               end do</span>
<a name="ln-1046"></a><span class="k">               end do</span>
<a name="ln-1047"></a>
<a name="ln-1048"></a>               <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-1049"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">48</span>
<a name="ln-1050"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1051"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-1052"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1053"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1054"></a>                  <span class="n">vm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Uinf</span><span class="o">*</span><span class="n">ran1</span>
<a name="ln-1055"></a>               <span class="k">end do</span>
<a name="ln-1056"></a><span class="k">               end do</span>
<a name="ln-1057"></a><span class="k">               end do</span>
<a name="ln-1058"></a>
<a name="ln-1059"></a><span class="k">               </span><span class="n">u0</span> <span class="o">=</span> <span class="n">um</span>
<a name="ln-1060"></a>               <span class="n">v0</span> <span class="o">=</span> <span class="n">vm</span>
<a name="ln-1061"></a>               <span class="n">w0</span> <span class="o">=</span> <span class="n">wm</span>
<a name="ln-1062"></a>
<a name="ln-1063"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">iinletgen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1064"></a>
<a name="ln-1065"></a><span class="k">               </span><span class="n">nfile</span> <span class="o">=</span> <span class="n">nfile</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1066"></a>               <span class="k">call </span><span class="n">readinletfile</span>
<a name="ln-1067"></a>               <span class="n">u0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storeu0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1068"></a>               <span class="n">v0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storev0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1069"></a>               <span class="n">w0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storew0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1070"></a>               <span class="n">uminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storeu0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1071"></a>               <span class="n">vminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storev0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1072"></a>               <span class="n">wminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storew0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1073"></a>               <span class="c">! determine bulk velocity</span>
<a name="ln-1074"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1075"></a>               <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1076"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1077"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1078"></a>               <span class="k">end do</span>
<a name="ln-1079"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-1080"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-1081"></a>            <span class="n">elseif</span> <span class="p">(</span><span class="n">idriver</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span> <span class="c">! idriver</span>
<a name="ln-1082"></a>
<a name="ln-1083"></a>               <span class="k">call </span><span class="n">readdriverfile</span>
<a name="ln-1084"></a>
<a name="ln-1085"></a>               <span class="c">! if(myid==0) then</span>
<a name="ln-1086"></a>                 <span class="c">! write(*,*) &#39;Driver inlet velocity&#39;</span>
<a name="ln-1087"></a>                 <span class="c">! do n=1,driverstore</span>
<a name="ln-1088"></a>                   <span class="c">! write (*,&#39;(f9.2,e20.12)&#39;) storetdriver(n),     storeu0driver(1,32,n)</span>
<a name="ln-1089"></a>                 <span class="c">! end do</span>
<a name="ln-1090"></a>               <span class="c">! endif</span>
<a name="ln-1091"></a>
<a name="ln-1092"></a>              <span class="c">! call slabsum(uaverage,kb,ke,u0,ib-1,ie+1,jb-1,je+1,kb-1,ke+1,ib,ie,jb,je,kb,ke)</span>
<a name="ln-1093"></a>              <span class="c">! uaverage = uaverage / ((ie-ib+1)*(jge-jgb+1))  ! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1094"></a>
<a name="ln-1095"></a>              <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">u0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">IIus</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1096"></a>              <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span>
<a name="ln-1097"></a>                <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1098"></a>              <span class="k">end do</span>
<a name="ln-1099"></a><span class="k">              </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">!volume-averaged u-velocity</span>
<a name="ln-1100"></a>
<a name="ln-1101"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1102"></a><span class="k">                 write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span><span class="n">ubulk</span>
<a name="ln-1103"></a>              <span class="k">end if</span>
<a name="ln-1104"></a>
<a name="ln-1105"></a><span class="k">            </span><span class="n">elseif</span> <span class="p">(</span><span class="n">idriver</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1106"></a>
<a name="ln-1107"></a><span class="k">              call </span><span class="n">drivergen</span>
<a name="ln-1108"></a>
<a name="ln-1109"></a>            <span class="k">end if</span>
<a name="ln-1110"></a>
<a name="ln-1111"></a>            <span class="c">!---------------------------------------------------------------</span>
<a name="ln-1112"></a>            <span class="c">!  1.2 randomnize fields</span>
<a name="ln-1113"></a>            <span class="c">!---------------------------------------------------------------</span>
<a name="ln-1114"></a>            <span class="c">!     if (iinletgen /= 2 .and. iinletgen /= 1) then</span>
<a name="ln-1115"></a>            <span class="c">!       write(6,*) &#39;randomnizing temperature!&#39;</span>
<a name="ln-1116"></a>            <span class="c">!       krand  = min(krand,ke)</span>
<a name="ln-1117"></a>            <span class="c">!        do k = kb,ke !edited tg3315 krand --&gt; ke</span>
<a name="ln-1118"></a>            <span class="c">!          call randomnize(thlm,k,randthl,irandom,ih,jh)</span>
<a name="ln-1119"></a>            <span class="c">!          call randomnize(thl0,k,randthl,irandom,ih,jh)</span>
<a name="ln-1120"></a>            <span class="c">!        end do</span>
<a name="ln-1121"></a>            <span class="c">!       end if</span>
<a name="ln-1122"></a>
<a name="ln-1123"></a>            <span class="n">svprof</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1124"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1125"></a><span class="k">               if</span> <span class="p">(</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1126"></a><span class="k">                  open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1127"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1128"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1129"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1130"></a>                     <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1131"></a>                        <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1132"></a>                        <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1133"></a>                  <span class="k">end do</span>
<a name="ln-1134"></a><span class="k">                  open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1135"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height   sv(1) --------- sv(nsv) &#39;</span>
<a name="ln-1136"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1137"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1138"></a>                        <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1139"></a>                        <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1140"></a>                  <span class="k">end do</span>
<a name="ln-1141"></a>
<a name="ln-1142"></a><span class="k">               end if</span>
<a name="ln-1143"></a><span class="k">            end if</span> <span class="c">! end if myid==0</span>
<a name="ln-1144"></a>
<a name="ln-1145"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">svprof</span><span class="p">,</span> <span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">-</span> <span class="p">(</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">))</span><span class="o">*</span><span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1146"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1147"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1148"></a>                  <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1149"></a>                     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span>
<a name="ln-1150"></a>                        <span class="n">sv0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-1151"></a>                        <span class="n">svm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-1152"></a>                     <span class="k">end do</span>
<a name="ln-1153"></a><span class="k">                  end do</span>
<a name="ln-1154"></a><span class="k">               end do</span>
<a name="ln-1155"></a><span class="k">            end do</span>
<a name="ln-1156"></a><span class="k">          </span>
<a name="ln-1157"></a><span class="k">            if</span> <span class="p">(</span><span class="n">nsv</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">!tg3315 set these variables here for now and repeat for warmstart</span>
<a name="ln-1158"></a>
<a name="ln-1159"></a>              <span class="k">allocate</span><span class="p">(</span><span class="n">sv_top</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">))</span>
<a name="ln-1160"></a>              <span class="n">sv_top</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">svprof</span><span class="p">(</span><span class="n">ke</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">)</span>
<a name="ln-1161"></a>
<a name="ln-1162"></a>              <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">sv_top</span><span class="p">,</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1163"></a>
<a name="ln-1164"></a>              <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;svprof&#39;</span><span class="p">,</span> <span class="n">svprof</span>
<a name="ln-1165"></a>              <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;sv_top&#39;</span><span class="p">,</span> <span class="n">sv_top</span>
<a name="ln-1166"></a>
<a name="ln-1167"></a>            <span class="k">end if</span>
<a name="ln-1168"></a> 
<a name="ln-1169"></a>            <span class="c">!do n = 1,nsv</span>
<a name="ln-1170"></a>            <span class="c">!  do j = jb - jhc, je + jhc</span>
<a name="ln-1171"></a>            <span class="c">!    do i = ib - ihc, ie + ihc</span>
<a name="ln-1172"></a>            <span class="c">!      svm(i, j, ke + 1, n) = svm(i, j, ke)</span>
<a name="ln-1173"></a>            <span class="c">!      sv0(i, j, kb - 1, n) = sv0(i, j, kb)</span>
<a name="ln-1174"></a>            <span class="c">!    end do</span>
<a name="ln-1175"></a>            <span class="c">!  end do</span>
<a name="ln-1176"></a>            <span class="c">!end do</span>
<a name="ln-1177"></a>
<a name="ln-1178"></a>            <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1179"></a>            <span class="c">!    2.2 Initialize surface layer</span>
<a name="ln-1180"></a>            <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1181"></a>
<a name="ln-1182"></a>         <span class="c">!ILS13 reintroduced thv !tg3315 this part may wrong, could need to use</span>
<a name="ln-1183"></a>         <span class="k">call </span><span class="n">calc_halflev</span>
<a name="ln-1184"></a>         <span class="c">! exnf = (presf/pref0)**(rd/cp)  !exner functions not in restart files</span>
<a name="ln-1185"></a>         <span class="c">! anymore.. or at least not read</span>
<a name="ln-1186"></a>         <span class="c">! exnh = (presh/pref0)**(rd/cp)</span>
<a name="ln-1187"></a>
<a name="ln-1188"></a>            <span class="k">call </span><span class="n">boundary</span> <span class="c">! tg3315 17.10.17 having this in startup was causing issues for running with lmoist ! turned of when pot. temp = temp.</span>
<a name="ln-1189"></a>            <span class="k">call </span><span class="n">thermodynamics</span> <span class="c">! turned off when pot. temp = temp.</span>
<a name="ln-1190"></a>
<a name="ln-1191"></a>            <span class="k">call </span><span class="n">boundary</span>
<a name="ln-1192"></a>            <span class="k">call </span><span class="n">thermodynamics</span> <span class="c">! turned off when pot. temp = temp.</span>
<a name="ln-1193"></a>
<a name="ln-1194"></a>         <span class="k">else</span> <span class="c">!if lwarmstart</span>
<a name="ln-1195"></a>            <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;doing warmstart&quot;</span>
<a name="ln-1196"></a>            <span class="k">call </span><span class="n">readrestartfiles</span>
<a name="ln-1197"></a>
<a name="ln-1198"></a>            <span class="n">um</span> <span class="o">=</span> <span class="n">u0</span>
<a name="ln-1199"></a>            <span class="n">vm</span> <span class="o">=</span> <span class="n">v0</span>
<a name="ln-1200"></a>            <span class="n">wm</span> <span class="o">=</span> <span class="n">w0</span>
<a name="ln-1201"></a>            <span class="n">thlm</span> <span class="o">=</span> <span class="n">thl0</span>
<a name="ln-1202"></a>            <span class="n">qtm</span> <span class="o">=</span> <span class="n">qt0</span>
<a name="ln-1203"></a>            <span class="n">svm</span> <span class="o">=</span> <span class="n">sv0</span>
<a name="ln-1204"></a>            <span class="n">e12m</span> <span class="o">=</span> <span class="n">e120</span>
<a name="ln-1205"></a>            <span class="n">ekm</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">numol</span>
<a name="ln-1206"></a>            <span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">numol</span><span class="o">*</span><span class="n">prandtlmoli</span> <span class="c">!tg3315 added because wttop using ekh in modboundary which is called in startup</span>
<a name="ln-1207"></a>
<a name="ln-1208"></a>            <span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! also for start up</span>
<a name="ln-1209"></a>
<a name="ln-1210"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">idriver</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>                                                                   
<a name="ln-1211"></a>              <span class="c">!driverstore = (timeleft - tdriverstart)/dtdriver + 1</span>
<a name="ln-1212"></a>              <span class="c">!if(myid==0) then</span>
<a name="ln-1213"></a>              <span class="c">!  write(*,*) &#39;driverstore: &#39;, driverstore</span>
<a name="ln-1214"></a>              <span class="c">!end if</span>
<a name="ln-1215"></a>              <span class="k">call </span><span class="n">drivergen</span>
<a name="ln-1216"></a>              <span class="n">tdriverdump</span> <span class="o">=</span> <span class="n">tdriverstart</span>
<a name="ln-1217"></a>            <span class="n">endif</span>
<a name="ln-1218"></a>
<a name="ln-1219"></a>            <span class="c">!ILS13 reintroduced thv</span>
<a name="ln-1220"></a>            <span class="k">call </span><span class="n">calc_halflev</span>
<a name="ln-1221"></a>            <span class="c">! exnf = (presf/pref0)**(rd/cp)  !exner functions not in restart files</span>
<a name="ln-1222"></a>            <span class="c">! anymore.. or at least not read</span>
<a name="ln-1223"></a>            <span class="c">! exnh = (presh/pref0)**(rd/cp)</span>
<a name="ln-1224"></a>
<a name="ln-1225"></a>            <span class="c">!   write(*,*) &quot;exnf&quot;,enf</span>
<a name="ln-1226"></a>            <span class="c">!   write(*,*) &quot;exnh&quot;,exnh</span>
<a name="ln-1227"></a>
<a name="ln-1228"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1229"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1230"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span>
<a name="ln-1231"></a>               <span class="c">!write(*,*) &quot;thl0h&quot;,thl0h(i,j,k)</span>
<a name="ln-1232"></a>               <span class="n">thv0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">rlv</span><span class="o">*</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-1233"></a>                                <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">qt0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">rv</span><span class="o">/</span><span class="n">rd</span><span class="o">*</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-1234"></a>            <span class="k">end do</span>
<a name="ln-1235"></a><span class="k">            end do</span>
<a name="ln-1236"></a><span class="k">            end do</span>
<a name="ln-1237"></a>
<a name="ln-1238"></a><span class="k">            do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1239"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1240"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span>
<a name="ln-1241"></a>               <span class="n">thv0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">rlv</span><span class="o">*</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-1242"></a>                               <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">rv</span><span class="o">/</span><span class="n">rd</span><span class="o">*</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-1243"></a>            <span class="k">end do</span>
<a name="ln-1244"></a><span class="k">            end do</span>
<a name="ln-1245"></a><span class="k">            end do</span>
<a name="ln-1246"></a>
<a name="ln-1247"></a><span class="k">            </span><span class="n">thvh</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1248"></a>            <span class="c">! call slabsum(thvh,kb,ke,thv0h,ib-ih,ie+ih,jb-jh,je+jh,kb-kh,ke+kh,ib,ie,jb,je,kb,ke) ! redefine halflevel thv using calculated thv</span>
<a name="ln-1249"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thvh</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thv0h</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIws</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1250"></a>            <span class="c">! thvh = thvh/rslabs</span>
<a name="ln-1251"></a>
<a name="ln-1252"></a>            <span class="n">thvf</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1253"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thvf</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thv0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1254"></a>            <span class="c">! call slabsum(thvf,kb,ke,thv0,ib-ih,ie+ih,jb-jh,je+jh,kb-kh,ke+kh,ib,ie,jb,je,kb,ke)</span>
<a name="ln-1255"></a>            <span class="c">! thvf = thvf/rslabs</span>
<a name="ln-1256"></a>
<a name="ln-1257"></a>            <span class="c">! Set average inlet profile to initial inlet profile in case of inletgenerator mode</span>
<a name="ln-1258"></a>            <span class="n">uaverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1259"></a>            <span class="n">uaveragei</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1260"></a>            <span class="n">uaverager</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1261"></a>            <span class="n">waverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1262"></a>            <span class="n">taveragei</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1263"></a>            <span class="n">taverager</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1264"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">iinletgen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1265"></a><span class="k">               call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaveragei</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1266"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverager</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">irecy</span><span class="p">,</span> <span class="n">irecy</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1267"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">waverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1268"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1269"></a>               <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1270"></a>               <span class="n">uaveragei</span> <span class="o">=</span> <span class="n">uaveragei</span><span class="o">/</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! this gives the j-averaged u-velocity at the inlet</span>
<a name="ln-1271"></a>               <span class="n">uaverager</span> <span class="o">=</span> <span class="n">uaverager</span><span class="o">/</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! this gives the j-averaged u-velocity at the recycle plane</span>
<a name="ln-1272"></a>               <span class="n">waverage</span> <span class="o">=</span> <span class="n">waverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged w-velocity (only correct for equidistant grid?)</span>
<a name="ln-1273"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1274"></a><span class="k">                  call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">taveragei</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">thl0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1275"></a>                  <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">taverager</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">thl0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">irecy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">irecy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1276"></a>                  <span class="n">taveragei</span> <span class="o">=</span> <span class="n">taveragei</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the j-averaged temperature at the inlet</span>
<a name="ln-1277"></a>                  <span class="n">taverager</span> <span class="o">=</span> <span class="n">taverager</span><span class="o">/</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! this gives the j-averaged temperature at the recycle plane</span>
<a name="ln-1278"></a>               <span class="k">end if</span>
<a name="ln-1279"></a><span class="k">               if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">lreadminl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1280"></a><span class="k">                  if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1281"></a><span class="k">                     write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uaverage(kb)=&#39;</span><span class="p">,</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span>
<a name="ln-1282"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uaverage(ke)=&#39;</span><span class="p">,</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1283"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;waverage(ke)=&#39;</span><span class="p">,</span> <span class="n">waverage</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1284"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;waverage(ke-20)=&#39;</span><span class="p">,</span> <span class="n">waverage</span><span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
<a name="ln-1285"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;taveragei(kb)=&#39;</span><span class="p">,</span> <span class="n">taveragei</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span>
<a name="ln-1286"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;taveragei(ke)=&#39;</span><span class="p">,</span> <span class="n">taveragei</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1287"></a>                  <span class="k">end if</span>
<a name="ln-1288"></a>
<a name="ln-1289"></a><span class="k">                  </span><span class="n">Utav</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1290"></a>                  <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1291"></a>                     <span class="n">Utav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">uaverage</span>
<a name="ln-1292"></a>                  <span class="k">end do</span>
<a name="ln-1293"></a>
<a name="ln-1294"></a><span class="k">                  </span><span class="n">Uinl</span> <span class="o">=</span> <span class="n">uaverage</span> <span class="c">! set the initial time-averaged inlet profile equal to mean u-profile read from means</span>
<a name="ln-1295"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Uinl(kb+10)=&#39;</span><span class="p">,</span> <span class="n">Uinl</span><span class="p">(</span><span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-1296"></a>                  <span class="n">utaui</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numol</span><span class="o">*</span><span class="n">Uinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">/</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)))</span> <span class="c">! average streamwise friction at inlet (need for first time step)</span>
<a name="ln-1297"></a>                  <span class="n">Urec</span> <span class="o">=</span> <span class="n">uaverage</span> <span class="c">! set the initial time-averaged inlet profile equal to mean u-profile</span>
<a name="ln-1298"></a>
<a name="ln-1299"></a>                  <span class="n">Wrec</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">waverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to mean w-profile</span>
<a name="ln-1300"></a>                  <span class="n">Wrec</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.</span> <span class="c">! set the initial time-averaged inlet profile equal to zero</span>
<a name="ln-1301"></a>                  <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1302"></a><span class="k">                     </span><span class="n">Ttav</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1303"></a>                     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1304"></a>                        <span class="n">Ttav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">taveragei</span><span class="p">(:)</span>
<a name="ln-1305"></a>                     <span class="k">end do</span>
<a name="ln-1306"></a><span class="k">                     </span><span class="n">Tinl</span> <span class="o">=</span> <span class="n">taveragei</span>
<a name="ln-1307"></a>                     <span class="n">Trec</span> <span class="o">=</span> <span class="n">taveragei</span>
<a name="ln-1308"></a>                     <span class="n">ttaui</span> <span class="o">=</span> <span class="n">numol</span><span class="o">*</span><span class="n">prandtlmoli</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">Tinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">-</span> <span class="n">thls</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">*</span><span class="n">utaui</span><span class="p">)</span> <span class="c">! friction temp. at inlet (need at first time step)</span>
<a name="ln-1309"></a>                  <span class="k">end if</span>
<a name="ln-1310"></a><span class="k">               else</span> <span class="c">! -&gt; lreadminl -&gt; Uinl, Urec, Wrec already read</span>
<a name="ln-1311"></a>                  <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1312"></a>                  <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1313"></a>               <span class="k">end if</span>
<a name="ln-1314"></a>
<a name="ln-1315"></a>               <span class="c">! determine bulk velocity</span>
<a name="ln-1316"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1317"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1318"></a>               <span class="k">end do</span>
<a name="ln-1319"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-1320"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-1321"></a>
<a name="ln-1322"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1323"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1324"></a>                  <span class="n">uminletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1325"></a>                  <span class="n">vminletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1326"></a>                  <span class="n">u0inletbcold</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1327"></a>                  <span class="n">v0inletbcold</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1328"></a>                  <span class="n">u0inletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1329"></a>                  <span class="n">v0inletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1330"></a>               <span class="k">end do</span>
<a name="ln-1331"></a><span class="k">               end do</span>
<a name="ln-1332"></a>
<a name="ln-1333"></a><span class="k">               do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1334"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1335"></a>                  <span class="n">wminletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1336"></a>                  <span class="n">w0inletbcold</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1337"></a>                  <span class="n">w0inletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1338"></a>               <span class="k">end do</span>
<a name="ln-1339"></a><span class="k">               end do</span>
<a name="ln-1340"></a>
<a name="ln-1341"></a><span class="k">               if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1342"></a><span class="k">                  do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1343"></a>                  <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1344"></a>                     <span class="n">tminletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1345"></a>                     <span class="n">t0inletbcold</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1346"></a>                     <span class="n">t0inletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1347"></a>                  <span class="k">end do</span>
<a name="ln-1348"></a><span class="k">                  end do</span>
<a name="ln-1349"></a><span class="k">               end if</span>
<a name="ln-1350"></a>
<a name="ln-1351"></a><span class="k">               write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uminletbc(jb,kb),um(ib,jb,kb)=&#39;</span><span class="p">,</span> <span class="n">uminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">),</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>
<a name="ln-1352"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uminletbc(jb+1,kb+10),um(ib,jb+1,kb+10)=&#39;</span><span class="p">,</span> <span class="n">uminletbc</span><span class="p">(</span><span class="n">jb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-1353"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uminletbc(je,kb+10),um(ib,je,kb+10)=&#39;</span><span class="p">,</span> <span class="n">uminletbc</span><span class="p">(</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-1354"></a>
<a name="ln-1355"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">iinletgen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1356"></a>
<a name="ln-1357"></a><span class="k">               </span><span class="n">nfile</span> <span class="o">=</span> <span class="n">nfile</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1358"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Loading inletfile&#39;</span>
<a name="ln-1359"></a>               <span class="k">call </span><span class="n">readinletfile</span>
<a name="ln-1360"></a>               <span class="n">u0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storeu0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1361"></a>               <span class="n">v0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storev0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1362"></a>               <span class="n">w0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storew0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1363"></a>               <span class="n">uminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storeu0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1364"></a>               <span class="n">vminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storev0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1365"></a>               <span class="n">wminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storew0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1366"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1367"></a><span class="k">                  </span><span class="n">t0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storet0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1368"></a>                  <span class="n">tminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storet0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1369"></a>               <span class="k">end if</span>
<a name="ln-1370"></a>               <span class="c">! determine bulk velocity</span>
<a name="ln-1371"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1372"></a>               <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1373"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1374"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1375"></a>               <span class="k">end do</span>
<a name="ln-1376"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-1377"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-1378"></a>
<a name="ln-1379"></a>            <span class="n">elseif</span> <span class="p">(</span><span class="n">idriver</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span> <span class="c">! idriver</span>
<a name="ln-1380"></a>
<a name="ln-1381"></a>               <span class="k">call </span><span class="n">readdriverfile</span>
<a name="ln-1382"></a>               <span class="k">call </span><span class="n">drivergen</span>
<a name="ln-1383"></a>
<a name="ln-1384"></a>              <span class="c">!call slabsum(uaverage,kb,ke,u0,ib-1,ie+1,jb-1,je+1,kb-1,ke+1,ib,ie,jb,je,kb,ke)</span>
<a name="ln-1385"></a>              <span class="c">!uaverage = uaverage / ((ie-ib+1)*(jge-jgb+1))  ! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1386"></a>              <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">u0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">IIus</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1387"></a>              <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span>
<a name="ln-1388"></a>                <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1389"></a>              <span class="k">end do</span>
<a name="ln-1390"></a><span class="k">              </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">!volume-averaged u-velocity</span>
<a name="ln-1391"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1392"></a><span class="k">                 write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span><span class="n">ubulk</span>
<a name="ln-1393"></a>              <span class="k">end if</span>
<a name="ln-1394"></a>
<a name="ln-1395"></a><span class="k">            end if</span> <span class="c">! iinletgen/idriver</span>
<a name="ln-1396"></a>
<a name="ln-1397"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">lper2inout</span><span class="p">)</span> <span class="k">then</span> <span class="c">! if the restart starts from a periodic simulation to in/outflow, lper2inout should be set to .true.</span>
<a name="ln-1398"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1399"></a><span class="k">                  write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;per2inout=.true. -&gt; reading inlet profile from prof.inp.XXX and scalar.inp.XXX&#39;</span>
<a name="ln-1400"></a>                  <span class="k">open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;prof.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span> <span class="c">!  read the inlet profile from prof.inp</span>
<a name="ln-1401"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1402"></a>                  <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1403"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1404"></a>
<a name="ln-1405"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1406"></a>                     <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1407"></a>                        <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1408"></a>                        <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1409"></a>                        <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1410"></a>                        <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1411"></a>                        <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1412"></a>                        <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1413"></a>                  <span class="k">end do</span>
<a name="ln-1414"></a><span class="k">                  </span><span class="n">svprof</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1415"></a>                  <span class="k">if</span> <span class="p">(</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1416"></a><span class="k">                     open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1417"></a>                     <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1418"></a>                     <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1419"></a>                     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1420"></a>                        <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1421"></a>                           <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1422"></a>                           <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1423"></a>                     <span class="k">end do</span>
<a name="ln-1424"></a><span class="k">                     open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1425"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height   sv(1) --------- sv(nsv) &#39;</span>
<a name="ln-1426"></a>                     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1427"></a>                        <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1428"></a>                           <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1429"></a>                           <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1430"></a>                     <span class="k">end do</span>
<a name="ln-1431"></a>
<a name="ln-1432"></a><span class="k">                  end if</span>
<a name="ln-1433"></a><span class="k">               end if</span> <span class="c">! end if myid==0</span>
<a name="ln-1434"></a>
<a name="ln-1435"></a>               <span class="c">! MPI broadcast numbers reading</span>
<a name="ln-1436"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1437"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">uprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1438"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">vprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1439"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">e12prof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1440"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qtprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1441"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">svprof</span><span class="p">,</span> <span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">-</span> <span class="p">(</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">))</span><span class="o">*</span><span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1442"></a>
<a name="ln-1443"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">linoutflow</span><span class="p">)</span> <span class="k">then</span> <span class="c">! restart of inoutflow simulation: reproduce inlet boundary condition from restartfile</span>
<a name="ln-1444"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1445"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1446"></a>                     <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">u0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1447"></a>                     <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">v0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">v0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1448"></a>                     <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">thl0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1449"></a>                     <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">qt0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">qt0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1450"></a>                     <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">e120</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">e120</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1451"></a>                     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span>
<a name="ln-1452"></a>                        <span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">sv0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">sv0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1453"></a>                     <span class="n">enddo</span>
<a name="ln-1454"></a>                  <span class="n">enddo</span>
<a name="ln-1455"></a>               <span class="n">enddo</span>
<a name="ln-1456"></a>               <span class="c">! outlet bulk velocity</span>
<a name="ln-1457"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1458"></a>               <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1459"></a>               <span class="c">! determine bulk velocity</span>
<a name="ln-1460"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1461"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1462"></a>               <span class="k">end do</span>
<a name="ln-1463"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-1464"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-1465"></a>            <span class="k">else</span> <span class="c">! else per2per... read svprof regardless...</span>
<a name="ln-1466"></a>
<a name="ln-1467"></a>            <span class="c">! tg3315 read svprof (but do not use regardless of above...)</span>
<a name="ln-1468"></a>              <span class="n">svprof</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1469"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1470"></a><span class="k">                 if</span> <span class="p">(</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1471"></a><span class="k">                    open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1472"></a>                    <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1473"></a>                    <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1474"></a>                    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1475"></a>                       <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1476"></a>                          <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1477"></a>                          <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1478"></a>                    <span class="k">end do</span>
<a name="ln-1479"></a><span class="k">                    open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1480"></a>                    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height   sv(1) --------- sv(nsv) &#39;</span>
<a name="ln-1481"></a>                    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1482"></a>                       <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1483"></a>                          <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1484"></a>                          <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1485"></a>                    <span class="k">end do</span>
<a name="ln-1486"></a>
<a name="ln-1487"></a><span class="k">                 end if</span>
<a name="ln-1488"></a><span class="k">              end if</span> <span class="c">! end if myid==0</span>
<a name="ln-1489"></a>
<a name="ln-1490"></a>              <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">svprof</span><span class="p">,</span> <span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">-</span> <span class="p">(</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">))</span><span class="o">*</span><span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1491"></a>          
<a name="ln-1492"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">nsv</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">!tg3315 set these variables here for now and repeat for warmstart</span>
<a name="ln-1493"></a>
<a name="ln-1494"></a>                <span class="k">allocate</span><span class="p">(</span><span class="n">sv_top</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">))</span>
<a name="ln-1495"></a>                <span class="n">sv_top</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">svprof</span><span class="p">(</span><span class="n">ke</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">)</span>
<a name="ln-1496"></a>
<a name="ln-1497"></a>                <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">sv_top</span><span class="p">,</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1498"></a>
<a name="ln-1499"></a>              <span class="k">end if</span>
<a name="ln-1500"></a>
<a name="ln-1501"></a><span class="k">            end if</span> <span class="c">! end if lper2inout</span>
<a name="ln-1502"></a>
<a name="ln-1503"></a>            <span class="n">u0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1504"></a>            <span class="n">v0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1505"></a>            <span class="n">thl0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1506"></a>            <span class="n">qt0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1507"></a>            <span class="n">th0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1508"></a>            <span class="n">sv0av</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1509"></a>
<a name="ln-1510"></a>            <span class="c">! call slabsum(u0av  ,kb,ke+kh,u0(:,:,kb:ke+kh)  ,ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1511"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">u0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">u0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIus</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1512"></a>            <span class="c">! call slabsum(v0av  ,kb,ke+kh,v0(:,:,kb:ke+kh)  ,ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1513"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">v0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">v0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIv</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIvs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1514"></a>            <span class="c">! call slabsum(thl0av,kb,ke+kh,thl0(:,:,kb:ke+kh),ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1515"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thl0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thl0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1516"></a>            <span class="c">! call slabsum(qt0av,kb,ke+kh,qt0(:,:,kb:ke+kh),ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1517"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">qt0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">qt0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1518"></a>            <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span>
<a name="ln-1519"></a>               <span class="c">! call slabsum(sv0av(kb,n),kb,ke+kh,sv0(ib-ih,jb-jh,kb,n),ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1520"></a>               <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">sv0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">khc</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">sv0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">khc</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">khc</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">khc</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1521"></a>            <span class="k">end do</span>
<a name="ln-1522"></a>
<a name="ln-1523"></a>            <span class="c">! CvH - only do this for fixed timestepping. In adaptive dt comes from restartfile</span>
<a name="ln-1524"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">ladaptive</span><span class="p">)</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">dtmax</span>
<a name="ln-1525"></a>            <span class="c">!  call boundary</span>
<a name="ln-1526"></a>         <span class="k">end if</span> <span class="c">! lwarmstart</span>
<a name="ln-1527"></a>      <span class="k">end if</span> <span class="c">! not lstratstart</span>
<a name="ln-1528"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1529"></a>      <span class="c">!    2.1 read and initialise fields</span>
<a name="ln-1530"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1531"></a>
<a name="ln-1532"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1533"></a><span class="k">         open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;lscale.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1534"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1535"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1536"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39; height  u_geo  v_geo  pgx  pgy  subs     &#39;</span> <span class="p">&amp;</span>
<a name="ln-1537"></a>            <span class="p">,</span> <span class="s1">&#39;   dqtdx      dqtdy        dqtdtls     thl_rad &#39;</span>
<a name="ln-1538"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1539"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1540"></a>               <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1541"></a>               <span class="n">ug</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1542"></a>               <span class="n">vg</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1543"></a>               <span class="n">pgx</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1544"></a>               <span class="n">pgy</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1545"></a>               <span class="n">wfls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1546"></a>               <span class="n">dqtdxls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1547"></a>               <span class="n">dqtdyls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1548"></a>               <span class="n">dqtdtls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1549"></a>               <span class="n">thlpcar</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1550"></a>         <span class="k">end do</span>
<a name="ln-1551"></a><span class="k">         close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1552"></a>
<a name="ln-1553"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1554"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(3f7.1,5e12.4)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1555"></a>               <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1556"></a>               <span class="n">ug</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1557"></a>               <span class="n">vg</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1558"></a>               <span class="n">pgx</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1559"></a>               <span class="n">pgy</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1560"></a>               <span class="n">wfls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1561"></a>               <span class="n">dqtdxls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1562"></a>               <span class="n">dqtdyls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1563"></a>               <span class="n">dqtdtls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1564"></a>               <span class="n">thlpcar</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1565"></a>         <span class="k">end do</span>
<a name="ln-1566"></a>
<a name="ln-1567"></a><span class="k">      end if</span> <span class="c">! end myid==0</span>
<a name="ln-1568"></a>
<a name="ln-1569"></a>      <span class="c">! MPI broadcast variables read in</span>
<a name="ln-1570"></a>
<a name="ln-1571"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ug</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1572"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">vg</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1573"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">pgx</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1574"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">pgy</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1575"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wfls</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1576"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dqtdxls</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1577"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dqtdyls</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1578"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dqtdtls</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1579"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlpcar</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1580"></a>
<a name="ln-1581"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1582"></a>      <span class="c">!    2.3 make large-scale horizontal pressure gradient</span>
<a name="ln-1583"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1584"></a>
<a name="ln-1585"></a>      <span class="c">!******include rho if rho = rho(z) /= 1.0 ***********</span>
<a name="ln-1586"></a>
<a name="ln-1587"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">lprofforc</span><span class="p">)</span> <span class="k">then</span> <span class="c">!tg3315</span>
<a name="ln-1588"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1589"></a>            <span class="n">dpdxl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">pgx</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">dpdx</span> <span class="c">!-om23_gs*ug(k)-pgx(k)-dpdx</span>
<a name="ln-1590"></a>            <span class="n">dpdyl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">pgy</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1591"></a>         <span class="k">end do</span>
<a name="ln-1592"></a><span class="k">      else</span>
<a name="ln-1593"></a><span class="k">         do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1594"></a>            <span class="c">!dpdxl(k) =  om23_gs*vg(k)</span>
<a name="ln-1595"></a>            <span class="c">!dpdyl(k) = -om23_gs*ug(k)</span>
<a name="ln-1596"></a>            <span class="c">!dpdxl(k) =  -ug(k)</span>
<a name="ln-1597"></a>            <span class="c">!dpdyl(k) =  -vg(k)</span>
<a name="ln-1598"></a>            <span class="n">dpdxl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">om23_gs</span><span class="o">*</span><span class="n">vg</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">pgx</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">dpdx</span> <span class="c">!corriolis forcing and pressure gradient</span>
<a name="ln-1599"></a>            <span class="n">dpdyl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">om23_gs</span><span class="o">*</span><span class="n">ug</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">pgy</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1600"></a>         <span class="k">end do</span>
<a name="ln-1601"></a><span class="k">      </span><span class="n">endif</span>
<a name="ln-1602"></a>
<a name="ln-1603"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1604"></a>      <span class="c">!    2.4 large-scale subsidence, reintroduced ILS13 05.06.2014</span>
<a name="ln-1605"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1606"></a>
<a name="ln-1607"></a>      <span class="n">whls</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1608"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1609"></a>         <span class="n">whls</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">wfls</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">wfls</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dzh</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1610"></a>      <span class="k">end do</span>
<a name="ln-1611"></a><span class="k">      </span><span class="n">whls</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">wfls</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span> <span class="o">+</span> <span class="n">dzf</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wfls</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span> <span class="o">-</span> <span class="n">wfls</span><span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">dzh</span><span class="p">(</span><span class="n">ke</span><span class="p">))</span> <span class="c">! tg3315 31/07/18 removed a 0.5</span>
<a name="ln-1612"></a>
<a name="ln-1613"></a>      <span class="c">!    idtmax = floor(dtmax/tres)</span>
<a name="ln-1614"></a>      <span class="n">btime</span> <span class="o">=</span> <span class="n">timee</span>
<a name="ln-1615"></a>      <span class="c">!    timeleft=ceiling(runtime/tres)</span>
<a name="ln-1616"></a>      <span class="n">timeleft</span> <span class="o">=</span> <span class="n">runtime</span>
<a name="ln-1617"></a>      <span class="n">dt_lim</span> <span class="o">=</span> <span class="n">timeleft</span>
<a name="ln-1618"></a>      <span class="c">!    write(6,*) &#39;real(dt)*tres= &#39;,rdt, &#39; dtmax/100= &#39;,dtmax/100</span>
<a name="ln-1619"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">lwarmstart</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">lstratstart</span><span class="p">))</span> <span class="k">then</span> <span class="c">! tg3315 to have cumulative number on restart files</span>
<a name="ln-1620"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">startfile</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">13</span><span class="p">),</span> <span class="s1">&#39;(i4)&#39;</span><span class="p">)</span> <span class="n">ntrun</span>
<a name="ln-1621"></a>         <span class="c">! ntrun = ichar(startfile(6:13))</span>
<a name="ln-1622"></a>      <span class="k">else</span>
<a name="ln-1623"></a><span class="k">         </span><span class="n">ntrun</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1624"></a>      <span class="k">end if</span>
<a name="ln-1625"></a><span class="k">      </span><span class="n">ntimee</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">timee</span><span class="o">/</span><span class="n">dtmax</span><span class="p">)</span>
<a name="ln-1626"></a>      <span class="n">tnextrestart</span> <span class="o">=</span> <span class="n">btime</span> <span class="o">+</span> <span class="n">trestart</span>
<a name="ln-1627"></a>      <span class="n">tnextfielddump</span> <span class="o">=</span> <span class="n">btime</span> <span class="o">+</span> <span class="n">tfielddump</span>
<a name="ln-1628"></a>      <span class="k">deallocate</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">th0av</span><span class="p">)</span>
<a name="ln-1629"></a>
<a name="ln-1630"></a>      <span class="c">!    call boundary</span>
<a name="ln-1631"></a>
<a name="ln-1632"></a>   <span class="k">end subroutine </span><span class="n">readinitfiles</span>
<a name="ln-1633"></a>
<a name="ln-1634"></a>   <span class="k">subroutine </span><span class="n">readrestartfiles</span>
<a name="ln-1635"></a>
<a name="ln-1636"></a>      <span class="k">use </span><span class="n">modsurfdata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">ustar</span><span class="p">,</span> <span class="n">thlflux</span><span class="p">,</span> <span class="n">qtflux</span><span class="p">,</span> <span class="n">svflux</span><span class="p">,</span> <span class="n">dudz</span><span class="p">,</span> <span class="n">dvdz</span><span class="p">,</span> <span class="n">dthldz</span><span class="p">,</span> <span class="n">dqtdz</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">thls</span><span class="p">,</span> <span class="n">qts</span><span class="p">,</span> <span class="n">thvs</span><span class="p">,</span> <span class="n">oblav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1637"></a>         <span class="n">wtsurf</span>
<a name="ln-1638"></a>      <span class="k">use </span><span class="n">modfields</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">u0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">thl0</span><span class="p">,</span> <span class="n">qt0</span><span class="p">,</span> <span class="n">ql0</span><span class="p">,</span> <span class="n">ql0h</span><span class="p">,</span> <span class="n">qtav</span><span class="p">,</span> <span class="n">qlav</span><span class="p">,</span> <span class="n">e120</span><span class="p">,</span> <span class="n">dthvdz</span><span class="p">,</span> <span class="n">presf</span><span class="p">,</span> <span class="n">presh</span><span class="p">,</span> <span class="n">sv0</span><span class="p">,</span> <span class="n">mindist</span><span class="p">,</span> <span class="n">wall</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1639"></a>         <span class="n">uav</span><span class="p">,</span> <span class="n">vav</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">uuav</span><span class="p">,</span> <span class="n">vvav</span><span class="p">,</span> <span class="n">wwav</span><span class="p">,</span> <span class="n">uvav</span><span class="p">,</span> <span class="n">uwav</span><span class="p">,</span> <span class="n">vwav</span><span class="p">,</span> <span class="n">svav</span><span class="p">,</span> <span class="n">thlav</span><span class="p">,</span> <span class="n">thl2av</span><span class="p">,</span> <span class="n">sv2av</span><span class="p">,</span> <span class="n">pres0</span><span class="p">,</span> <span class="n">svm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1640"></a>         <span class="n">svprof</span><span class="p">,</span> <span class="n">viscratioav</span><span class="p">,</span> <span class="n">thluav</span><span class="p">,</span> <span class="n">thlvav</span><span class="p">,</span> <span class="n">thlwav</span><span class="p">,</span> <span class="n">svuav</span><span class="p">,</span> <span class="n">svvav</span><span class="p">,</span> <span class="n">svwav</span><span class="p">,</span> <span class="n">presav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1641"></a>         <span class="n">uusgsav</span><span class="p">,</span> <span class="n">vvsgsav</span><span class="p">,</span> <span class="n">wwsgsav</span><span class="p">,</span> <span class="n">uwsgsav</span><span class="p">,</span> <span class="n">thlusgsav</span><span class="p">,</span> <span class="n">thlwsgsav</span><span class="p">,</span> <span class="n">svusgsav</span><span class="p">,</span> <span class="n">svwsgsav</span><span class="p">,</span> <span class="n">tkesgsav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1642"></a>         <span class="n">strain2av</span><span class="p">,</span> <span class="n">nusgsav</span>
<a name="ln-1643"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">jh</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kh</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">dqt</span><span class="p">,</span> <span class="n">dsv</span><span class="p">,</span> <span class="n">startfile</span><span class="p">,</span> <span class="n">timee</span><span class="p">,</span> <span class="n">totavtime</span><span class="p">,</span> <span class="n">runavtime</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1644"></a>         <span class="n">iexpnr</span><span class="p">,</span> <span class="n">ntimee</span><span class="p">,</span> <span class="n">rk3step</span><span class="p">,</span> <span class="n">ifinput</span><span class="p">,</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">cexpnr</span><span class="p">,</span> <span class="n">lreadmean</span><span class="p">,</span> <span class="n">lreadminl</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1645"></a>         <span class="n">totinletav</span><span class="p">,</span> <span class="n">lreadscal</span><span class="p">,</span> <span class="n">ltempeq</span><span class="p">,</span> <span class="n">dzf</span><span class="p">,</span> <span class="n">numol</span><span class="p">,</span> <span class="n">prandtlmoli</span>
<a name="ln-1646"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">cmyid</span><span class="p">,</span> <span class="n">myid</span>
<a name="ln-1647"></a>      <span class="k">use </span><span class="n">modsubgriddata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">ekm</span>
<a name="ln-1648"></a>      <span class="k">use </span><span class="n">modinlet</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">zinterpolate1d</span><span class="p">,</span> <span class="n">zinterpolatet1d</span><span class="p">,</span> <span class="n">zinterpolatew1d</span><span class="p">,</span> <span class="n">zinterpolate2d</span>
<a name="ln-1649"></a>      <span class="k">use </span><span class="n">modinletdata</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">Uinl</span><span class="p">,</span> <span class="n">Urec</span><span class="p">,</span> <span class="n">Wrec</span><span class="p">,</span> <span class="n">Utav</span><span class="p">,</span> <span class="n">Tinl</span><span class="p">,</span> <span class="n">Trec</span><span class="p">,</span> <span class="n">linuf</span><span class="p">,</span> <span class="n">linuh</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1650"></a>         <span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">,</span> <span class="n">lzinzsim</span><span class="p">,</span> <span class="n">utaui</span><span class="p">,</span> <span class="n">Ttav</span><span class="p">,</span> <span class="n">ttaui</span>
<a name="ln-1651"></a>
<a name="ln-1652"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">dummy3d</span>
<a name="ln-1653"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Utavin</span>
<a name="ln-1654"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Ttavin</span>
<a name="ln-1655"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>          <span class="kd">::</span>  <span class="n">Uinlin</span>
<a name="ln-1656"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>          <span class="kd">::</span>  <span class="n">Urecin</span>
<a name="ln-1657"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>          <span class="kd">::</span>  <span class="n">Tinlin</span>
<a name="ln-1658"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>          <span class="kd">::</span>  <span class="n">Trecin</span>
<a name="ln-1659"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Wrecin</span>
<a name="ln-1660"></a>      <span class="kt">character</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">name4</span>
<a name="ln-1661"></a>      <span class="kt">real </span><span class="n">dummy</span>
<a name="ln-1662"></a>      <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-1663"></a>      <span class="c">!********************************************************************</span>
<a name="ln-1664"></a>
<a name="ln-1665"></a>      <span class="c">!    1.0 Read initfiles</span>
<a name="ln-1666"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1667"></a>      <span class="n">name</span> <span class="o">=</span> <span class="n">startfile</span>
<a name="ln-1668"></a>      <span class="n">name</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span>
<a name="ln-1669"></a>      <span class="n">name</span><span class="p">(</span><span class="mi">15</span><span class="p">:</span><span class="mi">17</span><span class="p">)</span> <span class="o">=</span> <span class="n">cmyid</span>
<a name="ln-1670"></a>      <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;loading &#39;</span><span class="p">,</span> <span class="n">name</span>
<a name="ln-1671"></a>      <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1672"></a>
<a name="ln-1673"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">mindist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1674"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">wall</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-1675"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">u0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1676"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">v0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1677"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">w0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1678"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">pres0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1679"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1680"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">e120</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1681"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">ekm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1682"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1683"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1684"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1685"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">timee</span><span class="p">,</span> <span class="n">dt</span>
<a name="ln-1686"></a>      <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1687"></a>      <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;finished loading &#39;</span><span class="p">,</span> <span class="n">name</span>
<a name="ln-1688"></a>
<a name="ln-1689"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">lreadscal</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1690"></a><span class="k">         </span><span class="n">name</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
<a name="ln-1691"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;loading &#39;</span><span class="p">,</span> <span class="n">name</span>
<a name="ln-1692"></a>         <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1693"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">sv0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1694"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">timee</span>
<a name="ln-1695"></a>         <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1696"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;finished loading &#39;</span><span class="p">,</span> <span class="n">name</span>
<a name="ln-1697"></a>      <span class="n">elseif</span> <span class="p">((</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">lreadscal</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1698"></a><span class="k">         </span><span class="n">sv0</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1699"></a>         <span class="n">svprof</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1700"></a>      <span class="k">end if</span>
<a name="ln-1701"></a>
<a name="ln-1702"></a>      <span class="c">! read mean variables if asked for by lreadmean</span>
<a name="ln-1703"></a>      <span class="n">name2</span> <span class="o">=</span> <span class="s1">&#39;means   .&#39;</span>
<a name="ln-1704"></a>      <span class="n">name2</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">cmyid</span>
<a name="ln-1705"></a>      <span class="n">name2</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1706"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">lreadmean</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1707"></a><span class="k">         write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Reading meansXXX.XXX, proc = &#39;</span><span class="p">,</span> <span class="n">myid</span>
<a name="ln-1708"></a>         <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name2</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1709"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totavtime</span><span class="p">,</span> <span class="n">nsv</span>
<a name="ln-1710"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1711"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">vav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1712"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">wav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1713"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1714"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">qtav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1715"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">qlav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1716"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">presav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1717"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1718"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">viscratioav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1719"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uuav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1720"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">vvav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1721"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">wwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1722"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thl2av</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1723"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">sv2av</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1724"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uvav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1725"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1726"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">vwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1727"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thluav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1728"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlvav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1729"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1730"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svuav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1731"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svvav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1732"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1733"></a>         <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1734"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Total averaging time so far: &#39;</span><span class="p">,</span> <span class="n">totavtime</span>
<a name="ln-1735"></a>
<a name="ln-1736"></a>         <span class="c">! read &lt;x&#39;y&#39;&gt;_SGS to file.</span>
<a name="ln-1737"></a>         <span class="n">name2</span> <span class="o">=</span> <span class="s1">&#39;SGS__   .&#39;</span>
<a name="ln-1738"></a>         <span class="n">name2</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">cmyid</span>
<a name="ln-1739"></a>         <span class="n">name2</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1740"></a>         <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name2</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1741"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span>
<a name="ln-1742"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uusgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1743"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">vvsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1744"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">wwsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1745"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uwsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1746"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">dummy3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! this is dissresav, which will be computed using other mean quantities</span>
<a name="ln-1747"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">tkesgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1748"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">dummy3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! this is disssgsav, which will be computed using other mean quantities</span>
<a name="ln-1749"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">strain2av</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! &lt;SijSij&gt; (NOT &lt;Sij&gt;&lt;Sij&gt; !!) (average over time)</span>
<a name="ln-1750"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">nusgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! &lt;nu_sgs&gt; (average over time)</span>
<a name="ln-1751"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlusgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1752"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlwsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1753"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svusgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1754"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svwsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1755"></a>         <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1756"></a>
<a name="ln-1757"></a>      <span class="k">end if</span>
<a name="ln-1758"></a>
<a name="ln-1759"></a>      <span class="c">! read mean profiles for inlet generator</span>
<a name="ln-1760"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">lreadminl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1761"></a><span class="k">         if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">lzinzsim</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1762"></a><span class="k">            </span><span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;meaninlet.   &#39;</span>
<a name="ln-1763"></a>            <span class="n">name4</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1764"></a>            <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name4</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1765"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totinletav</span> <span class="c">! interval of time-average</span>
<a name="ln-1766"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Uinlin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1767"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Urecin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1768"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Wrecin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1769"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((</span><span class="n">Utavin</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1770"></a>            <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1771"></a>
<a name="ln-1772"></a>            <span class="k">call </span><span class="n">zinterpolate1d</span><span class="p">(</span><span class="n">Uinlin</span><span class="p">,</span> <span class="n">Uinl</span><span class="p">)</span> <span class="c">! interpolate inlet profile to zgrid</span>
<a name="ln-1773"></a>            <span class="k">call </span><span class="n">zinterpolate1d</span><span class="p">(</span><span class="n">Urecin</span><span class="p">,</span> <span class="n">Urec</span><span class="p">)</span>
<a name="ln-1774"></a>            <span class="k">call </span><span class="n">zinterpolatew1d</span><span class="p">(</span><span class="n">Wrecin</span><span class="p">,</span> <span class="n">Wrec</span><span class="p">)</span>
<a name="ln-1775"></a>            <span class="k">call </span><span class="n">zinterpolate2d</span><span class="p">(</span><span class="n">Utavin</span><span class="p">,</span> <span class="n">Utav</span><span class="p">)</span>
<a name="ln-1776"></a>
<a name="ln-1777"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1778"></a><span class="k">               </span><span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;tempinlet.   &#39;</span>
<a name="ln-1779"></a>               <span class="n">name4</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1780"></a>               <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name4</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1781"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totinletav</span> <span class="c">! interval of time-average</span>
<a name="ln-1782"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Tinlin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1783"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Trecin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1784"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((</span><span class="n">Ttavin</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1785"></a>               <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1786"></a>
<a name="ln-1787"></a>               <span class="k">call </span><span class="n">zinterpolatet1d</span><span class="p">(</span><span class="n">Tinlin</span><span class="p">,</span> <span class="n">Tinl</span><span class="p">)</span>
<a name="ln-1788"></a>               <span class="k">call </span><span class="n">zinterpolatet1d</span><span class="p">(</span><span class="n">Trecin</span><span class="p">,</span> <span class="n">Trec</span><span class="p">)</span>
<a name="ln-1789"></a>               <span class="k">call </span><span class="n">zinterpolate2d</span><span class="p">(</span><span class="n">Ttavin</span><span class="p">,</span> <span class="n">Ttav</span><span class="p">)</span>
<a name="ln-1790"></a>            <span class="k">end if</span> <span class="c">! ltempeq</span>
<a name="ln-1791"></a>
<a name="ln-1792"></a>         <span class="k">else</span> <span class="c">!lzinzsim=.true. -&gt; inlet grid equals sim grid</span>
<a name="ln-1793"></a>            <span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;meaninlet.   &#39;</span>
<a name="ln-1794"></a>            <span class="n">name4</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1795"></a>            <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name4</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1796"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totinletav</span> <span class="c">! interval of time-average</span>
<a name="ln-1797"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Uinl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1798"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Urec</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1799"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Wrec</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1800"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((</span><span class="n">Utav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1801"></a>
<a name="ln-1802"></a>            <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1803"></a>
<a name="ln-1804"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1805"></a><span class="k">               </span><span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;tempinlet.   &#39;</span>
<a name="ln-1806"></a>               <span class="n">name4</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1807"></a>               <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name4</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1808"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totinletav</span> <span class="c">! interval of time-average</span>
<a name="ln-1809"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Tinl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1810"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Trec</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1811"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((</span><span class="n">Ttav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1812"></a>
<a name="ln-1813"></a>               <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1814"></a>            <span class="k">end if</span> <span class="c">! ltempeq</span>
<a name="ln-1815"></a>         <span class="k">end if</span> <span class="c">! lzinzsim</span>
<a name="ln-1816"></a>
<a name="ln-1817"></a>         <span class="n">utaui</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numol</span><span class="o">*</span><span class="n">Uinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">/</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)))</span> <span class="c">! average streamwise friction at inlet (need for first time step)</span>
<a name="ln-1818"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1819"></a><span class="k">            </span><span class="n">ttaui</span> <span class="o">=</span> <span class="n">numol</span><span class="o">*</span><span class="n">prandtlmoli</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">Tinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">-</span> <span class="n">thls</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">*</span><span class="n">utaui</span><span class="p">)</span>
<a name="ln-1820"></a>         <span class="k">end if</span>
<a name="ln-1821"></a><span class="k">      end if</span> <span class="c">!(lreadminl)</span>
<a name="ln-1822"></a>
<a name="ln-1823"></a>   <span class="k">end subroutine </span><span class="n">readrestartfiles</span>
<a name="ln-1824"></a>
<a name="ln-1825"></a>   <span class="k">subroutine </span><span class="n">exitmodules</span>
<a name="ln-1826"></a>      <span class="k">use </span><span class="n">modfields</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">exitfields</span>
<a name="ln-1827"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">exitglobal</span>
<a name="ln-1828"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">exitmpi</span>
<a name="ln-1829"></a>      <span class="k">use </span><span class="n">modpois</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">exitpois</span>
<a name="ln-1830"></a>      <span class="k">use </span><span class="n">modsubgrid</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">exitsubgrid</span>
<a name="ln-1831"></a>      <span class="k">use </span><span class="n">modthermodynamics</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">exitthermodynamics</span>
<a name="ln-1832"></a>      <span class="k">use </span><span class="n">modinlet</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">exitinlet</span>
<a name="ln-1833"></a>
<a name="ln-1834"></a>      <span class="k">call </span><span class="n">exitthermodynamics</span>
<a name="ln-1835"></a>      <span class="k">call </span><span class="n">exitsubgrid</span>
<a name="ln-1836"></a>      <span class="k">call </span><span class="n">exitpois</span>
<a name="ln-1837"></a>      <span class="k">call </span><span class="n">exitfields</span>
<a name="ln-1838"></a>      <span class="k">call </span><span class="n">exitglobal</span>
<a name="ln-1839"></a>      <span class="k">call </span><span class="n">exitinlet</span>
<a name="ln-1840"></a>      <span class="k">call </span><span class="n">exitmpi</span>
<a name="ln-1841"></a>
<a name="ln-1842"></a>   <span class="k">end subroutine </span><span class="n">exitmodules</span>
<a name="ln-1843"></a>
<a name="ln-1844"></a>   <span class="k">subroutine </span><span class="n">randomnize</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">klev</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">ir</span><span class="p">,</span> <span class="n">ihl</span><span class="p">,</span> <span class="n">jhl</span><span class="p">)</span>
<a name="ln-1845"></a>
<a name="ln-1846"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">myid</span><span class="p">,</span> <span class="n">nprocs</span>
<a name="ln-1847"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kh</span>
<a name="ln-1848"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">KIND</span><span class="o">=</span><span class="nb">selected_int_kind</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="kd">::</span> <span class="n">imm</span><span class="p">,</span> <span class="n">ia</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ir</span>
<a name="ln-1849"></a>      <span class="kt">integer </span><span class="n">ihl</span><span class="p">,</span> <span class="n">jhl</span>
<a name="ln-1850"></a>      <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">klev</span>
<a name="ln-1851"></a>      <span class="kt">integer </span><span class="n">m</span><span class="p">,</span> <span class="n">mfac</span>
<a name="ln-1852"></a>      <span class="kt">real </span><span class="n">ran</span><span class="p">,</span> <span class="n">ampl</span>
<a name="ln-1853"></a>      <span class="kt">real </span><span class="n">field</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ihl</span><span class="p">:</span><span class="n">ie</span> <span class="o">+</span> <span class="n">ihl</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="n">jhl</span><span class="p">:</span><span class="n">je</span> <span class="o">+</span> <span class="n">jhl</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1854"></a>      <span class="k">parameter</span><span class="p">(</span><span class="n">imm</span><span class="o">=</span><span class="mi">134456</span><span class="p">,</span> <span class="n">ia</span><span class="o">=</span><span class="mi">8121</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="mi">28411</span><span class="p">)</span>
<a name="ln-1855"></a>
<a name="ln-1856"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1857"></a><span class="k">         </span><span class="n">mfac</span> <span class="o">=</span> <span class="n">myid</span><span class="o">*</span><span class="n">jmax</span><span class="o">*</span><span class="n">imax</span>
<a name="ln-1858"></a>         <span class="k">do </span><span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mfac</span>
<a name="ln-1859"></a>            <span class="n">ir</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">((</span><span class="n">ir</span><span class="p">)</span><span class="o">*</span><span class="n">ia</span> <span class="o">+</span> <span class="n">ic</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
<a name="ln-1860"></a>
<a name="ln-1861"></a>         <span class="k">end do</span>
<a name="ln-1862"></a><span class="k">      end if</span>
<a name="ln-1863"></a><span class="k">      do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1864"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1865"></a>         <span class="n">ir</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">((</span><span class="n">ir</span><span class="p">)</span><span class="o">*</span><span class="n">ia</span> <span class="o">+</span> <span class="n">ic</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
<a name="ln-1866"></a>         <span class="n">ran</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">imm</span><span class="p">)</span>
<a name="ln-1867"></a>         <span class="n">field</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">klev</span><span class="p">)</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">klev</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ran</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">2.0</span><span class="o">*</span><span class="n">ampl</span>
<a name="ln-1868"></a>      <span class="k">end do</span>
<a name="ln-1869"></a><span class="k">      end do</span>
<a name="ln-1870"></a>
<a name="ln-1871"></a><span class="k">      if</span> <span class="p">(</span><span class="n">nprocs</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">myid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1872"></a><span class="k">         </span><span class="n">mfac</span> <span class="o">=</span> <span class="p">(</span><span class="n">nprocs</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">myid</span><span class="p">)</span><span class="o">*</span><span class="n">imax</span><span class="o">*</span><span class="n">jmax</span>
<a name="ln-1873"></a>         <span class="k">do </span><span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mfac</span>
<a name="ln-1874"></a>            <span class="n">ir</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">((</span><span class="n">ir</span><span class="p">)</span><span class="o">*</span><span class="n">ia</span> <span class="o">+</span> <span class="n">ic</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
<a name="ln-1875"></a>         <span class="k">end do</span>
<a name="ln-1876"></a><span class="k">      end if</span>
<a name="ln-1877"></a>
<a name="ln-1878"></a><span class="k">      return</span>
<a name="ln-1879"></a><span class="k">   end subroutine </span><span class="n">randomnize</span>
<a name="ln-1880"></a>
<a name="ln-1881"></a>   <span class="k">subroutine </span><span class="n">createmasks</span>
<a name="ln-1882"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ihc</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">jh</span><span class="p">,</span> <span class="n">jhc</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kh</span><span class="p">,</span> <span class="n">khc</span><span class="p">,</span> <span class="n">rslabs</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span> <span class="n">nblocks</span><span class="p">,&amp;</span>
<a name="ln-1883"></a>         <span class="n">ifinput</span><span class="p">,</span> <span class="n">cexpnr</span><span class="p">,</span> <span class="n">libm</span><span class="p">,</span> <span class="n">jtot</span><span class="p">,</span> <span class="k">block</span>
<a name="ln-1884"></a><span class="k">      use </span><span class="n">modfields</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">IIc</span><span class="p">,</span> <span class="n">IIu</span><span class="p">,</span> <span class="n">IIv</span><span class="p">,</span> <span class="n">IIw</span><span class="p">,</span> <span class="n">IIuw</span><span class="p">,</span> <span class="n">IIvw</span><span class="p">,</span> <span class="n">IIuv</span><span class="p">,</span> <span class="n">IIct</span><span class="p">,</span> <span class="n">IIwt</span><span class="p">,</span> <span class="n">IIut</span><span class="p">,</span> <span class="n">IIuwt</span><span class="p">,</span> <span class="n">IIvt</span><span class="p">,&amp;</span>
<a name="ln-1885"></a>         <span class="n">IIcs</span><span class="p">,</span> <span class="n">IIus</span><span class="p">,</span> <span class="n">IIuws</span><span class="p">,</span> <span class="n">IIvws</span><span class="p">,</span> <span class="n">IIuvs</span><span class="p">,</span> <span class="n">IIvs</span><span class="p">,</span> <span class="n">IIws</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1886"></a>         <span class="n">um</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">vm</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">wm</span><span class="p">,</span> <span class="n">w0</span>
<a name="ln-1887"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span><span class="n">myid</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_DOUBLE_PRECISION</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1888"></a>         <span class="n">cmyid</span><span class="p">,</span> <span class="n">MPI_REAL8</span><span class="p">,</span> <span class="n">MPI_REAL4</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">excjs</span>
<a name="ln-1889"></a>      <span class="c">! use initfac, only:block</span>
<a name="ln-1890"></a>      <span class="kt">integer </span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">il</span><span class="p">,</span> <span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">,</span> <span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">,</span> <span class="n">ku</span>
<a name="ln-1891"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIcl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIul</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIvl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIwl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIuwl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIvwl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIuvl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">)</span>
<a name="ln-1892"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIcd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1893"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1894"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIuwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1895"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIud</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1896"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIvd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1897"></a>      <span class="kt">character</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="n">chmess</span><span class="p">,</span> <span class="n">name2</span>
<a name="ln-1898"></a>
<a name="ln-1899"></a>      <span class="c">! II*l needn&#39;t be defined up to ke_khc, but for now would require large scale changes in modstatsdump so if works leave as is ! tg3315 04/07/18</span>
<a name="ln-1900"></a>
<a name="ln-1901"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">libm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1902"></a><span class="k">         </span><span class="n">IIc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1903"></a>         <span class="n">IIu</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1904"></a>         <span class="n">IIv</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1905"></a>         <span class="n">IIw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1906"></a>         <span class="n">IIuw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1907"></a>         <span class="n">IIvw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1908"></a>         <span class="n">IIuv</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1909"></a>         <span class="n">IIcs</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1910"></a>         <span class="n">IIus</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1911"></a>         <span class="n">IIvs</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1912"></a>         <span class="n">IIws</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1913"></a>         <span class="n">IIuws</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1914"></a>         <span class="n">IIvws</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1915"></a>         <span class="n">IIuvs</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1916"></a>         <span class="n">IIct</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span> 
<a name="ln-1917"></a>         <span class="n">IIut</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span>
<a name="ln-1918"></a>         <span class="n">IIvt</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span>
<a name="ln-1919"></a>         <span class="n">IIwt</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span>
<a name="ln-1920"></a>         <span class="n">IIuwt</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span>
<a name="ln-1921"></a>         <span class="k">return</span>
<a name="ln-1922"></a><span class="k">      end if</span>
<a name="ln-1923"></a>
<a name="ln-1924"></a><span class="k">      allocate</span> <span class="p">(</span><span class="k">block</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nblocks</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">))</span>
<a name="ln-1925"></a>
<a name="ln-1926"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1927"></a><span class="k">         if</span> <span class="p">(</span><span class="n">nblocks</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1928"></a><span class="k">            open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;blocks.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1929"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1930"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1931"></a>            <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nblocks</span>
<a name="ln-1932"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1933"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1934"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1935"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1936"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1937"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1938"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1939"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1940"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1941"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1942"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1943"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<a name="ln-1944"></a>            <span class="k">end do</span>
<a name="ln-1945"></a><span class="k">            close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1946"></a>
<a name="ln-1947"></a>            <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nblocks</span>
<a name="ln-1948"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1949"></a>                  <span class="n">n</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1950"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1951"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1952"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1953"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1954"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1955"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-1956"></a>            <span class="k">end do</span>
<a name="ln-1957"></a><span class="k">         end if</span> <span class="c">!nblocks&gt;0</span>
<a name="ln-1958"></a>      <span class="k">end if</span> <span class="c">!myid</span>
<a name="ln-1959"></a>
<a name="ln-1960"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="k">block</span><span class="p">,</span> <span class="mi">11</span><span class="o">*</span><span class="n">nblocks</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1961"></a>
<a name="ln-1962"></a>      <span class="c">! Create masking matrices</span>
<a name="ln-1963"></a>      <span class="n">IIc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIu</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIct</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIvw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIwt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIut</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIvt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuwt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIcs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIvs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIvws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuvs</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1964"></a>
<a name="ln-1965"></a>      <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nblocks</span>
<a name="ln-1966"></a>         <span class="n">il</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1967"></a>         <span class="n">iu</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-1968"></a>         <span class="c">!kl = block(n, 5)</span>
<a name="ln-1969"></a>         <span class="n">kl</span> <span class="o">=</span> <span class="n">kb</span> <span class="c">! tg3315 changed as buildings for lEB must start at kb+1 not kb with no block below</span>
<a name="ln-1970"></a>         <span class="n">ku</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-1971"></a>         <span class="n">jl</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">myid</span><span class="o">*</span><span class="n">jmax</span>
<a name="ln-1972"></a>         <span class="n">ju</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="n">myid</span><span class="o">*</span><span class="n">jmax</span>
<a name="ln-1973"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ju</span> <span class="o">&lt;</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">jl</span> <span class="o">&gt;</span> <span class="n">je</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1974"></a><span class="k">            cycle</span>
<a name="ln-1975"></a><span class="k">         else</span>
<a name="ln-1976"></a><span class="k">            if</span> <span class="p">(</span><span class="n">ju</span> <span class="o">&gt;=</span> <span class="n">je</span><span class="p">)</span> <span class="k">then</span> <span class="c">!tg3315 04/07/18 to avoid ju+1 when is last cell...</span>
<a name="ln-1977"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">jl</span> <span class="o">&lt;</span> <span class="n">jb</span><span class="p">)</span> <span class="n">jl</span> <span class="o">=</span> <span class="n">jb</span>
<a name="ln-1978"></a>               <span class="n">ju</span> <span class="o">=</span> <span class="n">je</span>
<a name="ln-1979"></a>
<a name="ln-1980"></a>               <span class="c">! Masking matrices !tg3315</span>
<a name="ln-1981"></a>               <span class="n">IIc</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1982"></a>               <span class="n">IIu</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1983"></a>               <span class="n">IIv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1984"></a>               <span class="n">IIw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1985"></a>               <span class="n">IIuw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1986"></a>               <span class="n">IIvw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1987"></a>               <span class="n">IIuv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1988"></a>
<a name="ln-1989"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">ju</span> <span class="o">==</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="c">! if end of block is in cell before proc</span>
<a name="ln-1990"></a>
<a name="ln-1991"></a>               <span class="n">IIv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1992"></a>               <span class="n">IIvw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1993"></a>               <span class="n">IIuv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1994"></a>
<a name="ln-1995"></a>            <span class="k">else</span> <span class="c">! ju is in this proc...</span>
<a name="ln-1996"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">jl</span> <span class="o">&lt;</span> <span class="n">jb</span><span class="p">)</span> <span class="n">jl</span> <span class="o">=</span> <span class="n">jb</span>
<a name="ln-1997"></a>
<a name="ln-1998"></a>               <span class="c">! Masking matrices !tg3315</span>
<a name="ln-1999"></a>               <span class="n">IIc</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2000"></a>               <span class="n">IIu</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2001"></a>               <span class="n">IIv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2002"></a>               <span class="n">IIw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2003"></a>               <span class="n">IIuw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2004"></a>               <span class="n">IIvw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2005"></a>               <span class="n">IIuv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2006"></a>
<a name="ln-2007"></a>            <span class="k">end if</span>
<a name="ln-2008"></a>
<a name="ln-2009"></a>            <span class="c">! ensure that ghost cells know where blocks are !tg3315 this is not necessary</span>
<a name="ln-2010"></a>            <span class="c">! if (jl&lt;jb+jh)  IIc(il:iu,je+jh,kl:ku) = 0</span>
<a name="ln-2011"></a>            <span class="c">! if (jl&lt;jb+jhc) IIc(il:iu,je+jhc,kl:ku) = 0</span>
<a name="ln-2012"></a>            <span class="c">! if (ju&gt;je-jh)  IIc(il:iu,jb-jh,kl:ku) = 0</span>
<a name="ln-2013"></a>            <span class="c">! if (ju&gt;je-jhc) IIc(il:iu,jb-jhc,kl:ku) = 0</span>
<a name="ln-2014"></a>
<a name="ln-2015"></a>            <span class="c">! if (il&lt;ib+ih)  IIc(ie+ih,jl:ju,kl:ku) = 0</span>
<a name="ln-2016"></a>            <span class="c">! if (il&lt;ib+ihc) IIc(ie+ihc,jl:ju,kl:ku) = 0</span>
<a name="ln-2017"></a>            <span class="c">! if (iu&gt;ie-ih)  IIc(ib-ih,jl:ju,kl:ku) = 0</span>
<a name="ln-2018"></a>            <span class="c">! if (iu&gt;ie-ihc) IIc(ib-ihc,jl:ju,kl:ku) = 0</span>
<a name="ln-2019"></a>
<a name="ln-2020"></a>         <span class="k">end if</span>
<a name="ln-2021"></a><span class="k">      end do</span>
<a name="ln-2022"></a>
<a name="ln-2023"></a><span class="k">      </span><span class="n">IIw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">IIuw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">IIvw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2024"></a>
<a name="ln-2025"></a>      <span class="c">! for correct ghost cells from adjacent processors !tg3315 ?unsure if this is correct</span>
<a name="ln-2026"></a>      <span class="c">! tg3315 22/11/17 does not work because II is an integer and needs real numbers... !tg3315 not necessary</span>
<a name="ln-2027"></a>      <span class="c">!call excjs( IIc  , ib,ie,jb,je,kb,ke+khc,ihc,jhc)</span>
<a name="ln-2028"></a>      <span class="c">!call excjs( IIu  , ib,ie,jb,je,kb,ke+khc,ihc,jhc)</span>
<a name="ln-2029"></a>      <span class="c">!call excjs( IIv  , ib,ie,jb,je,kb,ke+khc,ihc,jhc)</span>
<a name="ln-2030"></a>      <span class="c">!call excjs( IIw  , ib,ie,jb,je,kb,ke+khc,ihc,jhc)</span>
<a name="ln-2031"></a>
<a name="ln-2032"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span>
<a name="ln-2033"></a>         <span class="n">IIcl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2034"></a>         <span class="n">IIul</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2035"></a>         <span class="n">IIvl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIv</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2036"></a>         <span class="n">IIwl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2037"></a>         <span class="n">IIuwl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIuw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2038"></a>         <span class="n">IIvwl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIvw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2039"></a>         <span class="n">IIuvl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIuv</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2040"></a>      <span class="n">enddo</span>
<a name="ln-2041"></a>
<a name="ln-2042"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIcl</span><span class="p">,</span> <span class="n">IIcs</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2043"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2044"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIul</span><span class="p">,</span> <span class="n">IIus</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2045"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2046"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIvl</span><span class="p">,</span> <span class="n">IIvs</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2047"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2048"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIwl</span><span class="p">,</span> <span class="n">IIws</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2049"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2050"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIuwl</span><span class="p">,</span> <span class="n">IIuws</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2051"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2052"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIvwl</span><span class="p">,</span> <span class="n">IIvws</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2053"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2054"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIuvl</span><span class="p">,</span> <span class="n">IIuvs</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2055"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2056"></a>
<a name="ln-2057"></a>      <span class="n">IIcd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2058"></a>      <span class="n">IIwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2059"></a>      <span class="n">IIuwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIuw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2060"></a>      <span class="n">IIud</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2061"></a>      <span class="n">IIvd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIv</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2062"></a>
<a name="ln-2063"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIwt</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2064"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIcd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIct</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2065"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIuwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIuwt</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2066"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIud</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIut</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2067"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIvd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIvt</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2068"></a>
<a name="ln-2069"></a>      <span class="c">! masking matrix for switch if entire slab is blocks</span>
<a name="ln-2070"></a>      <span class="c">!if (IIcs(kb) == 0) then</span>
<a name="ln-2071"></a>      <span class="c">!  IIbl = 0</span>
<a name="ln-2072"></a>      <span class="c">!else</span>
<a name="ln-2073"></a>      <span class="c">!  IIbl = 1</span>
<a name="ln-2074"></a>      <span class="c">!end if</span>
<a name="ln-2075"></a>
<a name="ln-2076"></a>      <span class="c">!where (IIcs == 0)</span>
<a name="ln-2077"></a>      <span class="c">!IIcs = nint(rslabs)</span>
<a name="ln-2078"></a>      <span class="c">!endwhere</span>
<a name="ln-2079"></a>      <span class="c">!where (IIus == 0)</span>
<a name="ln-2080"></a>      <span class="c">!IIus = nint(rslabs)</span>
<a name="ln-2081"></a>      <span class="c">!endwhere</span>
<a name="ln-2082"></a>      <span class="c">!where (IIvs == 0)</span>
<a name="ln-2083"></a>      <span class="c">!IIvs = nint(rslabs)</span>
<a name="ln-2084"></a>      <span class="c">!endwhere</span>
<a name="ln-2085"></a>      <span class="c">!where (IIws == 0)</span>
<a name="ln-2086"></a>      <span class="c">!IIws = nint(rslabs)</span>
<a name="ln-2087"></a>      <span class="c">!endwhere</span>
<a name="ln-2088"></a>      <span class="c">!where (IIuws == 0)</span>
<a name="ln-2089"></a>      <span class="c">!IIuws = nint(rslabs)</span>
<a name="ln-2090"></a>      <span class="c">!endwhere</span>
<a name="ln-2091"></a>      <span class="c">!where (IIvws == 0)</span>
<a name="ln-2092"></a>      <span class="c">!IIvws = nint(rslabs)</span>
<a name="ln-2093"></a>      <span class="c">!endwhere</span>
<a name="ln-2094"></a>
<a name="ln-2095"></a>      <span class="c">! use masking matrices to set 0 in blocks from start? tg3315 13/12/17</span>
<a name="ln-2096"></a>      <span class="c">! um(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh) = IIu(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)*um(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)</span>
<a name="ln-2097"></a>      <span class="c">! vm(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh) = IIv(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)*vm(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)</span>
<a name="ln-2098"></a>      <span class="c">! wm(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh) = IIw(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)*wm(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)</span>
<a name="ln-2099"></a>
<a name="ln-2100"></a>      <span class="c">! u0 = um</span>
<a name="ln-2101"></a>      <span class="c">! v0 = vm</span>
<a name="ln-2102"></a>      <span class="c">! w0 = wm</span>
<a name="ln-2103"></a>
<a name="ln-2104"></a>   <span class="k">end subroutine </span><span class="n">createmasks</span>
<a name="ln-2105"></a>
<a name="ln-2106"></a><span class="k">end module </span><span class="n">modstartup</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2021 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> uDALES was developed by The uDALES Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>