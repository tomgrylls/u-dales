
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="TODO:">
      
      
      
        <meta name="author" content="The uDALES Team">
      
      
        <link rel="canonical" href="https://uDALES.github.io/u-dales/udales-getting-started/">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.4">
    
    
      
        <title>Getting Started - uDALES</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.75751829.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="pink">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://uDALES.github.io/u-dales" title="uDALES" class="md-header-nav__button md-logo" aria-label="uDALES">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            uDALES
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/uDALES/u-dales" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    u-dales
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://uDALES.github.io/u-dales" title="uDALES" class="md-nav__button md-logo" aria-label="uDALES">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    uDALES
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/uDALES/u-dales" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    u-dales
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Getting Started
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Getting Started
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#singularity" class="md-nav__link">
    Singularity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udales" class="md-nav__link">
    uDALES
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-setup" class="md-nav__link">
    Project setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-processing" class="md-nav__link">
    Pre-processing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-processing" class="md-nav__link">
    Post-processing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linuxwsl-ubuntu" class="md-nav__link">
    Linux/WSL (Ubuntu)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macos" class="md-nav__link">
    macOS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repository-set-up" class="md-nav__link">
    Repository set-up
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-on-common-systems" class="md-nav__link">
    Build on common systems
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-on-hpcs" class="md-nav__link">
    Build on HPCs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-defaultsoptions" class="md-nav__link">
    Build defaults/options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up" class="md-nav__link">
    Set-up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    Run
  </a>
  
    <nav class="md-nav" aria-label="Run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-on-common-systems" class="md-nav__link">
    Run on common systems
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-on-hpcs" class="md-nav__link">
    Run on HPCs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    What's next?
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../udales-example-simulations/" class="md-nav__link">
      Examples
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    
    <label class="md-nav__link" for="nav-4">
      User's docs
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User's docs" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        User's docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../udales-simulation-setup/" class="md-nav__link">
      Set-up
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../udales-namoptions-overview/" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../udales-pre-processing/" class="md-nav__link">
      Pre-processing
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../udales-post-processing/" class="md-nav__link">
      Post-processing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../udales-pub-list/" class="md-nav__link">
      Publication list
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../udales-docs-software/index.html" class="md-nav__link">
      Software docs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#singularity" class="md-nav__link">
    Singularity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udales" class="md-nav__link">
    uDALES
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-setup" class="md-nav__link">
    Project setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-processing" class="md-nav__link">
    Pre-processing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-processing" class="md-nav__link">
    Post-processing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linuxwsl-ubuntu" class="md-nav__link">
    Linux/WSL (Ubuntu)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macos" class="md-nav__link">
    macOS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repository-set-up" class="md-nav__link">
    Repository set-up
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-on-common-systems" class="md-nav__link">
    Build on common systems
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-on-hpcs" class="md-nav__link">
    Build on HPCs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-defaultsoptions" class="md-nav__link">
    Build defaults/options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up" class="md-nav__link">
    Set-up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    Run
  </a>
  
    <nav class="md-nav" aria-label="Run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-on-common-systems" class="md-nav__link">
    Run on common systems
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-on-hpcs" class="md-nav__link">
    Run on HPCs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    What's next?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<p>Getting started with uDALES to set up your own experiments is straightforward. This guide goes through the steps required to <a href="#installation">install</a> uDALES, and <a href="#set-up">set-up</a> and <a href="#run">run</a> a simple example.</p>
<h2 id="singularity">Singularity<a class="headerlink" href="#singularity" title="Permanent link">&para;</a></h2>
<p>If you have <a href="https://sylabs.io/">Singularity</a> available on your system, you can use the provided scripts under <code>tools/singularity</code> to build and run uDALES cases locally or on HPC environments, for other options, see the sections below. The use of Singularity is undoubtedly the easiest way to build and run cases in uDALES as all dependencies are provided and uDALES will compile out of the box. Furthermore, users wishing to achieve a reasonable level of scientific reproducibility may archive software, tools, and data with their Singularity image containing OS and external libraries to an open access repository (e.g. <a href="https://doi.org/10.1029/2019MS001961">Meyer et al., 2020</a>).</p>
<p>To build and download the Singularity image use:</p>
<div class="highlight"><pre><span></span><code>singularity build --remote tools/singularity/image.sif tools/singularity/image.def
</code></pre></div>
<p>then, to install uDALES use:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># udales_build.sh &lt;NPROC&gt; [Debug, Release]</span>
./tools/singularity/udales_build.sh <span class="m">2</span> Release
</code></pre></div>
<p>Finally, to run an example case use:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># udales_run.sh &lt;NPROC&gt; &lt;BUILD_TYPE&gt; &lt;PATH_TO_CASE&gt; &lt;NAMELIST&gt;</span>
./tools/singularity/udales_run.sh <span class="m">2</span> Release examples/001 namoptions.001
</code></pre></div>
<p>If you are looking to run the build and run commands on HPC, we have provided a sample script under <code>tools/singularity/udales_pbs_submit.sh</code>, you can modify and run it with <code>qsub tools/singularity/udales_pbs_submit.sh</code>.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<h3 id="udales">uDALES<a class="headerlink" href="#udales" title="Permanent link">&para;</a></h3>
<p>uDALES is supported to run on Linux, macOS and Windows Subsystem for Linux (WSL). Please ensure that the latest version of the following libraries and software are available on your system:</p>
<ul>
<li><a href="https://cmake.org/">CMake</a> &gt;= 3.9.</li>
<li><a href="https://www.unidata.ucar.edu/downloads/netcdf/index.jsp">NetCDF-Fortran</a> &gt;= 4.</li>
<li><a href="https://gcc.gnu.org/wiki/GFortran">GNU</a> &lt;= 9, <a href="https://software.intel.com/content/www/us/en/develop/documentation/fortran-compiler-developer-guide-and-reference/top.html">Intel</a>, or <a href="https://pubs.cray.com/">Cray</a> Fortran compiler.</li>
<li>A recenet version of <a href="https://www.mpich.org/">MPICH</a> or <a href="https://www.open-mpi.org/">Open-MPI</a>.</li>
</ul>
<h3 id="project-setup">Project setup<a class="headerlink" href="#project-setup" title="Permanent link">&para;</a></h3>
<p>This guide helps you set up a project template for uDALES with a generic folder structure set-up that you can later use to set up your own experiments. For this you also need:</p>
<ul>
<li><a href="https://git-scm.com/">Git</a> &gt;= 2.</li>
<li>A <a href="https://github.com">GitHub</a> account. (optional)</li>
<li><a href="https://www.python.org/">Python</a> &gt;= 3.6.</li>
</ul>
<h3 id="pre-processing">Pre-processing<a class="headerlink" href="#pre-processing" title="Permanent link">&para;</a></h3>
<p>When you create your own experiments, you will need to set up specific input files. We have a system in place that does that for you, written in MATLAB. Information can be found under <a href="../udales-pre-processing/">pre-processing</a> and is not discussed in the getting-started set-up.</p>
<ul>
<li><a href="https://www.mathworks.com/products/matlab.html">MATLAB</a></li>
</ul>
<h3 id="post-processing">Post-processing<a class="headerlink" href="#post-processing" title="Permanent link">&para;</a></h3>
<p>For better organised netcdf output files, you will need:</p>
<ul>
<li><a href="https://github.com/nco/nco">netCDF Operators</a> (NCO).</li>
</ul>
<p>On local systems, these software and libraries (except MATLAB) should be available from your system's package manager (e.g. APT, yum, Homebrew, etc.) and examples on how to install all the required libraries for Linux/WSL and macOS are given below.</p>
<p>On high performance computing (HPC) clusters, these software and libraries should have already been installed. Please refer to the specific documentation to load the above software and libraries. Alternatively, you can install all the required packages easily after installing <a href="https://docs.brew.sh/Homebrew-on-Linux">Linuxbrew</a> and using the instructions for <a href="#macos">macOS</a>.</p>
<h3 id="linuxwsl-ubuntu">Linux/WSL (Ubuntu)<a class="headerlink" href="#linuxwsl-ubuntu" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>sudo apt-get update <span class="o">&amp;&amp;</span> sudo apt-get upgrade -y
sudo apt-get install -y git cmake gfortran libopenmpi-dev openmpi-bin libnetcdf-dev libnetcdff-dev nco python3 python3-pip
</code></pre></div>
<h3 id="macos">macOS<a class="headerlink" href="#macos" title="Permanent link">&para;</a></h3>
<p>On macOS, use <a href="https://docs.brew.sh">Homebrew</a> to install the required libraries. If you do not have Homebrew installed on your system, install it from the <a href="https://docs.brew.sh/Installation">Homebrew installation page</a> then, to install all the required dependencies, including support for MPI, run the following commands from your terminal prompt:</p>
<div class="highlight"><pre><span></span><code>brew update
brew install git cmake gcc@9 netcdf open-mpi nco python3
</code></pre></div>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>The installation and set-up of uDALES is straightforward thanks to the use of a <a href="https://github.com/uDALES/cookiecutter-u-dales">Cookiecutter repository</a> to create a project template for uDALES with a generic folder structure set-up that you can later use to set up your own experiments.</p>
<p>Please make sure that you have created a new (private) repository on your GitHub account and made note of the URL as we need this later to configure Cookiecutter.</p>
<h3 id="repository-set-up">Repository set-up<a class="headerlink" href="#repository-set-up" title="Permanent link">&para;</a></h3>
<p>First, install <a href="https://github.com/cookiecutter/cookiecutter">Cookiecutter</a> from your command prompt:</p>
<div class="highlight"><pre><span></span><code>python3 -m pip install --user cookiecutter
</code></pre></div>
<p>Then, to create a new uDALES project within the current working directory:</p>
<div class="highlight"><pre><span></span><code>cookiecutter https://github.com/uDALES/cookiecutter-u-dales
</code></pre></div>
<p>and fill in the required fields when prompted. <code>&lt;PROJECT_NAME&gt;</code> is the name of the generated project directory and <code>&lt;GITHUB_PROJECT_REMOTE&gt;</code> is the URL to your remote GitHub account (this is optional, you can just press the return key to leave this empty). E.g.:</p>
<div class="highlight"><pre><span></span><code>directory_name <span class="o">[</span>&lt;PROJECT_NAME&gt;<span class="o">]</span>: neutral_experiments
github_project_remote <span class="o">[</span>&lt;GITHUB_PROJECT_REMOTE&gt;<span class="o">]</span>: https://github.com/&lt;MY_GITHUB_USERNAME&gt;/&lt;MY_NEW_EMPTY_REPO&gt;.git
</code></pre></div>
<p>This creates a Git repository for your own projects named <code>&lt;PROJECT_NAME&gt;</code> with the <a href="https://github.com/uDALES/u-dales">uDALES model development repository</a> as submodule, and a generic tree that you can use to set up your own experiments:</p>
<div class="highlight"><pre><span></span><code>.
├── data        <span class="c1"># Contains or links to any external data used by the experiments.</span>
├── docs        <span class="c1"># Relevant documentation or papers used for the experiment.</span>
├── experiments <span class="c1"># Configuration files grouped by experiment number.</span>
│   └── &lt;N&gt;     <span class="c1"># Any configurations files needed by uDALES to run experiment &lt;N&gt;.</span>
│   └── ...
├── tools       <span class="c1"># Additional or specialized tools other then the ones included with uDALES.</span>
└── u-dales     <span class="c1"># uDALES model development repository (submodule).</span>
</code></pre></div>
<p>In the next steps we will assume your current working directory is the top-level project directory you just created with Cookiecutter.</p>
<h3 id="build-on-common-systems">Build on common systems<a class="headerlink" href="#build-on-common-systems" title="Permanent link">&para;</a></h3>
<p>On standard systems and configurations, you can build uDALES with the following commands:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

mkdir -p u-dales/build/release <span class="c1"># in case you want to later create a build/debug</span>
<span class="nb">pushd</span> u-dales/build/release
cmake -LA ../..
make
<span class="nb">popd</span>
</code></pre></div>
<p>You can compile in parallel mode by passing Make the <code>j</code> flag followed by the number of CPU cores to use. For example, to compile with 2 cores do <code>make -j2</code>.</p>
<h3 id="build-on-hpcs">Build on HPCs<a class="headerlink" href="#build-on-hpcs" title="Permanent link">&para;</a></h3>
<p>If you are a High Performance Cluster (HPC) user you are likely using the <a href="http://modules.sourceforge.net/">Environment Modules package</a> for the dynamic modification of the user's environment via modulefiles and therefore you may need to hint CMake the PATH to NetCDF (see below how).</p>
<p>Here we show how to compile uDALES using the <a href="https://www.imperial.ac.uk/admin-services/ict/self-service/research-support/rcs/">HPC at ICL</a> as an example, therefore please note that the specific names/versions installed on your system may be different.</p>
<div class="highlight"><pre><span></span><code>module list <span class="c1"># list currently enabled modules -- should be empty!</span>
module avail <span class="c1"># list available modules</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># This is an example, please check with the previous command for the exact name of the</span>
<span class="c1"># modules available on your system. This will load NetCDF compiled with Intel Suite</span>
<span class="c1"># 2019.4 and add the correct version of icc and ifort to the PATH.</span>
module load intel-suite/2017.6 mpi/intel-2018 cmake/3.14.0 git/2.14.3
</code></pre></div>
<p>Then, to build the uDALES executable, run the following commands:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

mkdir -p u-dales/build/release
<span class="nb">pushd</span> u-dales/build/release
<span class="nv">FC</span><span class="o">=</span>mpiifort cmake -DNETCDF_DIR<span class="o">=</span>/apps/netcdf/4.4.1-c -DNETCDF_FORTRAN_DIR<span class="o">=</span>/apps/netcdf/4.4.4-fortran -LA ../..
make
<span class="nb">popd</span>
</code></pre></div>
<p>where <code>NETCDF_DIR</code> and <code>NETCDF_FORTRAN_DIR</code> indicates the absolute path to your NetCDF-C and NetCDF-Fortran installation directories. Here, we use the utilities <code>nc-config</code> and <code>nf-config</code> to hint CMake the location of NetCDF, but you can simply pass the absolute path to the NetCDF-C and NetCDF-Fortran manually instead. You can compile in parallel mode by passing Make the <code>j</code> flag followed by the number of CPU cores to use. For example, to compile with 2 cores do <code>make -j2</code>.</p>
<h3 id="build-defaultsoptions">Build defaults/options<a class="headerlink" href="#build-defaultsoptions" title="Permanent link">&para;</a></h3>
<p>By default uDALES will compile in <code>Release</code> mode. You can change this by specifying the option (or flag) at configure time. The general syntax for specifying an option in CMake is <code>-D&lt;flag_name&gt;=&lt;flag_value&gt;</code> where <code>&lt;flag_name&gt;</code> is the option/flag name and <code>&lt;flag_value&gt;</code> is the option/flag value. The following options can be specified when configuring uDALES:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Options</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CMAKE_BUILD_TYPE</code></td>
<td><code>Release</code>, <code>Debug</code></td>
<td><code>Release</code></td>
<td>Whether to optimise/build with debug flags</td>
</tr>
<tr>
<td><code>NETCDF4_DIR</code></td>
<td><code>&lt;path&gt;</code></td>
<td>-</td>
<td>Path to NetCDF-C installation directory</td>
</tr>
<tr>
<td><code>NETCDF_FORTRAN_DIR</code></td>
<td><code>&lt;path&gt;</code></td>
<td>-</td>
<td>Path to NetCDF-Fortran installation directory</td>
</tr>
<tr>
<td><code>SKIP_UPDATE_EXTERNAL_PROJECTS</code></td>
<td><code>ON</code>, <code>OFF</code></td>
<td><code>OFF</code></td>
<td>Whether to skip updating external projects</td>
</tr>
</tbody>
</table>
<h2 id="set-up">Set-up<a class="headerlink" href="#set-up" title="Permanent link">&para;</a></h2>
<p>To set up a new simulation, <code>copy_inputs.sh</code> in <code>u-dales/tools/</code> is used to create a new simulation setup <code>new_exp_id</code> based on another simulation <code>old_exp_id</code>. All <code>exp_ids</code> are three digit numbers, e.g. 001, and are stored in directories of that name. Scripts requires several variables to be set up. You can do this by copying and pasting the snippet below or by including it in a bash script (or bash profile if you are unlikely to change them).</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

<span class="nb">export</span> <span class="nv">DA_EXPDIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/experiments <span class="c1">#  The top-level directory of the simulation setups.</span>
<span class="nb">export</span> <span class="nv">DA_WORKDIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/outputs <span class="c1"># Output top-level directory</span>

<span class="c1"># If source directories (DA_EXPDIR_SRC, DA_WORKDIR_SRC) are not set,</span>
<span class="c1"># the experiment set-up folder will be copied from the same target directory.</span>
<span class="c1"># I.e. DA_EXPDIR_SRC==DA_EXPDIR and DA_WORKDIR_SRC==DA_WORKDIR.</span>
<span class="nb">export</span> <span class="nv">DA_EXPDIR_SRC</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/u-dales/examples
<span class="nb">export</span> <span class="nv">DA_WORKDIR_SRC</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/u-dales/examples
</code></pre></div>
<p>If you set up a new experiment on HPC, also use:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">DA_WORKDIR</span><span class="o">=</span><span class="nv">$EPHEMERAL</span> <span class="c1"># Output top-level directory on HPC</span>
<span class="nb">export</span> <span class="nv">DA_WORKDIR_SRC</span><span class="o">=</span><span class="nv">$EPHEMERAL</span>
</code></pre></div>
<p>Now to set-up a new experiment (here we use case <code>009</code>) based on a previous example (here we use case <code>001</code>), run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

<span class="c1"># General syntax: copy_inputs.sh new_exp_id old_exp_id</span>
<span class="c1"># To set up a new simulation starting from the restart files of another simulation</span>
<span class="c1"># (&quot;warmstart&quot;), use the &#39;w&#39; flag. E.g.: copy_inputs.sh new_exp_id old_exp_id w</span>
./u-dales/tools/copy_inputs.sh <span class="m">009</span> <span class="m">001</span>
</code></pre></div>
<h2 id="run">Run<a class="headerlink" href="#run" title="Permanent link">&para;</a></h2>
<p>The scripts <code>local_execute.sh</code> and <code>hpc_execute.sh</code> in <code>u-dales/tools</code> are used as wrappers to run simulations on your local machine and HPC at ICL respectively. These scripts contain several helpers to run the simulations and merge outputs from several CPUs into a single file (see <a href="../udales-post-processing/">Post-processing</a> for more info about the individual scripts).</p>
<p>The scripts require several variables to be set up. Below is an example setup for copying and pasting. You can also specify these parameters in a <code>config.sh</code> file within the experiment directory, which is then read by the scripts.</p>
<p>Note that you need to choose the number of CPUs you are using to run the simulation such that the number of grid cells in the y-direction (<code>jtot</code> parameter in the <code>namoptions</code> input file) is a multiple of the number of CPUs.</p>
<h3 id="run-on-common-systems">Run on common systems<a class="headerlink" href="#run-on-common-systems" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

<span class="nb">export</span> <span class="nv">DA_TOOLSDIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/u-dales/tools <span class="c1"># Directory of scripts</span>
<span class="nb">export</span> <span class="nv">DA_BUILD</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/u-dales/build/release/u-dales <span class="c1"># Build file</span>
<span class="nb">export</span> <span class="nv">NCPU</span><span class="o">=</span><span class="m">2</span> <span class="c1"># Number of CPUs to use for a simulation</span>
<span class="nb">export</span> <span class="nv">DA_WORKDIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/outputs <span class="c1"># Output top-level directory</span>
</code></pre></div>
<p>Then, to start the simulation, run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

<span class="c1"># General syntax: local_execute.sh exp_directory</span>
./u-dales/tools/local_execute.sh experiments/009
</code></pre></div>
<h3 id="run-on-hpcs">Run on HPCs<a class="headerlink" href="#run-on-hpcs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">DA_TOOLSDIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/u-dales/tools <span class="c1"># Directory of scripts</span>
<span class="nb">export</span> <span class="nv">DA_BUILD</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/u-dales/build/release/u-dales <span class="c1"># Build file</span>
<span class="nb">export</span> <span class="nv">NCPU</span><span class="o">=</span><span class="m">2</span> <span class="c1"># Number of CPUs to use for a simulation</span>

<span class="nb">export</span> <span class="nv">NNODE</span><span class="o">=</span><span class="m">1</span> <span class="c1"># Number of nodes to use for a simulation</span>
<span class="nb">export</span> <span class="nv">WALLTIME</span><span class="o">=</span><span class="s2">&quot;00:30:00&quot;</span> <span class="c1"># Maximum runtime for simulation in hours:minutes:seconds</span>
<span class="nb">export</span> <span class="nv">MEM</span><span class="o">=</span><span class="s2">&quot;2gb&quot;</span> <span class="c1"># Memory request per node</span>
</code></pre></div>
<p>For guidance on how to set the parameters on HPC, have a look at <a href="https://www.imperial.ac.uk/admin-services/ict/self-service/research-support/rcs/computing/job-sizing-guidance/">Job sizing guidance</a>.
Then, to start the simulation, run:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We assume you are running the following commands from your</span>
<span class="c1"># top-level project directory.</span>

<span class="c1"># General syntax: hpc_execute.sh exp_directory</span>
./u-dales/tools/hpc_execute.sh experiments/009
</code></pre></div>
<h2 id="whats-next">What's next?<a class="headerlink" href="#whats-next" title="Permanent link">&para;</a></h2>
<p>This simple guide is meant to allow you to get started based on an existing example. We set up several <a href="../udales-example-simulations/">example simulations</a> to get you started. To learn more about pre- and post-processing steps in uDALES, please see the <a href="../udales-pre-processing/">pre-processing</a> and <a href="../udales-post-processing/">post-processing</a> pages.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </div>
            </div>
          </a>
        
        
          <a href="../udales-example-simulations/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Examples
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            The uDALES Team
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>